/*!
 * Tiny.Physics.Ant
 * Description: 轻量级物理引擎，从Phaser 的arcade的改造过来的 感谢Phaser提供的解决方案
 * Author: 采东 <qingyangmoke@qq.com>
 * Version: v0.0.3
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Ant=e():(t.Tiny=t.Tiny||{},t.Tiny.Physics=t.Tiny.Physics||{},t.Tiny.Physics.Ant=e())}(this,function(){return function(t){function e(o){if(i[o])return i[o].exports;var s=i[o]={exports:{},id:o,loaded:!1};return t[o].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="/Users/song/Develop/github/tinyjs-plugin-ant/dist",e(0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t){return t&&t.__esModule?t:{default:t}}function n(t,e){null===d?(d=new a.default(t,e),t.onUpdate(function(){d.update()})):console.warn("物理系统已经启用了，请不要重复调用！")}Object.defineProperty(e,"__esModule",{value:!0}),e.EVENTS=e.Math=e.startSystem=void 0;var r=i(2);Object.keys(r).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})});var h=i(3),a=s(h),l=i(7),c=o(l),u=i(8),y=o(u),d=null;e.startSystem=n,e.Math=c,e.EVENTS=y},function(t,e){"use strict";function i(t,e){for(var i in e)t[i]=e[i];return t}function o(){var t=void 0,e=void 0,i=void 0,o=void 0;return i=[255,255,255],o=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),o=Math.floor((o+3*i[0])/4),e=Math.floor((e+3*i[1])/4),t=Math.floor((t+3*i[2])/4),s(o,e,t)}function s(t,e,i){return n(t)+n(e)+n(i)}function n(t){var e=t.toString(16);return 2===e.length?e:e+"0"}Object.defineProperty(e,"__esModule",{value:!0}),e.extend=i,e.randomPastelHex=o,e.rgbToHex=s,e.componentToHex=n},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t){return t&&t.__esModule?t:{default:t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),l=i(4),c=s(l),u=i(5),y=s(u),d=i(8),p=o(d),f=i(7),v=o(f),g=function(t){function e(t,i){n(this,e);var o=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return void 0===i?i={gravity:[0,0]}:i.hasOwnProperty("gravity")||(i.gravity=[0,0]),o.type="Tiny.Physics.Ant.World",o.app=t,o.app.physics=o.app.physics||{},o.app.physics.ant=o,o.config=i,o.gravity=new Tiny.Point,o.gravity.x=i.gravity[0],o.gravity.y=i.gravity[1],o.bounds=new Tiny.Rectangle(0,0,0,0),o.checkCollision={up:!0,down:!0,left:!0,right:!0},o.maxObjects=10,o.maxLevels=4,o.OVERLAP_BIAS=4,o.forceX=!1,o.skipQuadTree=!0,o._paused=!1,o._total=0,o._restitution=0,o._toRemove=[],o._bodies=[],o.physicsElapsed=1/60,o.setBoundsToWorld(!0,!0,!0,!0),o}return h(e,t),a(e,[{key:"dispatch",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];this.emit.apply(this,arguments)}},{key:"setBounds",value:function(t,e,i,o){var s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],r=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],h=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];this.bounds.x=t,this.bounds.y=e,this.bounds.width=i,this.bounds.height=o,void 0!==s&&(this.checkCollision.left=!!s),void 0!==n&&(this.checkCollision.right=!!n),void 0!==r&&(this.checkCollision.top=!!r),void 0!==h&&(this.checkCollision.bottom=!!h)}},{key:"setBoundsToWorld",value:function(t,e,i,o){this.setBounds(0,0,this.app.renderer.width,this.app.renderer.height,t,e,i,o)}},{key:"enable",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=1;if(Array.isArray(t))for(o=t.length;o--;)t[o]instanceof c.default?this.enable(t[o].children,e,i):(this.enableBody(t[o],e),i&&t[o].hasOwnProperty("children")&&t[o].children.length>0&&this.enable(t[o],e,!0));else t instanceof c.default?this.enable(t.children,e,i):(this.enableBody(t,e),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,e,!0))}},{key:"enableBody",value:function(t,e){t.body||(t.body=new y.default(this,t),t.body.debug=e,"undefined"!=typeof t.anchor&&t.anchor.set(.5,.5),this.addBody(t.body))}},{key:"addBody",value:function(t){if(this._toRemove)for(var e=0;e<this._toRemove.length;e++)this._toRemove[e]===this&&this._toRemove.splice(e,1);this._bodies.indexOf(t)===-1&&(this._bodies.push(t),this.dispatch(p.ON_BODY_ADDED,t))}},{key:"removeBodyNextStep",value:function(t){this._toRemove.push(t)}},{key:"computeVelocity",value:function(t,e,i,o,s){var n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1e4;return 1===t&&e.allowGravity?i+=(this.gravity.x+e.gravity.x)*this.physicsElapsed:2===t&&e.allowGravity&&(i+=(this.gravity.y+e.gravity.y)*this.physicsElapsed),o?i+=o*this.physicsElapsed:s&&(s*=this.physicsElapsed,i-s>0?i-=s:i+s<0?i+=s:i=0),i>n?i=n:i<-n&&(i=-n),i}},{key:"overlap",value:function(t,e,i,o,s){if(i=i||null,o=o||null,s=s||this,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var n=0;n<e.length;n++)this.collideHandler(t,e[n],i,o,s,!0);else if(Array.isArray(t)&&!Array.isArray(e))for(var r=0;r<t.length;r++)this.collideHandler(t[r],e,i,o,s,!0);else if(Array.isArray(t)&&Array.isArray(e))for(var h=0;h<t.length;h++)for(var a=0;a<e.length;a++)this.collideHandler(t[h],e[a],i,o,s,!0);else this.collideHandler(t,e,i,o,s,!0);return this._total>0}},{key:"collide",value:function(t,e,i,o,s){if(i=i||null,o=o||null,s=s||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var n=0;n<e.length;n++)this.collideHandler(t,e[n],i,o,s,!1);else if(Array.isArray(t)&&!Array.isArray(e))for(var r=0;r<t.length;r++)this.collideHandler(t[r],e,i,o,s,!1);else if(Array.isArray(t)&&Array.isArray(e))for(var h=0;h<t.length;h++)for(var a=0;a<e.length;a++)this.collideHandler(t[h],e[a],i,o,s,!1);else this.collideHandler(t,e,i,o,s,!1);return this._total>0}},{key:"collideHandler",value:function(t,e,i,o,s,n){t&&e&&t.visible&&e.visible&&t instanceof Tiny.Sprite&&e instanceof Tiny.Sprite&&this.collideSpriteVsSprite(t,e,i,o,s,n)}},{key:"collideSpriteVsSprite",value:function(t,e,i,o,s,n){return!(!t.body||!e.body)&&(this.separate(t.body,e.body,o,s,n)&&(i&&i.call(s,t,e),this._total++),!0)}},{key:"separate",value:function(t,e,i,o,s){if(!t.enable||!e.enable||t.checkCollision.none||e.checkCollision.none||!this.intersects(t,e))return!1;if(i&&i.call(o,t.sprite,e.sprite)===!1)return!1;if(t.isCircle&&e.isCircle)return this.separateCircle(t,e,s);if(t.isCircle!==e.isCircle){var n=t.isCircle?e:t,r=t.isCircle?t:e,h={x:n.x,y:n.y,right:n.right,bottom:n.bottom},a={x:r.x+r.radius,y:r.y+r.radius};if((a.y<h.y||a.y>h.bottom)&&(a.x<h.x||a.x>h.right))return this.separateCircle(t,e,s)}var l=!1,c=!1;this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)?(l=this.separateX(t,e,s),this.intersects(t,e)&&(c=this.separateY(t,e,s))):(c=this.separateY(t,e,s),this.intersects(t,e)&&(l=this.separateX(t,e,s)));var u=l||c;return u&&(s?(t.onOverlap(e),e.onOverlap(t)):(t.onCollide(e),e.onCollide(t))),u}},{key:"separateX",value:function(t,e,i){var o=this.getOverlapX(t,e,i);if(i||0===o||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==o||t.embedded&&e.embedded;var s=t.velocity.x,n=e.velocity.x;if(t.immovable||e.immovable)t.immovable?(e.x+=o,e.velocity.x=s-n*e.bounce.x,t.moves&&(e.y+=(t.y-t.prev.y)*t.friction.y)):(t.x-=o,t.velocity.x=n-s*t.bounce.x,e.moves&&(t.y+=(e.y-e.prev.y)*e.friction.y));else{o*=.5,t.x-=o,e.x+=o;var r=Math.sqrt(n*n*e.mass/t.mass)*(n>0?1:-1),h=Math.sqrt(s*s*t.mass/e.mass)*(s>0?1:-1),a=.5*(r+h);r-=a,h-=a,t.velocity.x=a+r*t.bounce.x,e.velocity.x=a+h*e.bounce.x}return!0}},{key:"separateY",value:function(t,e,i){var o=this.getOverlapY(t,e,i);if(i||0===o||t.immovable&&e.immovable||t.customSeparateY||e.customSeparateY)return 0!==o||t.embedded&&e.embedded;var s=t.velocity.y,n=e.velocity.y;if(t.immovable||e.immovable)t.immovable?(e.y+=o,e.velocity.y=s-n*e.bounce.y,t.moves&&(e.x+=(t.x-t.prev.x)*t.friction.x)):(t.y-=o,t.velocity.y=n-s*t.bounce.y,e.moves&&(t.x+=(e.x-e.prev.x)*e.friction.x));else{o*=.5,t.y-=o,e.y+=o;var r=Math.sqrt(n*n*e.mass/t.mass)*(n>0?1:-1),h=Math.sqrt(s*s*t.mass/e.mass)*(s>0?1:-1),a=.5*(r+h);r-=a,h-=a,t.velocity.y=a+r*t.bounce.y,e.velocity.y=a+h*e.bounce.y}return!0}},{key:"getOverlapX",value:function(t,e,i){var o=0,s=t.deltaAbsX+e.deltaAbsX+this.OVERLAP_BIAS;return 0===t.deltaX&&0===e.deltaX?(t.embedded=!0,e.embedded=!0):t.deltaX>e.deltaX?(o=t.right-e.x,o>s&&!i||t.checkCollision.right===!1||e.checkCollision.left===!1?o=0:(t.touching.none=!1,t.touching.right=!0,e.touching.none=!1,e.touching.left=!0)):t.deltaX<e.deltaX&&(o=t.x-e.width-e.x,-o>s&&!i||t.checkCollision.left===!1||e.checkCollision.right===!1?o=0:(t.touching.none=!1,t.touching.left=!0,e.touching.none=!1,e.touching.right=!0)),t.overlapX=o,e.overlapX=o,o}},{key:"getOverlapY",value:function(t,e,i){var o=0,s=t.deltaAbsY+e.deltaAbsY+this.OVERLAP_BIAS;return 0===t.deltaY&&0===e.deltaY?(t.embedded=!0,e.embedded=!0):t.deltaY>e.deltaY?(o=t.bottom-e.y,o>s&&!i||t.checkCollision.down===!1||e.checkCollision.up===!1?o=0:(t.touching.none=!1,t.touching.down=!0,e.touching.none=!1,e.touching.up=!0)):t.deltaY<e.deltaY&&(o=t.y-e.bottom,-o>s&&!i||t.checkCollision.up===!1||e.checkCollision.down===!1?o=0:(t.touching.none=!1,t.touching.up=!0,e.touching.none=!1,e.touching.down=!0)),t.overlapY=o,e.overlapY=o,o}},{key:"separateCircle",value:function(t,e,i){this.getOverlapX(t,e),this.getOverlapY(t,e);var o=e.center.x-t.center.x,s=e.center.y-t.center.y,n=Math.atan2(s,o),r=0;if(t.isCircle!==e.isCircle){var h={x:e.isCircle?t.position.x:e.position.x,y:e.isCircle?t.position.y:e.position.y,right:e.isCircle?t.right:e.right,bottom:e.isCircle?t.bottom:e.bottom},a={x:t.isCircle?t.position.x+t.radius:e.position.x+e.radius,y:t.isCircle?t.position.y+t.radius:e.position.y+e.radius,radius:t.isCircle?t.radius:e.radius};a.y<h.y?a.x<h.x?r=v.distance(a.x,a.y,h.x,h.y)-a.radius:a.x>h.right&&(r=v.distance(a.x,a.y,h.right,h.y)-a.radius):a.y>h.bottom&&(a.x<h.x?r=v.distance(a.x,a.y,h.x,h.bottom)-a.radius:a.x>h.right&&(r=v.distance(a.x,a.y,h.right,h.bottom)-a.radius)),r*=-1}else r=t.radius+e.radius-v.distance(t.center.x,t.center.y,e.center.x,e.center.y);if(i||0===r||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==r&&(t.onOverlap(e),e.onOverlap(t)),0!==r;var l={x:t.velocity.x*Math.cos(n)+t.velocity.y*Math.sin(n),y:t.velocity.x*Math.sin(n)-t.velocity.y*Math.cos(n)},c={x:e.velocity.x*Math.cos(n)+e.velocity.y*Math.sin(n),y:e.velocity.x*Math.sin(n)-e.velocity.y*Math.cos(n)},u=((t.mass-e.mass)*l.x+2*e.mass*c.x)/(t.mass+e.mass),y=(2*t.mass*l.x+(e.mass-t.mass)*c.x)/(t.mass+e.mass);return t.immovable||(t.velocity.x=(u*Math.cos(n)-l.y*Math.sin(n))*t.bounce.x,t.velocity.y=(l.y*Math.cos(n)+u*Math.sin(n))*t.bounce.y),e.immovable||(e.velocity.x=(y*Math.cos(n)-c.y*Math.sin(n))*e.bounce.x,e.velocity.y=(c.y*Math.cos(n)+y*Math.sin(n))*e.bounce.y),Math.abs(n)<Math.PI/2?t.velocity.x>0&&!t.immovable&&e.velocity.x>t.velocity.x?t.velocity.x*=-1:e.velocity.x<0&&!e.immovable&&t.velocity.x<e.velocity.x?e.velocity.x*=-1:t.velocity.y>0&&!t.immovable&&e.velocity.y>t.velocity.y?t.velocity.y*=-1:e.velocity.y<0&&!e.immovable&&t.velocity.y<e.velocity.y&&(e.velocity.y*=-1):Math.abs(n)>Math.PI/2&&(t.velocity.x<0&&!t.immovable&&e.velocity.x<t.velocity.x?t.velocity.x*=-1:e.velocity.x>0&&!e.immovable&&t.velocity.x>e.velocity.x?e.velocity.x*=-1:t.velocity.y<0&&!t.immovable&&e.velocity.y<t.velocity.y?t.velocity.y*=-1:e.velocity.y>0&&!e.immovable&&t.velocity.x>e.velocity.y&&(e.velocity.y*=-1)),t.immovable||(t.x+=t.velocity.x*this.physicsElapsed-r*Math.cos(n),t.y+=t.velocity.y*this.physicsElapsed-r*Math.sin(n)),e.immovable||(e.x+=e.velocity.x*this.physicsElapsed+r*Math.cos(n),e.y+=e.velocity.y*this.physicsElapsed+r*Math.sin(n)),t.onCollide(e),e.onCollide(t),!0}},{key:"intersects",value:function(t,e){return t!==e&&(t.isCircle?e.isCircle?v.distance(t.center.x,t.center.y,e.center.x,e.center.y)<=t.radius+e.radius:this.circleBodyIntersects(t,e):e.isCircle?this.circleBodyIntersects(e,t):!(t.right<=e.position.x)&&(!(t.bottom<=e.position.y)&&(!(t.position.x>=e.right)&&!(t.position.y>=e.bottom))))}},{key:"circleBodyIntersects",value:function(t,e){var i=v.clamp(t.center.x,e.left,e.right),o=v.clamp(t.center.y,e.top,e.bottom),s=(t.center.x-i)*(t.center.x-i),n=(t.center.y-o)*(t.center.y-o);return s+n<=t.radius*t.radius}},{key:"velocityFromAngle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return i=i||new Tiny.Point,i.x=Math.cos(v.degToRad(t))*e,i.y=Math.sin(v.degToRad(t))*e,i}},{key:"velocityFromRotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,i=arguments[2];return i=i||new Tiny.Point,i.x=Math.cos(t)*e,i.y=Math.sin(t)*e,i}},{key:"accelerationFromRotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,i=arguments[2];return i=i||new Tiny.Point,i.x=Math.cos(t)*e,i.y=Math.sin(t)*e,i}},{key:"pause",value:function(){this._paused=!0}},{key:"_preUpdate",value:function(){for(var t=this._toRemove.length;t--;)this.removeBody(this._toRemove[t]);this._toRemove.length=0}},{key:"update",value:function(){this.paused||(this._bodies.forEach(function(t){t.preUpdate()}),this._preUpdate(),this._processCollide(),this._bodies.forEach(function(t){t.postUpdate()}))}},{key:"_processCollide",value:function(){var t=this;this._bodies.forEach(function(e){e.collidesWith.length>0&&t.collide(e.sprite,e.collidesWith),e.overlapsWith.length>0&&t.overlap(e.sprite,e.overlapsWith)})}},{key:"removeBody",value:function(t){var e=this._bodies.indexOf(t);return e===-1?t:(this._bodies.splice(e,1),this.dispatch(p.ON_BODY_REMOVED,t),t)}},{key:"destroy",value:function(){this._bodies.forEach(function(t){t.destroy()}),this._bodies=null,this.app.physics.ant===this&&(this.app.physics.ant=null),this.app=null}},{key:"paused",get:function(){return this._paused}},{key:"restitution",get:function(){return this._restitution},set:function(t){this._restitution=t}}]),e}(Tiny.EventEmitter);e.default=g},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return s(e,t),e}(Tiny.Container);e.default=n},function(t,e,i){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function s(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),l=i(6),c=s(l),u=i(7),y=s(u),d=i(8),p=s(d),f=i(9),v=o(f),g=i(10),b=o(g),x=function(t){function e(t,i,o,s,h){n(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i=i||null,o=o||0,s=s||0,a.world=t,a.app=a.world.app,a.sprite=i,a.type="Tiny.Physics.Ant.Body",a.enable=!0,a.isCircle=!1,a.radius=0,a.offset=new Tiny.Point,a.position=new Tiny.Point(i.x,i.y),a.prev=new Tiny.Point(a.position.x,a.position.y),a.allowRotation=!0,a.rotation=i.rotation,a.preRotation=a.rotation,a.width=i.width,a.height=i.height,a.sourceWidth=i.width,a.sourceHeight=i.height,i.texture&&(a.sourceWidth=i.texture.frame.width,a.sourceHeight=i.texture.frame.height),a.halfWidth=Math.abs(i.width/2),a.halfHeight=Math.abs(i.height/2),a.center=new Tiny.Point(i.x+a.halfWidth,i.y+a.halfHeight),a.velocity=new Tiny.Point,a.newVelocity=new Tiny.Point,a.deltaMax=new Tiny.Point,a.acceleration=new Tiny.Point,a.drag=new Tiny.Point,a.allowGravity=!0,a.gravity=new Tiny.Point,a.bounce=new Tiny.Point,a.bounce.x=a.world.restitution,a.bounce.y=a.world.restitution,a.worldBounce=null,a.maxVelocity=new Tiny.Point(1e4,1e4),a.friction=new Tiny.Point(1,0),a.angularVelocity=0,a.angularAcceleration=0,a.angularDrag=0,a.maxAngular=1e3,a.mass=1,a.angle=0,a.speed=0,a.facing=c.NONE,a.immovable=!1,a.moves=!0,a.customSeparateX=!1,a.customSeparateY=!1,a.overlapX=0,a.overlapY=0,a.overlapR=0,a.embedded=!1,a.collideWorldBounds=!1,a.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},a.touching={none:!0,up:!1,down:!1,left:!1,right:!1},a.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},a.blocked={up:!1,down:!1,left:!1,right:!1},a.dirty=!1,a.syncBounds=!1,a.stopVelocityOnCollide=!0,a._reset=!0,a._sx=i.scale.x,a._sy=i.scale.y,a._dx=0,a._dy=0,a.collidesWith=[],a.overlapsWith=[],a.debugBody=null,a}return h(e,t),a(e,[{key:"dispatch",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];this.emit.apply(this,arguments)}},{key:"updateBounds",value:function(){if(this.syncBounds){var t=this.sprite.getBounds();t.ceilAll(),t.width===this.width&&t.height===this.height||(this.width=t.width,this.height=t.height,this._reset=!0)}else{var e=Math.abs(this.sprite.scale.x),i=Math.abs(this.sprite.scale.y);e===this._sx&&i===this._sy||(this.width=this.sourceWidth*e,this.height=this.sourceHeight*i,this._sx=e,this._sy=i,this._reset=!0)}this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight))}},{key:"updateMotion",value:function(){var t=this,e=this.world.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity;t.angularVelocity+=e,t.rotation+=t.angularVelocity*this.world.physicsElapsed,t.velocity.x=this.world.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x),t.velocity.y=this.world.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)}},{key:"preUpdate",value:function(){this.enable&&!this.world.paused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=this.sprite.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.rotation=this.sprite.rotation,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.updateMotion(),this.newVelocity.set(this.velocity.x*this.world.physicsElapsed,this.velocity.y*this.world.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.position.x===this.prev.x&&this.position.y===this.prev.y||(this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.dispatch(p.ON_WORLD_BOUNDS,this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX,this._dy=this.deltaY,this._reset=!1)}},{key:"postUpdate",value:function(){this.enable&&this.dirty&&(this.dirty=!1,this.deltaX<0?this.facing=c.LEFT:this.deltaX>0&&(this.facing=c.RIGHT),this.deltaY<0?this.facing=c.UP:this.deltaY>0&&(this.facing=c.DOWN),this.moves&&(this._dx=this.deltaX,this._dy=this.deltaY,0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this.debugBody&&this.debugBody.updateSpriteTransform(),this._reset=!0),this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.rotation+=this.deltaZ),this.prev.x=this.position.x,this.prev.y=this.position.y)}},{key:"checkWorldBounds",value:function(){var t=this.position,e=this.world.bounds,i=this.world.checkCollision,o=this.worldBounce?-this.worldBounce.x:-this.bounce.x,s=this.worldBounce?-this.worldBounce.y:-this.bounce.y;if(this.isCircle){var n={x:this.center.x-this.radius,y:this.center.y-this.radius,right:this.center.x+this.radius,bottom:this.center.y+this.radius};n.x<e.x&&i.left?(t.x=e.x-this.halfWidth+this.radius,this.velocity.x*=o,this.blocked.left=!0):n.right>e.right&&i.right&&(t.x=e.right-this.halfWidth-this.radius,this.velocity.x*=o,this.blocked.right=!0),n.y<e.y&&i.up?(t.y=e.y-this.halfHeight+this.radius,this.velocity.y*=s,this.blocked.up=!0):n.bottom>e.bottom&&i.down&&(t.y=e.bottom-this.halfHeight-this.radius,this.velocity.y*=s,this.blocked.down=!0)}else t.x<e.x&&i.left?(t.x=e.x,this.velocity.x*=o,this.blocked.left=!0):this.right>e.right&&i.right&&(t.x=e.right-this.width,this.velocity.x*=o,this.blocked.right=!0),t.y<e.y&&i.up?(t.y=e.y,this.velocity.y*=s,this.blocked.up=!0):this.bottom>e.bottom&&i.down&&(t.y=e.bottom-this.height,this.velocity.y*=s,this.blocked.down=!0);return this.blocked.up||this.blocked.down||this.blocked.left||this.blocked.right}},{key:"setSize",value:function(t,e,i,o){void 0===i&&(i=this.offset.x),void 0===o&&(o=this.offset.y),this.sourceWidth=t,this.sourceHeight=e,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.set(i,o),this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.isCircle=!1,this.radius=0,this.shapeChanged()}},{key:"setRectangle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=this.sprite.width/this.sprite.scale.x/2-t/2,n=this.sprite.height/this.sprite.scale.y/2-e/2;i+=s,o+=n,this.setSize(t,e,i,o)}},{key:"setCircle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(t>0){var o=this.sprite.width/this.sprite.scale.x/2-t,s=this.sprite.height/this.sprite.scale.y/2-t;e+=o,i+=s,this.isCircle=!0,this.radius=t,this.sourceWidth=2*t,this.sourceHeight=2*t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.set(e,i),this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight)}else this.isCircle=!1;this.shapeChanged()}},{key:"reset",value:function(t,e){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this.position.x=t-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=e-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight)}},{key:"getBounds",value:function(t){return t=t||new b.default,this.isCircle?(t.x=this.center.x-this.radius,t.y=this.center.y-this.radius,t.right=this.center.x+this.radius,t.bottom=this.center.y+this.radius):(t.x=this.x,t.y=this.y,t.right=this.right,t.bottom=this.bottom),t}},{key:"hitTest",value:function(t,e){return this.isCircle?Tiny.Circle.contains.call(this,t,e):Tiny.Rectangle.contains.call(this,t,e)}},{key:"destroy",value:function(){this.removeFromWorld(),this.sprite.body=null,this.sprite=null,this.enable=!1}},{key:"onOverlap",value:function(t){this.dispatch(p.ON_OVER_LAP,this.sprite,t.sprite)}},{key:"onCollide",value:function(t){this.dispatch(p.ON_COLLIDE,this.sprite,t.sprite)}},{key:"addToWorld",value:function(){this.world.addBody(this)}},{key:"removeFromWorld",value:function(){this.world.removeBodyNextStep(this)}},{key:"moveTo",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=this,n=Math.atan2(e-s.y,t-s.x);return o>0&&(i=y.distance(s.x,s.y,t,e)/(o/1e3)),this.velocity.x=Math.cos(n)*i,this.velocity.y=Math.sin(n)*i,n}},{key:"accelerateTo",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3,n=y.angle(this.x,this.y,t,e);return this.acceleration.set(Math.cos(n)*i,Math.sin(n)*i),this.maxVelocity.set(o,s),n}},{key:"shapeChanged",value:function(){this.debugBody&&this.debugBody.draw(),this.dispatch(p.ON_SHAPE_CHANGED,this)}},{key:"containsCollide",value:function(t){return t instanceof e&&(t=t.sprite),this.collidesWith.indexOf(t)>-1}},{key:"addCollides",value:function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];o instanceof e&&(o=o.sprite),o.body&&o.body!==this&&!o.body.containsCollide(this.sprite)&&(this.containsCollide(o)||this.collidesWith.push(o))}else this.collidesWith.push(t)}},{key:"removeCollides",value:function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];o instanceof e&&(o=o.sprite),this._removeCollide(o)}else this._removeCollide(t)}},{key:"removeAllCollides",value:function(){this.collidesWith=[]}},{key:"_removeCollide",value:function(t){var e=this.collidesWith.indexOf(t);return e>-1&&this.collidesWith.splice(e,1),t}},{key:"containsOverlap",value:function(t){return t instanceof e&&(t=t.sprite),this.overlapsWith.indexOf(t)>-1}},{key:"_addToArray",value:function(t,i){if(Array.isArray(i))for(var o=0;o<i.length;o++){var s=i[o];s instanceof e&&(s=s.sprite),this.containsOverlap(s)||t.push(s)}else t.push(i)}},{key:"addOverlaps",value:function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];o instanceof e&&(o=o.sprite),this.containsOverlap(o)||this.overlapsWith.push(o)}else this.overlapsWith.push(t)}},{key:"removeOverlaps",value:function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];o instanceof e&&(o=o.sprite),this._removeOverlap(o)}else this._removeOverlap(t)}},{key:"removeAllOverlaps",value:function(){this.overlapsWith=[]}},{key:"_removeOverlap",value:function(t){var e=this.overlapsWith.indexOf(t);return e>-1&&this.overlapsWith.splice(e,1),t}},{key:"isOnFloor",get:function(){return this.blocked.down}},{key:"isOnCeiling",get:function(){return this.blocked.up}},{key:"isOnLeft",get:function(){return this.blocked.left}},{key:"isOnRight",get:function(){return this.blocked.right}},{key:"deltaAbsX",get:function(){return Math.abs(this.deltaX)}},{key:"deltaAbsY",get:function(){return Math.abs(this.deltaY)}},{key:"deltaX",get:function(){return this.position.x-this.prev.x}},{key:"deltaY",get:function(){return this.position.y-this.prev.y}},{key:"deltaZ",get:function(){return this.rotation-this.preRotation}},{key:"x",get:function(){return this.position.x},set:function(t){this.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.position.y=t}},{key:"left",get:function(){return this.position.x}},{key:"right",get:function(){return this.position.x+this.width}},{key:"top",get:function(){return this.position.y}},{key:"bottom",get:function(){return this.position.y+this.height}},{key:"debug",get:function(){return null!==this.debugBody},set:function(t){t&&!this.debugBody?(this.debugBody=new v.default(this),this.debugBody.draw()):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}},{key:"static",get:function(){return this.immovable},set:function(t){this.allowGravity=!t,this.immovable=!!t}}]),e}(Tiny.EventEmitter);e.default=x},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.NONE=0,e.LEFT=1,e.RIGHT=2,e.UP=3,e.DOWN=4},function(t,e){"use strict";function i(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)}function o(t,e,i){var o=i-e;if(o<=0)return 0;var s=(t-e)%o;return s<0&&(s+=o),s+e}function s(t){return t*l}function n(t){return t*c}function r(t,e,i,o){var s=t-i,n=e-o;return Math.sqrt(s*s+n*n)}function h(t,e,i,o){return Math.atan2(o-e,i-t)}function a(t,e,i){return t<e?e:i<t?i:t}Object.defineProperty(e,"__esModule",{value:!0}),e.wrapAngle=i,e.wrap=o,e.degToRad=s,e.radToDeg=n,e.distance=r,e.angle=h,e.clamp=a;var l=Math.PI/180,c=180/Math.PI},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ON_BODY_REMOVED="bodyRemoved",e.ON_BODY_ADDED="bodyAdded",e.ON_WORLD_BOUNDS="worldBounds",e.ON_OVER_LAP="overlap",e.ON_COLLIDE="collide",e.ON_SHAPE_CHANGED="shapeChanged"},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,
writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),a=i(2),l=o(a),c=function(t){function e(t,i){s(this,e);var o=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),r=t.world,h={lineWidth:1,alpha:.5,fill:.5,lineColor:255,fillColor:16711680};if(o.settings=l.extend(h,r.config.debug||{}),o.world=r,o.body=t,o.app=o.world.app,o.graphics=new Tiny.Graphics,o.graphics.alpha=o.settings.alpha,o.addChild(o.graphics),void 0===o.app.stageDebugLayer){var a=new Tiny.Container;a.scale.set(Tiny.config.multiplier),o.app.camera.addChild(a),o.app.stageDebugLayer=a}if(void 0===o.world.app.stageDebugLayer.ant){var c=new Tiny.Container;o.app.stageDebugLayer.addChild(c),o.app.stageDebugLayer.ant=c}return o.app.stageDebugLayer.ant.addChild(o),o.prescale=new Tiny.Point(o.body.sprite.scale.x,o.body.sprite.scale.y),o.draw(),o.updateSpriteTransform(),o}return r(e,t),h(e,[{key:"updateSpriteTransform",value:function(){this.position.x=this.body.x,this.position.y=this.body.y,this.prescale.equals(this.body.sprite.scale)||(this.prescale.copy(this.body.sprite.scale),this.draw())}},{key:"draw",value:function(){var t=this.settings.lineWidth,e=this.settings.lineColor,i=this.settings.fillColor;this.graphics.clear(),this.body.isCircle?this.drawCircle(this.graphics,this.body.halfWidth,this.body.halfHeight,this.body.halfWidth,0,i,e,t):this.drawRectangle(this.graphics,0,0,this.body.width,this.body.height,0,i,e,t)}},{key:"drawCircle",value:function(t,e,i,o,s,n,r){var h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1;t.lineStyle(h,r,1),this.settings.fill&&t.beginFill(n,1),t.drawCircle(e,i,o),this.settings.fill&&t.endFill(),t.lineStyle(h,r,1),t.moveTo(e,i),t.lineTo(e+o*Math.cos(-s),i+o*Math.sin(-s))}},{key:"drawRectangle",value:function(t,e,i,o,s,n,r,h){var a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1;t.lineStyle(a,h,1),this.settings.fill&&t.beginFill(r),t.drawRect(e,i,o,s),this.settings.fill&&t.endFill()}}]),e}(Tiny.Sprite);e.default=c},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),s=function(){function t(e,o,s,n){i(this,t),this.x=0,this.y=0,this.right=0,this.bottom=0}return o(t,[{key:"top",get:function(){return this.y}},{key:"left",get:function(){return this.x}}]),t}();e.default=s}])});