/*!
 * tinyjs-plugin-physics
 * Description: tiny 物理引擎基础库
 * Author: 清扬陌客 <qingyangmoke@qq.com>
 * Version: v0.0.1
 */
exports.Tiny=exports.Tiny||{},exports.Tiny.Physics=function(t){function e(o){if(i[o])return i[o].exports;var n=i[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="/Users/song/Develop/github/tinyjs-plugin-physics/dist",e(0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}var n=i(2),r=o(n),s=i(77),a=o(s);t.exports={P2:r,Ant:a}},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){null===f?(f=new l.default(t,e),t.onUpdate(function(){f&&f.update()})):console.warn("物理系统已经启用了，请不要重复调用！")}Object.defineProperty(e,"__esModule",{value:!0}),e.p2=e.EVENTS=e.Math=e.startSystem=void 0;var s=i(3);Object.keys(s).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})});var a=i(4),l=n(a),c=i(7),h=o(c),u=i(76),p=o(u),d=i(9),f=null;e.startSystem=r,e.Math=h,e.EVENTS=p,e.p2=d},function(t,e){"use strict";function i(t,e){for(var i in e)t[i]=e[i];return t}function o(){var t=void 0,e=void 0,i=void 0,o=void 0;return i=[255,255,255],o=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),o=Math.floor((o+3*i[0])/4),e=Math.floor((e+3*i[1])/4),t=Math.floor((t+3*i[2])/4),n(o,e,t)}function n(t,e,i){return r(t)+r(e)+r(i)}function r(t){var e=t.toString(16);return 2===e.length?e:e+"0"}Object.defineProperty(e,"__esModule",{value:!0}),e.extend=i,e.randomPastelHex=o,e.rgbToHex=n,e.componentToHex=r},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),c=i(5),h=n(c),u=i(65),p=n(u),d=i(66),f=n(d),v=i(6),y=n(v),g=i(67),m=n(g),b=i(68),w=n(b),A=i(69),x=n(A),C=i(70),B=n(C),E=i(71),_=n(E),M=i(72),P=n(M),k=i(73),O=n(k),S=i(74),F=n(S),L=i(75),T=n(L),I=i(76),q=o(I),R="Tiny.Physics.P2.Body",N=i(9),G=function(t){function e(t,i){r(this,e);var o=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.type="Tiny.Physics.P2.World",void 0===i?i={gravity:[0,0],broadphase:new N.SAPBroadphase}:(i.hasOwnProperty("gravity")?(i.gravity[0]=-i.gravity[0],i.gravity[1]=-i.gravity[1]):i.gravity=[0,0],i.hasOwnProperty("broadphase")||(i.broadphase=new N.SAPBroadphase)),o.app=t,o.app.physics=o.app.physics||{},o.app.physics.p2=o,o.config=i,o.world=new N.World(o.config),o.frameRate=1/60,o._paused=!1,o._toRemove=[],o._bodies=[],o.gravity=new y.default(o,o.world.gravity),o.walls={left:null,right:null,top:null,bottom:null},o._collisionGroupID=2,o._boundsLeft=!0,o._boundsRight=!0,o._boundsTop=!0,o._boundsBottom=!0,o._boundsOwnGroup=!1,o.collisionGroups=[],o.nothingCollisionGroup=new f.default(1),o.boundsCollisionGroup=new f.default(2),o.everythingCollisionGroup=new f.default(2147483648),o._impactEvents=!1,o.world.on(q.ON_BEGIN_CONTACT,o.beginContactHandler,o),o.world.on(q.ON_END_CONTACT,o.endContactHandler,o),o.setBoundsToWorld(!0,!0,!0,!0,!1),o}return a(e,t),l(e,[{key:"enable",value:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!0);var o=1;if(Array.isArray(t))for(o=t.length;o--;)t[o]instanceof p.default?this.enable(t[o].children,e,i):(this.enableBody(t[o],e),i&&t[o].hasOwnProperty("children")&&t[o].children.length>0&&this.enable(t[o],e,!0));else t instanceof p.default?this.enable(t.children,e,i):(this.enableBody(t,e),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,e,!0))}},{key:"enableBody",value:function(t,e){console.log("enableBody",t.body),void 0===t.body&&(t.body=new h.default(this,t,t.x,t.y,1),t.body.debug=e,"undefined"!=typeof t.anchor&&t.anchor.set(.5,.5),this.addBody(t.body))}},{key:"addBody",value:function(t){if(this._toRemove)for(var e=0;e<this._toRemove.length;e++)this._toRemove[e]===this&&this._toRemove.splice(e,1);return t.data.world!==this.world&&(this.world.addBody(t.data),this.dispatch(q.ON_BODY_ADDED,t),this._bodies.indexOf(t)===-1&&this._bodies.push(t),!0)}},{key:"preUpdate",value:function(){for(var t=this._toRemove.length;t--;)this.removeBody(this._toRemove[t]);this._toRemove.length=0}},{key:"update",value:function(){this.paused||(this._bodies.forEach(function(t){t.preUpdate()}),this.preUpdate(),this._bodies.forEach(function(t){t.postUpdate()}),this.world.step(this.frameRate))}},{key:"checkIfSetup",value:function(){if(null===this.app)throw new Error("引擎未setup")}},{key:"clear",value:function(){this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var t=this.world.constraints,e=t.length-1;e>=0;e--)this.world.removeConstraint(t[e]);for(var i=this.world.bodies,o=i.length-1;o>=0;o--)this.world.removeBody(i[o]);for(var n=this.world.springs,r=n.length-1;r>=0;r--)this.world.removeSpring(n[r]);for(var s=this.world.contactMaterials,a=s.length-1;a>=0;a--)this.world.removeContactMaterial(s[a]);this.world.off(q.ON_BEGIN_CONTACT,this.beginContactHandler,this),this.world.off(q.ON_END_CONTACT,this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this.boundsCollidesWith=[],this.walls={left:null,right:null,top:null,bottom:null}}},{key:"reset",value:function(){this.world.on(q.ON_BEGIN_CONTACT,this.beginContactHandler,this),this.world.on(q.ON_END_CONTACT,this.endContactHandler,this),this.nothingCollisionGroup=new f.default(1),this.boundsCollisionGroup=new f.default(2),this.everythingCollisionGroup=new f.default(2147483648),this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)}},{key:"destroy",value:function(){this.clear(),this.app.physics===this&&(this.app.physics=null),this.app=null}},{key:"dispatch",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];this.emit.apply(this,arguments)}},{key:"pxm",value:function(t){return.05*t}},{key:"pxmi",value:function(t){return-this.pxm(t)}},{key:"mpx",value:function(t){return 20*t}},{key:"mpxi",value:function(t){return-this.mpx(t)}},{key:"removeBodyNextStep",value:function(t){this._toRemove.push(t)}},{key:"removeBody",value:function(t){return t.data.world===this.world&&(this.world.removeBody(t.data),t.debug=!1,this.dispatch(q.ON_BODY_REMOVED,t)),t}},{key:"pause",value:function(){this._paused=!0}},{key:"resume",value:function(){this._paused=!1}},{key:"beginContactHandler",value:function(t){t.bodyA&&t.bodyB&&(this.dispatch(q.ON_BEGIN_CONTACT,{bodyA:t.bodyA.parent,bodyB:t.bodyB.parent,shapeA:t.shapeA,shapeB:t.shapeB,contactEquations:t.contactEquations}),t.bodyA.parent&&t.bodyA.parent.dispatch(q.ON_BEGIN_CONTACT,t.bodyB.parent,t.shapeB,t.bodyA.parent,t.shapeA,t.contactEquations),t.bodyB.parent&&t.bodyB.parent.dispatch(q.ON_BEGIN_CONTACT,t.bodyA.parent,t.shapeA,t.bodyB.parent,t.shapeB,t.contactEquations))}},{key:"endContactHandler",value:function(t){t.bodyA&&t.bodyB&&(this.dispatch(q.ON_END_CONTACT,{bodyA:t.bodyA.parent,bodyB:t.bodyB.parent,shapeA:t.shapeA,shapeB:t.shapeB}),t.bodyA.parent&&t.bodyA.parent.dispatch(q.ON_END_CONTACT,t.bodyB.parent,t.bodyB,t.bodyA.parent,t.shapeA,t.shapeB),t.bodyB.parent&&t.bodyB.parent.dispatch(q.ON_END_CONTACT,t.bodyA.parent,t.bodyA,t.shapeB.parent,t.shapeB))}},{key:"createBody",value:function(t,e,i,o,n,r){void 0===o&&(o=!1);var s=new h.default(this,null,t,e,i);if(r){var a=s.addPolygon(n,r);if(!a)return!1}return o&&this.world.addBody(s.data),s}},{key:"setBoundsToWorld",value:function(t,e,i,o,n){this.setBounds(0,0,this.app.renderer.width,this.app.renderer.height,t,e,i,o,n)}},{key:"setBounds",value:function(t,e,i,o,n,r,s,a,l){void 0===n&&(n=this._boundsLeft),void 0===r&&(r=this._boundsRight),void 0===s&&(s=this._boundsTop),void 0===a&&(a=this._boundsBottom),void 0===l&&(l=this._boundsOwnGroup),this.setupWall(n,"left",t,e,1.5707963267948966,l),this.setupWall(r,"right",t+i,e,-1.5707963267948966,l),this.setupWall(s,"top",t,e,-3.141592653589793,l),this.setupWall(a,"bottom",t,e+o,0,l),this._boundsLeft=n,this._boundsRight=r,this._boundsTop=s,this._boundsBottom=a,this._boundsOwnGroup=l}},{key:"setupWall",value:function(t,e,i,o,n,r){if(console.log("setupWall",t,e,i,o,n,r),t){if(this.walls[e])this.walls[e].position=[this.pxmi(i),this.pxmi(o)];else{var s={mass:0,position:[this.pxmi(i),this.pxmi(o)],angle:n};console.log(e,s),this.walls[e]=new N.Body(s),this.walls[e].addShape(new N.Plane),this.world.addBody(this.walls[e]),console.log("add wall")}r&&(this.walls[e].shapes[0].collisionGroup=this.boundsCollisionGroup.mask,console.log("setCollisionGroup",this.boundsCollisionGroup.mask))}else this.walls[e]&&(this.world.removeBody(this.walls[e]),this.walls[e]=null)}},{key:"setWallMaterial",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e&&this.walls.left&&(this.walls.left.shapes[0].material=t),i&&this.walls.right&&(this.walls.right.shapes[0].material=t),o&&this.walls.top&&(this.walls.top.shapes[0].material=t),n&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=t)}},{key:"updateBoundsCollisionGroup",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=t?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;this.walls.left&&(this.walls.left.shapes[0].collisionGroup=e),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=e),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=e),this._boundsOwnGroup=t}},{key:"toJSON",value:function(){return this.world.toJSON()}},{key:"hitTest",value:function(t,e,i,o){void 0===e&&(e=this.world.bodies),void 0===i&&(i=5),void 0===o&&(o=!1);for(var n=[this.pxmi(t.x),this.pxmi(t.y)],r=[],s=e.length;s--;)e[s]instanceof h.default&&(!o||e[s].data.type!==N.Body.STATIC)?r.push(e[s].data):e[s]instanceof N.Body&&e[s].parent&&(!o||e[s].type!==N.Body.STATIC)?r.push(e[s]):e[s]instanceof Tiny.Sprite&&e[s].hasOwnProperty("body")&&(!o||e[s].body.data.type!==N.Body.STATIC)&&r.push(e[s].body.data);return this.world.hitTest(n,r,i)}},{key:"getBody",value:function(t){return t instanceof N.Body?t:t instanceof h.default?t.data:t.body&&t.body.type===R?t.body.data:null}},{key:"getBodies",value:function(){for(var t=[],e=this.world.bodies.length;e--;)t.push(this.world.bodies[e].parent);return t}},{key:"addSpring",value:function(t){return t instanceof m.default||t instanceof w.default?this.world.addSpring(t.data):this.world.addSpring(t),this.dispatch(q.ON_SPRING_ADDED,t),t}},{key:"createSpring",value:function(t,e,i,o,n,r,s,a,l){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addSpring(new m.default(this,t,e,i,o,n,r,s,a,l)):void console.warn("Cannot create Spring, invalid body objects given")}},{key:"createRotationalSpring",value:function(t,e,i,o,n){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addSpring(new w.default(this,t,e,i,o,n)):void console.warn("Cannot create Rotational Spring, invalid body objects given")}},{key:"removeSpring",value:function(t){return t instanceof m.default||t instanceof w.default?this.world.removeSpring(t.data):this.world.removeSpring(t),this.dispatch(q.ON_SPRING_REMOVED,t),t}},{key:"getSprings",value:function(){for(var t=[],e=this.world.springs.length;e--;)t.push(this.world.springs[e].parent);return t}},{key:"getConstraints",value:function(){for(var t=[],e=this.world.constraints.length;e--;)t.push(this.world.constraints[e]);return t}},{key:"createLockConstraint",value:function(t,e,i,o,n){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new x.default(this,t,e,i,o,n)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"createDistanceConstraint",value:function(t,e,i,o,n,r){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new B.default(this,t,e,i,o,n,r)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"createGearConstraint",value:function(t,e,i,o){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new _.default(this,t,e,i,o)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"createRevoluteConstraint",value:function(t,e,i,o,n,r){return t=this.getBody(t),i=this.getBody(i),t&&i?this.addConstraint(new P.default(this,t,e,i,o,n,r)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"createPrismaticConstraint",value:function(t,e,i,o,n,r,s){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new O.default(this,t,e,i,o,n,r,s)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"addConstraint",value:function(t){return this.world.addConstraint(t),this.dispatch(q.ON_CONSTRAIN_ADDED,t),t}},{key:"removeConstraint",value:function(t){return this.world.removeConstraint(t),this.dispatch(q.ON_CONSTRAIN_REMOVED,t),t}},{key:"addContactMaterial",value:function(t){return this.world.addContactMaterial(t),this.dispatch(q.ON_CONTACTMATERIAL_ADDED,t),t}},{key:"removeContactMaterial",value:function(t){return this.world.removeContactMaterial(t),this.dispatch(q.ON_CONTACTMATERIAL_REMOVED,t),t}},{key:"getContactMaterial",value:function(t,e){return this.world.getContactMaterial(t,e)}},{key:"setMaterial",value:function(t,e){for(var i=e.length;i--;)e[i].setMaterial(t)}},{key:"createMaterial",value:function(t,e){t=t||"";var i=new F.default(t);return this.materials.push(i),"undefined"!=typeof e&&e.setMaterial(i),i}},{key:"createContactMaterial",value:function(t,e,i){void 0===t&&(t=this.createMaterial()),void 0===e&&(e=this.createMaterial());var o=new T.default(t,e,i);return this.addContactMaterial(o)}},{key:"createCollisionGroup",value:function(t){var e=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|e),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|e),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|e),this._collisionGroupID++;var i=new f.default(e);return this.collisionGroups.push(i),t&&this.setCollisionGroup(t,i),i}},{key:"setCollisionGroup",value:function(t,e){if(t instanceof p.default)for(var i=0;i<t.total;i++)t.children[i].body&&t.children[i].body.type===R&&t.children[i].body.setCollisionGroup(e);else t.body.setCollisionGroup(e)}},{key:"impactHandler",value:function(t){if(t.bodyA.parent&&t.bodyB.parent){var e=t.bodyA.parent,i=t.bodyB.parent;e._bodyCallbacks[t.bodyB.id]&&e._bodyCallbacks[t.bodyB.id].call(e._bodyCallbackContext[t.bodyB.id],e,i,t.shapeA,t.shapeB),i._bodyCallbacks[t.bodyA.id]&&i._bodyCallbacks[t.bodyA.id].call(i._bodyCallbackContext[t.bodyA.id],i,e,t.shapeB,t.shapeA),e._groupCallbacks[t.shapeB.collisionGroup]&&e._groupCallbacks[t.shapeB.collisionGroup].call(e._groupCallbackContext[t.shapeB.collisionGroup],e,i,t.shapeA,t.shapeB),i._groupCallbacks[t.shapeA.collisionGroup]&&i._groupCallbacks[t.shapeA.collisionGroup].call(i._groupCallbackContext[t.shapeA.collisionGroup],i,e,t.shapeB,t.shapeA)}}},{key:"setupImpactEvents",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._impactEvents!==t&&(t?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this),this._impactEvents=t)}},{key:"paused",get:function(){return this._paused}},{key:"friction",get:function(){return this.world.defaultContactMaterial.friction},set:function(t){this.world.defaultContactMaterial.friction=t}},{key:"restitution",get:function(){return this.world.defaultContactMaterial.restitution},set:function(t){this.world.defaultContactMaterial.restitution=t}},{key:"defaultContactMaterial",get:function(){return this.world.defaultContactMaterial},set:function(t){this.world.defaultContactMaterial=t}},{key:"applySpringForces",get:function(){return this.world.applySpringForces},set:function(t){this.world.applySpringForces=t}},{key:"applyDamping",get:function(){return this.world.applyDamping},set:function(t){this.world.applyDamping=t}},{key:"applyGravity",get:function(){return this.world.applyGravity},set:function(t){this.world.applyGravity=t}},{key:"solveConstraints",get:function(){return this.world.solveConstraints},set:function(t){this.world.solveConstraints=t}},{key:"time",get:function(){return this.world.time}},{key:"emitImpactEvent",get:function(){return this.world.emitImpactEvent},set:function(t){this.world.emitImpactEvent=t}},{key:"sleepMode",get:function(){return this.world.sleepMode},set:function(t){this.world.sleepMode=t}},{key:"bodyCount",get:function(){return this.world.bodies.length}}]),e}(Tiny.EventEmitter);e.default=G},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),c=i(6),h=n(c),u=i(7),p=o(u),d=i(8),f=n(d),v=i(9),y=1,g=2,m=function(t){function e(t,i,o,n,a){r(this,e);var l=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i=i||null,o=o||0,n=n||0,void 0===a&&(a=1),l.world=t,l.app=l.world.app,l.sprite=i,l.type="Tiny.Physics.P2.Body",l.offset=new Tiny.Point,l.data=new v.Body({position:[l.world.pxmi(o),l.world.pxmi(n)],mass:a}),l.data.parent=l,l.velocity=new h.default(l.world,l.data.velocity),l.force=new h.default(l.world,l.data.force),l.collidesWith=[],l.removeNextStep=!1,l.debugBody=null,l.dirty=!1,l._collideWorldBounds=!0,l._bodyCallbacks={},l._bodyCallbackContext={},l._groupCallbacks={},l._groupCallbackContext={},l._reset=!1,i&&l.setRectangleFromSprite(i),l}return a(e,t),l(e,[{key:"getCollisionMask",value:function(){var t=0;this._collideWorldBounds&&(t=this.world.boundsCollisionGroup.mask);for(var e=0;e<this.collidesWith.length;e++)t|=this.collidesWith[e].mask;return t}},{key:"updateCollisionMask",value:function(t){var e=this.getCollisionMask();if(void 0===t)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionMask=e;else t.collisionMask=e}},{key:"setCollisionGroup",value:function(t,e){var i=this.getCollisionMask();if(void 0===e)for(var o=this.data.shapes.length-1;o>=0;o--)this.data.shapes[o].collisionGroup=t.mask,this.data.shapes[o].collisionMask=i;else e.collisionGroup=t.mask,e.collisionMask=i}},{key:"clearCollision",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments[2];if(void 0===i)for(var o=this.data.shapes.length-1;o>=0;o--)t&&(this.data.shapes[o].collisionGroup=null),e&&(this.data.shapes[o].collisionMask=null);else t&&(i.collisionGroup=null),e&&(i.collisionMask=null);t&&(this.collidesWith.length=0)}},{key:"removeCollisionGroup",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments[2],o=void 0;if(Array.isArray(t))for(var n=0;n<t.length;n++)o=this.collidesWith.indexOf(t[n]),o>-1&&(this.collidesWith.splice(o,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));else o=this.collidesWith.indexOf(t),o>-1&&(this.collidesWith.splice(o,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));var r=this.getCollisionMask();if(void 0===i)for(var s=this.data.shapes.length-1;s>=0;s--)this.data.shapes[s].collisionMask=r;else i.collisionMask=r}},{key:"collides",value:function(t,e,i,o){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.collidesWith.indexOf(t[n])===-1&&(this.collidesWith.push(t[n]),e&&this.createGroupCallback(t[n],e,i));else this.collidesWith.indexOf(t)===-1&&(this.collidesWith.push(t),e&&this.createGroupCallback(t,e,i));var r=this.getCollisionMask();if(void 0===o)for(var s=this.data.shapes.length-1;s>=0;s--)this.data.shapes[s].collisionMask=r;else o.collisionMask=r}},{key:"createBodyCallback",value:function(t,e,i){var o=-1;t.id?o=t.id:t.body&&(o=t.body.id),o>-1&&(null===e?(delete this._bodyCallbacks[o],delete this._bodyCallbackContext[o]):(this._bodyCallbacks[o]=e,this._bodyCallbackContext[o]=i))}},{key:"createGroupCallback",value:function(t,e,i){null===e?(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]):(this._groupCallbacks[t.mask]=e,this._groupCallbackContext[t.mask]=i)}},{key:"applyDamping",value:function(t){this.data.applyDamping(t)}},{key:"applyImpulse",value:function(t,e,i){this.data.applyImpulse(t,[this.world.pxmi(e),this.world.pxmi(i)])}},{key:"applyImpulseLocal",value:function(t,e,i){this.data.applyImpulseLocal(t,[this.world.pxmi(e),this.world.pxmi(i)])}},{key:"applyForce",value:function(t,e,i){this.data.applyForce(t,[this.world.pxmi(e),this.world.pxmi(i)])}},{key:"addRectangle",value:function(t,e,i,o,n){var r=new v.Box({width:this.world.pxm(t),height:this.world.pxm(e)});return this.addShape(r,i,o,n)}},{key:"addPolygon",value:function(t,e){t=t||{},Array.isArray(e)||(e=Array.prototype.slice.call(arguments,1));var i=[];if(1===e.length&&Array.isArray(e[0]))i=e[0].slice(0);else if(Array.isArray(e[0]))i=e.slice();else if("number"==typeof e[0])for(var o=0,n=e.length;o<n;o+=2)i.push([e[o],e[o+1]]);var r=i.length-1;i[r][0]===i[0][0]&&i[r][1]===i[0][1]&&i.pop();for(var s=0;s<i.length;s++)i[s][0]=this.world.pxmi(i[s][0]),i[s][1]=this.world.pxmi(i[s][1]);var a=this.data.fromPolygon(i,t);return this.shapeChanged(),a}},{key:"addCircle",value:function(t,e,i,o){var n=new v.Circle({radius:this.world.pxm(t)});return this.addShape(n,e,i,o)}},{key:"addPlane",value:function(t,e,i){var o=new v.Plane;return this.addShape(o,t,e,i)}},{key:"addParticle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=new v.Particle;return this.addShape(o,t,e,i)}},{key:"addLine",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=new v.Line({length:this.world.pxm(t)});return this.addShape(n,e,i,o)}},{key:"addCapsule",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=new v.Capsule({length:this.world.pxm(t),radius:this.world.pxm(e)});return this.addShape(r,i,o,n)}},{key:"addShape",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.data.addShape(t,[this.world.pxmi(e),this.world.pxmi(i)],o),this.shapeChanged(),t}},{key:"removeShape",value:function(t){var e=this.data.removeShape(t);return this.shapeChanged(),e}},{key:"setCircle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clearShapes(),this.addCircle(t,e,i,o)}},{key:"setRectangle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return this.clearShapes(),this.addRectangle(t,e,i,o,n)}},{key:"setRectangleFromSprite",value:function(t){return void 0===t&&(t=this.sprite),this.clearShapes(),this.addRectangle(t.width,t.height,0,0,t.rotation)}},{key:"setMaterial",value:function(t,e){if(void 0===e)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].material=t;else e.material=t}},{key:"loadPolygon",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&this.clearShapes();for(var i=t,o=v.vec2.create(),n=0;n<i.length;n++){for(var r=[],s=0;s<i[n].shape.length;s+=2)r.push([this.world.pxmi(i[n].shape[s]),this.world.pxmi(i[n].shape[s+1])]);for(var a=new v.Convex({vertices:r}),l=0;l!==a.vertices.length;l++){var c=a.vertices[l];v.vec2.sub(c,c,a.centerOfMass)}v.vec2.scale(o,a.centerOfMass,1),o[0]-=this.world.pxmi(this.sprite.width/2),o[1]-=this.world.pxmi(this.sprite.height/2),a.updateTriangles(),a.updateCenterOfMass(),a.updateBoundingRadius(),this.data.addShape(a,o)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},{key:"clearShapes",value:function(){for(var t=this.data.shapes.length;t--;)this.data.removeShape(this.data.shapes[t]);this.shapeChanged()}},{key:"shapeChanged",value:function(){this.debugBody&&this.debugBody.draw(),this.dispatch("shapeChanged",this)}},{key:"preUpdate",value:function(){this.dirty=!0,this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)}},{key:"postUpdate",value:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x,this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y,this.fixedRotation?this.data.angle=this.sprite.rotation:this.sprite.rotation=this.data.angle,this.debugBody&&this.debugBody.updateSpriteTransform(),this.dirty=!1}},{key:"addToWorld",value:function(){this.world.addBody(this)}},{key:"removeFromWorld",value:function(){this.data.world===this.world.world&&this.world.removeBodyNextStep(this)}},{key:"destroy",value:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(!0,!0),this.debugBody=null,this.sprite&&(this.sprite.body=null,this.sprite=null)}},{key:"dispatch",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];this.emit.apply(this,arguments)}},{key:"setZeroForce",value:function(){this.data.setZeroForce()}},{key:"setZeroRotation",value:function(){this.data.angularVelocity=0}},{key:"setZeroVelocity",value:function(){this.data.velocity[0]=0,this.data.velocity[1]=0}},{key:"setZeroDamping",value:function(){this.damping=0,this.angularDamping=0}},{key:"moveForward",value:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.velocity[0]=e*Math.cos(i),this.data.velocity[1]=e*Math.sin(i)}},{key:"moveBackward",value:function(t){var e=this.world.pxmi(-t),i=this.data.angle+Math.PI/2;this.data.velocity[0]=-(e*Math.cos(i)),this.data.velocity[1]=-(e*Math.sin(i))}},{key:"moveLeft",value:function(t){this.data.velocity[0]=this.world.pxmi(-t)}},{key:"moveRight",value:function(t){this.data.velocity[0]=this.world.pxmi(t)}},{key:"moveUp",value:function(t){this.data.velocity[1]=this.world.pxmi(-t)}},{key:"moveDown",value:function(t){this.data.velocity[1]=this.world.pxmi(t)}},{key:"angle",get:function(){return p.wrapAngle(p.radToDeg(this.data.angle))},set:function(t){this.data.angle=p.degToRad(p.wrapAngle(t))}},{key:"mass",get:function(){return this.data.mass},set:function(t){t!==this.data.mass&&(this.data.mass=t,this.data.updateMassProperties())}},{key:"static",get:function(){return this.data.type===g},set:function(t){t&&this.data.type!==g?(this.data.type=g,this.mass=0):t||this.data.type!==g||(this.data.type=y,this.mass=1)}},{key:"allowSleep",get:function(){return this.data.allowSleep},set:function(t){t!==this.data.allowSleep&&(this.data.allowSleep=t)}},{key:"angularVelocity",get:function(){return this.data.angularVelocity},set:function(t){this.data.angularVelocity=t}},{key:"fixedRotation",get:function(){return this.data.fixedRotation},set:function(t){t!==this.data.fixedRotation&&(this.data.fixedRotation=t)}},{key:"inertia",get:function(){return this.data.inertia},set:function(t){this.data.inertia=t}},{key:"x",get:function(){return this.world.mpxi(this.data.position[0])},set:function(t){this.data.position[0]=this.world.pxmi(t)}},{key:"y",get:function(){return this.world.mpxi(this.data.position[1])},set:function(t){this.data.position[1]=this.world.pxmi(t)}},{key:"id",get:function(){return this.data.id}},{key:"damping",get:function(){return this.data.damping},set:function(t){this.data.damping=t}},{key:"angularDamping",get:function(){return this.data.angularDamping},set:function(t){this.data.angularDamping=t}},{key:"sleepSpeedLimit",get:function(){return this.data.sleepSpeedLimit},set:function(t){this.data.sleepSpeedLimit=t}},{key:"debug",get:function(){return null!==this.debugBody},set:function(t){t&&!this.debugBody?this.debugBody=new f.default(this):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}},{key:"collideWorldBounds",get:function(){return this._collideWorldBounds},set:function(t){t&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!t&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}]),e}(Tiny.EventEmitter);e.default=m},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),n=function(){function t(e,o){i(this,t),this.world=e,this.destination=o}return o(t,[{key:"x",get:function(){return this.world.mpxi(this.destination[0])},set:function(t){this.destination[0]=this.world.pxmi(t)}},{key:"y",get:function(){return this.world.mpxi(this.destination[1])},set:function(t){this.destination[1]=this.world.pxmi(t)}},{key:"mx",get:function(){return this.destination[0]},set:function(t){this.destination[0]=-t}},{key:"my",get:function(){return this.destination[1]},set:function(t){
this.destination[1]=-t}}]),t}();e.default=n},function(t,e){"use strict";function i(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)}function o(t,e,i){var o=i-e;if(o<=0)return 0;var n=(t-e)%o;return n<0&&(n+=o),n+e}function n(t){return t*c}function r(t){return t*h}function s(t,e,i,o){var n=t-i,r=e-o;return Math.sqrt(n*n+r*r)}function a(t,e,i,o){return Math.atan2(o-e,i-t)}function l(t,e,i){return t<e?e:i<t?i:t}Object.defineProperty(e,"__esModule",{value:!0}),e.wrapAngle=i,e.wrap=o,e.degToRad=n,e.radToDeg=r,e.distance=s,e.angle=a,e.clamp=l;var c=Math.PI/180,h=180/Math.PI},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),l=i(3),c=o(l),h=i(9),u=function(t){function e(t,i){n(this,e);var o=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),s=t.world,a={pixelsPerLengthUnit:s.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5,lineColor:16711680,fill:.5,fillColor:16711680};if(o.settings=c.extend(a,i),o.ppu=o.settings.pixelsPerLengthUnit,o.ppu=-1*o.ppu,o.world=s,o.body=t,o.p2body=t.data,o.canvas=new Tiny.Graphics,o.canvas.alpha=o.settings.alpha,o.addChild(o.canvas),void 0===o.world.app.stageDebugLayer){var l=new Tiny.Container;l.scale.set(Tiny.config.multiplier),o.world.app.camera.addChild(l),o.world.app.stageDebugLayer=l}if(void 0===o.world.app.stageDebugLayer.p2){var h=new Tiny.Container;o.world.app.stageDebugLayer.addChild(h),o.world.app.stageDebugLayer.p2=h}return o.world.app.stageDebugLayer.p2.addChild(o),o.draw(),o.updateSpriteTransform(),o}return s(e,t),a(e,[{key:"updateSpriteTransform",value:function(){this.position.x=this.body.x,this.position.y=this.body.y,this.rotation=this.body.sprite.rotation}},{key:"draw",value:function(){var t=void 0,e=void 0,i=void 0,o=void 0,n=void 0,r=void 0,s=void 0,a=void 0,l=void 0,u=void 0,p=void 0,d=void 0,f=void 0,v=void 0,y=void 0;if(a=this.p2body,u=this.canvas,u.clear(),i=parseInt(c.randomPastelHex(),16),r=this.settings.lineColor,s=this.settings.lineWidth,a instanceof h.Body&&a.shapes.length){var g=a.shapes.length;for(o=0;o!==g;){if(e=a.shapes[o],l=e.position||0,t=e.angle||0,e instanceof h.Circle)this.drawCircle(u,l[0]*this.ppu,l[1]*this.ppu,t,e.radius*this.ppu,i,s);else if(e instanceof h.Capsule)this.drawCapsule(u,l[0]*this.ppu,l[1]*this.ppu,t,e.length*this.ppu,e.radius*this.ppu,r,i,s);else if(e instanceof h.Plane)this.drawPlane(u,l[0]*this.ppu,-l[1]*this.ppu,i,r,5*s,10*s,10*s,100*this.ppu,t);else if(e instanceof h.Line)this.drawLine(u,e.length*this.ppu,r,s);else if(e instanceof h.Box)this.drawRectangle(u,l[0]*this.ppu,l[1]*this.ppu,t,e.width*this.ppu,e.height*this.ppu,r,i,s);else if(e instanceof h.Convex){for(d=[],f=h.vec2.create(),n=v=0,y=e.vertices.length;0<=y?v<y:v>y;n=0<=y?++v:--v)p=e.vertices[n],h.vec2.rotate(f,p,t),d.push([(f[0]+l[0])*this.ppu,-(f[1]+l[1])*this.ppu]);this.drawConvex(u,d,e.triangles,r,i,s,this.settings.debugPolygons,[l[0]*this.ppu,-l[1]*this.ppu])}else console.log("[BodyDebug] >> not defined");o++}}}},{key:"drawRectangle",value:function(t,e,i,o,n,r){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=(arguments[7],arguments.length>8&&void 0!==arguments[8]?arguments[8]:1);n=-n,r=-r,t.lineStyle(a,s,1),t.beginFill(16711680),t.drawRect(e-n/2,i-r/2,n,r),console.log("[BodyDebug] >> drawRectangles",e-n/2,i-r/2,n,r)}},{key:"drawCircle",value:function(t,e,i,o,n){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16777215,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;t.lineStyle(s,0,1),t.beginFill(r,1),t.drawCircle(e,i,-n),t.endFill(),t.moveTo(e,i),t.lineTo(e+n*Math.cos(-o),i+n*Math.sin(-o)),console.log("[BodyDebug] >> drawCircle",e,i,-n)}},{key:"drawLine",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.lineStyle(5*o,i,1),t.moveTo(-e/2,0),t.lineTo(e/2,0),console.log("[BodyDebug] >> drawLine",-e/2,0,e/2,0)}},{key:"drawConvex",value:function(t,e,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments[6],a=arguments[7],l=void 0,c=void 0,h=void 0,u=void 0,p=void 0,d=void 0,f=void 0,v=void 0,y=void 0,g=void 0,m=void 0;if(s){for(l=[16711680,65280,255],c=0;c!==e.length+1;)u=e[c%e.length],p=e[(c+1)%e.length],f=u[0],g=u[1],v=p[0],m=p[1],t.lineStyle(r,l[c%l.length],1),t.moveTo(f,-g),t.lineTo(v,-m),t.drawCircle(f,-g,2*r),c++;return t.lineStyle(r,0,1),t.drawCircle(a[0],a[1],2*r)}for(t.lineStyle(r,o,1),t.beginFill(n),c=0;c!==e.length;)h=e[c],d=h[0],y=h[1],0===c?t.moveTo(d,-y):t.lineTo(d,-y),c++;return t.endFill(),e.length>2?(t.moveTo(e[e.length-1][0],-e[e.length-1][1]),t.lineTo(e[0][0],-e[0][1])):void console.log("[BodyDebug] >> drawConvex")}},{key:"drawPath",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=void 0,s=void 0,a=void 0,l=void 0,c=void 0,h=void 0,u=void 0,p=void 0,d=void 0,f=void 0,v=void 0,y=void 0,g=void 0;for(t.lineStyle(n,i,1),"number"==typeof o&&t.beginFill(o),a=null,l=null,s=0;s<e.length;)v=e[s],y=v[0],g=v[1],y===a&&g===l||(0===s?t.moveTo(y,g):(c=a,h=l,u=y,p=g,d=e[(s+1)%e.length][0],f=e[(s+1)%e.length][1],r=(u-c)*(f-h)-(d-c)*(p-h),0!==r&&t.lineTo(y,g)),a=y,l=g),s++;"number"==typeof o&&t.endFill(),e.length>2&&"number"==typeof o&&(t.moveTo(e[e.length-1][0],e[e.length-1][1]),t.lineTo(e[0][0],e[0][1])),console.log("[BodyDebug] >> drawPath")}},{key:"drawPlane",value:function(t,e,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16777215,n=arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=(arguments[6],arguments[7],arguments[8]),a=arguments[9],l=void 0,c=void 0,h=void 0;t.lineStyle(r,n,11),t.beginFill(o),l=s,t.moveTo(e,-i),c=e+Math.cos(a)*this.game.width,h=i+Math.sin(a)*this.game.height,t.lineTo(c,-h),t.moveTo(e,-i),c=e+Math.cos(a)*-this.game.width,h=i+Math.sin(a)*-this.game.height,t.lineTo(c,-h),console.log("[BodyDebug] >> drawPlane")}},{key:"drawCapsule",value:function(t,e,i,o,n,r){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1;t.lineStyle(l,s,1);var c=Math.cos(o),h=Math.sin(o);t.beginFill(a,1),t.drawCircle(-n/2*c+e,-n/2*h+i,2*-r),t.drawCircle(n/2*c+e,n/2*h+i,2*-r),t.endFill(),t.lineStyle(l,s,0),t.beginFill(a,1),t.moveTo(-n/2*c+r*h+e,-n/2*h+r*c+i),t.lineTo(n/2*c+r*h+e,n/2*h+r*c+i),t.lineTo(n/2*c-r*h+e,n/2*h-r*c+i),t.lineTo(-n/2*c-r*h+e,-n/2*h-r*c+i),t.endFill(),t.lineStyle(l,s,1),t.moveTo(-n/2*c+r*h+e,-n/2*h+r*c+i),t.lineTo(n/2*c+r*h+e,n/2*h+r*c+i),t.moveTo(-n/2*c-r*h+e,-n/2*h-r*c+i),t.lineTo(n/2*c-r*h+e,n/2*h-r*c+i),console.log("[BodyDebug] >> drawCapsule")}},{key:"destroy",value:function(){this.canvas&&(this.removeChild(this.canvas),this.world.app.stage.addChild(this),this.canvas=null)}}]),e}(Tiny.Sprite);e.default=u},function(t,e,i){"use strict";t.exports={AABB:i(10),AngleLockEquation:i(13),Body:i(15),Broadphase:i(27),Capsule:i(28),Circle:i(29),Constraint:i(30),ContactEquation:i(31),ContactEquationPool:i(32),ContactMaterial:i(34),Convex:i(21),DistanceConstraint:i(36),Equation:i(14),EventEmitter:i(26),FrictionEquation:i(37),FrictionEquationPool:i(38),GearConstraint:i(39),GSSolver:i(40),Heightfield:i(42),Line:i(43),LockConstraint:i(44),Material:i(35),Narrowphase:i(45),NaiveBroadphase:i(48),Particle:i(49),Plane:i(50),Pool:i(33),RevoluteConstraint:i(51),PrismaticConstraint:i(54),Ray:i(25),RaycastResult:i(24),Box:i(47),RotationalVelocityEquation:i(52),SAPBroadphase:i(55),Shape:i(22),Solver:i(41),Spring:i(56),TopDownVehicle:i(57),LinearSpring:i(58),RotationalSpring:i(59),Utils:i(12),World:i(60),vec2:i(11),version:"0.7.1"}},function(t,e,i){"use strict";function o(t){t=t||{},this.lowerBound=t.lowerBound?n.clone(t.lowerBound):n.create(),this.upperBound=t.upperBound?n.clone(t.upperBound):n.create()}var n=i(11);t.exports=o;var r=n.create();o.prototype.setFromPoints=function(t,e,i,o){var s=this.lowerBound,a=this.upperBound;i=i||0,0!==i?n.rotate(s,t[0],i):n.copy(s,t[0]),n.copy(a,s);for(var l=Math.cos(i),c=Math.sin(i),h=1;h<t.length;h++){var u=t[h];if(0!==i){var p=u[0],d=u[1];r[0]=l*p-c*d,r[1]=c*p+l*d,u=r}for(var f=0;f<2;f++)u[f]>a[f]&&(a[f]=u[f]),u[f]<s[f]&&(s[f]=u[f])}e&&(n.add(s,s,e),n.add(a,a,e)),o&&(s[0]-=o,s[1]-=o,a[0]+=o,a[1]+=o)},o.prototype.copy=function(t){n.copy(this.lowerBound,t.lowerBound),n.copy(this.upperBound,t.upperBound)},o.prototype.extend=function(t){for(var e=this.lowerBound,i=this.upperBound,o=2;o--;){var n=t.lowerBound[o];e[o]>n&&(e[o]=n);var r=t.upperBound[o];i[o]<r&&(i[o]=r)}},o.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,o=t.lowerBound,n=t.upperBound;return(o[0]<=i[0]&&i[0]<=n[0]||e[0]<=n[0]&&n[0]<=i[0])&&(o[1]<=i[1]&&i[1]<=n[1]||e[1]<=n[1]&&n[1]<=i[1])},o.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]},o.prototype.overlapsRay=function(t){var e=1/t.direction[0],i=1/t.direction[1],o=t.from,n=this.lowerBound,r=this.upperBound,s=(n[0]-o[0])*e,a=(r[0]-o[0])*e,l=(n[1]-o[1])*i,c=(r[1]-o[1])*i,h=Math.max(Math.max(Math.min(s,a),Math.min(l,c))),u=Math.min(Math.min(Math.max(s,a),Math.max(l,c)));return u<0?-1:h>u?-1:h/t.length}},function(t,e,i){"use strict";var o=t.exports={},n=i(12);o.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},o.crossVZ=function(t,e,i){return o.rotate(t,e,-Math.PI/2),o.scale(t,t,i),t},o.crossZV=function(t,e,i){return o.rotate(t,i,Math.PI/2),o.scale(t,t,e),t},o.rotate=function(t,e,i){if(0!==i){var o=Math.cos(i),n=Math.sin(i),r=e[0],s=e[1];t[0]=o*r-n*s,t[1]=n*r+o*s}else t[0]=e[0],t[1]=e[1];return t},o.rotate90cw=function(t,e){var i=e[0],o=e[1];return t[0]=o,t[1]=-i,t},o.toLocalFrame=function(t,e,i,o){var n=Math.cos(-o),r=Math.sin(-o),s=e[0]-i[0],a=e[1]-i[1];return t[0]=n*s-r*a,t[1]=r*s+n*a,t},o.toGlobalFrame=function(t,e,i,o){var n=Math.cos(o),r=Math.sin(o),s=e[0],a=e[1],l=i[0],c=i[1];t[0]=n*s-r*a+l,t[1]=r*s+n*a+c},o.vectorToLocalFrame=function(t,e,i){var o=Math.cos(-i),n=Math.sin(-i),r=e[0],s=e[1];return t[0]=o*r-n*s,t[1]=n*r+o*s,t},o.vectorToGlobalFrame=o.rotate,o.centroid=function(t,e,i,n){return o.add(t,e,i),o.add(t,t,n),o.scale(t,t,1/3),t},o.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},o.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},o.fromValues=function(t,e){var i=new n.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},o.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},o.set=function(t,e,i){return t[0]=e,t[1]=i,t},o.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},o.sub=o.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},o.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},o.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},o.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},o.distance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(i*i+o*o)},o.squaredDistance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o},o.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},o.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},o.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},o.normalize=function(t,e){var i=e[0],o=e[1],n=i*i+o*o;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},o.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},o.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},o.lerp=function(t,e,i,o){var n=e[0],r=e[1];return t[0]=n+o*(i[0]-n),t[1]=r+o*(i[1]-r),t},o.reflect=function(t,e,i){var o=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*o,t[1]=e[1]-2*i[1]*o},o.getLineSegmentsIntersection=function(t,e,i,n,r){var s=o.getLineSegmentsIntersectionFraction(e,i,n,r);return!(s<0)&&(t[0]=e[0]+s*(i[0]-e[0]),t[1]=e[1]+s*(i[1]-e[1]),!0)},o.getLineSegmentsIntersectionFraction=function(t,e,i,o){var n,r,s=e[0]-t[0],a=e[1]-t[1],l=o[0]-i[0],c=o[1]-i[1];return n=(-a*(t[0]-i[0])+s*(t[1]-i[1]))/(-l*a+s*c),r=(l*(t[1]-i[1])-c*(t[0]-i[0]))/(-l*a+s*c),n>=0&&n<=1&&r>=0&&r<=1?r:-1}},function(t,e){"use strict";function i(){}t.exports=i,i.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var i=0,o=e.length;i!==o;++i)t.push(e[i])},i.splice=function(t,e,i){i=i||1;for(var o=e,n=t.length-i;o<n;o++)t[o]=t[o+i];t.length=n},i.arrayRemove=function(t,e){var o=t.indexOf(e);o!==-1&&i.splice(t,o,1)},"undefined"!=typeof P2_ARRAY_TYPE?i.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?i.ARRAY_TYPE=Float32Array:i.ARRAY_TYPE=Array,i.extend=function(t,e){for(var i in e)t[i]=e[i]},i.shallowClone=function(t){var e={};return i.extend(e,t),e},i.defaults=function(t,e){console.warn("Utils.defaults is deprecated."),t=t||{};for(var i in e)i in t||(t[i]=e[i]);return t}},function(t,e,i){"use strict";function o(t,e,i){i=i||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0,this.ratio=void 0!==i.ratio?i.ratio:1,this.setRatio(this.ratio)}var n=i(14);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},o.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},o.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},function(t,e,i){"use strict";function o(t,e,i,n){this.minForce=void 0===i?-Number.MAX_VALUE:i,this.maxForce=void 0===n?Number.MAX_VALUE:n,this.maxBias=Number.MAX_VALUE,this.bodyA=t,this.bodyB=e,this.stiffness=o.DEFAULT_STIFFNESS,this.relaxation=o.DEFAULT_RELAXATION,this.G=new c.ARRAY_TYPE(6);for(var r=0;r<6;r++)this.G[r]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0,this.lambda=this.B=this.invC=this.minForceDt=this.maxForceDt=0,this.index=-1}function n(t,e,i,o,n,r){t[0]+=e*o*n*r[0],t[1]+=i*o*n*r[1]}t.exports=o;var r=i(11),s=r.scale,a=r.multiply,l=r.create,c=i(12);o.DEFAULT_STIFFNESS=1e6,o.DEFAULT_RELAXATION=4;var h=l(),u=l(),p=l(),d=l();o.prototype={update:function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(i*i*t*(1+4*e)),this.needsUpdate=!1},gmult:function(t,e,i,o,n){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*o[0]+t[4]*o[1]+t[5]*n},computeB:function(t,e,i){var o=this.computeGW(),n=this.computeGq(),r=this.maxBias;Math.abs(n)>r&&(n=n>0?r:-r);var s=this.computeGiMf(),a=-n*t-o*e-s*i;return a},computeGq:function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.angle,n=i.angle;return this.gmult(t,h,o,u,n)+this.offset},computeGW:function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,n=i.velocity,r=e.angularVelocity,s=i.angularVelocity;return this.gmult(t,o,r,n,s)+this.relativeVelocity},computeGWlambda:function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.vlambda,n=i.vlambda,r=e.wlambda,s=i.wlambda;return this.gmult(t,o,r,n,s)},computeGiMf:function(){var t=this.bodyA,e=this.bodyB,i=t.force,o=t.angularForce,n=e.force,r=e.angularForce,l=t.invMassSolve,c=e.invMassSolve,h=t.invInertiaSolve,u=e.invInertiaSolve,f=this.G;return s(p,i,l),a(p,t.massMultiplier,p),s(d,n,c),a(d,e.massMultiplier,d),this.gmult(f,p,o*h,d,r*u)},computeGiMGt:function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,o=e.invMassSolve,n=t.invInertiaSolve,r=e.invInertiaSolve,s=this.G;return s[0]*s[0]*i*t.massMultiplier[0]+s[1]*s[1]*i*t.massMultiplier[1]+s[2]*s[2]*n+s[3]*s[3]*o*e.massMultiplier[0]+s[4]*s[4]*o*e.massMultiplier[1]+s[5]*s[5]*r},addToWlambda:function(t){var e=this.bodyA,i=this.bodyB,o=e.invMassSolve,r=i.invMassSolve,s=e.invInertiaSolve,a=i.invInertiaSolve,l=this.G;n(e.vlambda,l[0],l[1],o,t,e.massMultiplier),e.wlambda+=s*l[2]*t,n(i.vlambda,l[3],l[4],r,t,i.massMultiplier),i.wlambda+=a*l[5]*t},computeInvC:function(t){var e=1/(this.computeGiMGt()+t);return e}}},function(t,e,i){"use strict";function o(t){t=t||{},d.call(this),this.id=t.id||++o._idCounter,this.index=-1,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=a(),this.position=t.position?n.clone(t.position):a(),this.interpolatedPosition=n.clone(this.position),this.previousPosition=n.clone(this.position),this.velocity=t.velocity?n.clone(t.velocity):a(),this.vlambda=a(),this.wlambda=0,this.angle=t.angle||0,this.previousAngle=this.angle,this.interpolatedAngle=this.angle,this.angularVelocity=t.angularVelocity||0,this.force=t.force?n.clone(t.force):a(),this.angularForce=t.angularForce||0,this.damping=void 0!==t.damping?t.damping:.1,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.1,this.type=o.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=o.DYNAMIC:this.type=o.STATIC,this.boundingRadius=0,this.aabb=new p,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=o.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.islandId=-1,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var n=i(11),r=n.add,s=n.subtract,a=n.create,l=i(16),c=i(21),h=i(24),u=i(25),p=i(10),d=i(26);t.exports=o,o.prototype=new d,o.prototype.constructor=o,o._idCounter=0;var f={type:"sleepy"},v={type:"sleep"},y={type:"wakeup"};o.prototype.updateSolveMassProperties=function(){this.sleepState===o.SLEEPING||this.type===o.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},o.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},o.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},o.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var g=new p,m=a();o.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,i=m,o=this.angle,r=0;r!==e;r++){var s=t[r],a=s.angle+o;n.toGlobalFrame(i,s.position,this.position,o),s.computeAABB(g,i,a),0===r?this.aabb.copy(g):this.aabb.extend(g)}this.aabbNeedsUpdate=!1},o.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,i=0,o=0;o!==e;o++){var r=t[o],s=n.length(r.position),a=r.boundingRadius;s+a>i&&(i=s+a)}this.boundingRadius=i},o.prototype.addShape=function(t,e,i){if(t.body)throw new Error("A shape can only be added to one body.");var o=this.world;if(o&&o.stepping)throw new Error("A shape cannot be added during step.");t.body=this,e?n.copy(t.position,e):n.set(t.position,0,0),t.angle=i||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},o.prototype.removeShape=function(t){var e=this.world;if(e&&e.stepping)throw new Error("A shape cannot be removed during step.");var i=this.shapes.indexOf(t);return i!==-1&&(this.shapes.splice(i,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},o.prototype.updateMassProperties=function(){if(this.type===o.STATIC||this.type===o.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,i=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var r=0;r<e;r++){var s=t[r],a=n.squaredLength(s.position),l=s.computeMomentOfInertia();i+=l+a}this.inertia=this.mass*i,this.invInertia=i>0?1/i:0}this.invMass=1/this.mass,n.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},o.prototype.applyForce=function(t,e){if(r(this.force,this.force,t),e){var i=n.crossLength(e,t);this.angularForce+=i}};var b=a(),w=a(),A=a();o.prototype.applyForceLocal=function(t,e){e=e||A;var i=b,o=w;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyForce(i,o)};var x=a();o.prototype.applyImpulse=function(t,e){if(this.type===o.DYNAMIC){var i=x;if(n.scale(i,t,this.invMass),n.multiply(i,this.massMultiplier,i),r(this.velocity,i,this.velocity),e){var s=n.crossLength(e,t);s*=this.invInertia,this.angularVelocity+=s}}};var C=a(),B=a(),E=a();o.prototype.applyImpulseLocal=function(t,e){e=e||E;var i=C,o=B;this.vectorToWorldFrame(i,t),this.vectorToWorldFrame(o,e),this.applyImpulse(i,o)},o.prototype.toLocalFrame=function(t,e){n.toLocalFrame(t,e,this.position,this.angle)},o.prototype.toWorldFrame=function(t,e){n.toGlobalFrame(t,e,this.position,this.angle)},o.prototype.vectorToLocalFrame=function(t,e){n.vectorToLocalFrame(t,e,this.angle)},o.prototype.vectorToWorldFrame=function(t,e){n.vectorToGlobalFrame(t,e,this.angle)},o.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);for(var o=[],i=0;i<t.length;i++)o[i]=n.clone(t[i]);if(l.makeCCW(o),void 0!==e.removeCollinearPoints&&l.removeCollinearPoints(o,e.removeCollinearPoints),!e.skipSimpleCheck&&!l.isSimple(o))return!1;for(var r=this.concavePath=[],i=0;i<o.length;i++)r[i]=n.clone(o[i]);var h;h=e.optimalDecomp?l.decomp(o):l.quickDecomp(o);for(var u=a(),i=0;i!==h.length;i++){for(var p=new c({vertices:h[i]}),d=0;d!==p.vertices.length;d++){var f=p.vertices[d];s(f,f,p.centerOfMass)}n.copy(u,p.centerOfMass),p=new c({vertices:p.vertices}),this.addShape(p,u)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var _=a(),M=a(),P=a();o.prototype.adjustCenterOfMass=function(){var t=_,e=M,i=P,o=0;n.set(e,0,0);for(var a=0;a!==this.shapes.length;a++){var l=this.shapes[a];n.scale(t,l.position,l.area),r(e,e,t),o+=l.area}n.scale(i,e,1/o);for(var a=0;a!==this.shapes.length;a++){var l=this.shapes[a];s(l.position,l.position,i)}r(this.position,this.position,i);for(var a=0;this.concavePath&&a<this.concavePath.length;a++)s(this.concavePath[a],this.concavePath[a],i);this.updateMassProperties(),this.updateBoundingRadius()},o.prototype.setZeroForce=function(){var t=this.force;t[0]=t[1]=this.angularForce=0},o.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;n.set(e,0,0),t.wlambda=0},o.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;r(e,e,t.vlambda),t.angularVelocity+=t.wlambda},o.prototype.applyDamping=function(t){if(this.type===o.DYNAMIC){var e=this.velocity;n.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},o.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=o.AWAKE,this.idleTime=0,t!==o.AWAKE&&this.emit(y)},o.prototype.sleep=function(){this.sleepState=o.SLEEPING,this.angularVelocity=this.angularForce=0,n.set(this.velocity,0,0),n.set(this.force,0,0),this.emit(v)},o.prototype.sleepTick=function(t,e,i){if(this.allowSleep&&this.type!==o.SLEEPING){this.wantsToSleep=!1;var r=n.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),s=Math.pow(this.sleepSpeedLimit,2);r>=s?(this.idleTime=0,this.sleepState=o.AWAKE):(this.idleTime+=i,this.sleepState!==o.SLEEPY&&(this.sleepState=o.SLEEPY,this.emit(f))),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},o.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var k=a(),O=a();o.prototype.integrate=function(t){var e=this.invMass,i=this.force,o=this.position,s=this.velocity;n.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),n.scale(k,i,t*e),n.multiply(k,this.massMultiplier,k),r(s,k,s),this.integrateToTimeOfImpact(t)||(n.scale(O,s,t),r(o,o,O),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var S=new h,F=new u({mode:u.CLOSEST,skipBackfaces:!0}),L=a(),T=a(),I=a(),q=a();o.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||n.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;for(var e=[],i=this.world.disabledBodyCollisionPairs,o=0;o<i.length;o+=2){var a=i[o],l=i[o+1];a===this?e.push(l):l===this&&e.push(a)}n.normalize(L,this.velocity),n.scale(T,this.velocity,t),r(T,T,this.position),s(I,T,this.position);var c,h=this.angularVelocity*t,u=n.length(I),p=1;n.copy(F.from,this.position),n.copy(F.to,T),F.update();for(var o=0;o<this.shapes.length;o++){var d=this.shapes[o];if(S.reset(),F.collisionGroup=d.collisionGroup,F.collisionMask=d.collisionMask,this.world.raycast(S,F),c=S.body,c!==this&&e.indexOf(c)===-1||(c=null),c)break}if(!c||!p)return!1;S.getHitPoint(T,F),s(I,T,this.position),p=n.distance(T,this.position)/u;var f=this.angle;n.copy(q,this.position);for(var v=0,y=0,g=p,m=1;m>=y&&v<this.ccdIterations;){v++,g=(m+y)/2,n.scale(O,I,g),r(this.position,q,O),this.angle=f+h*g,this.updateAABB();var b=this.aabb.overlaps(c.aabb)&&this.world.narrowphase.bodiesOverlap(this,c,!0);b?m=g:y=g}return p=m,n.copy(this.position,q),this.angle=f,n.scale(O,I,p),r(this.position,this.position,O),this.fixedRotation||(this.angle+=h*p),!0},o.prototype.getVelocityAtPoint=function(t,e){return n.crossVZ(t,e,this.angularVelocity),n.subtract(t,this.velocity,t),t},o.DYNAMIC=1,o.STATIC=2,o.KINEMATIC=4,o.AWAKE=0,o.SLEEPY=1,o.SLEEPING=2},function(t,e,i){"use strict";t.exports={Polygon:i(17),Point:i(20)}},function(t,e,i){"use strict";function o(){this.vertices=[]}function n(t,e,i,o,n){n=n||0;var r=e[1]-t[1],s=t[0]-e[0],l=r*t[0]+s*t[1],c=o[1]-i[1],h=i[0]-o[0],u=c*i[0]+h*i[1],p=r*h-c*s;return a.eq(p,0,n)?[0,0]:[(h*l-s*u)/p,(r*u-c*l)/p]}var r=i(18),s=i(20),a=i(19);t.exports=o,o.prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]},o.prototype.first=function(){return this.vertices[0]},o.prototype.last=function(){return this.vertices[this.vertices.length-1]},o.prototype.clear=function(){this.vertices.length=0},o.prototype.append=function(t,e,i){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof i)throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var o=e;o<i;o++)this.vertices.push(t.vertices[o])},o.prototype.makeCCW=function(){for(var t=0,e=this.vertices,i=1;i<this.vertices.length;++i)(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0])&&(t=i);s.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},o.prototype.reverse=function(){for(var t=[],e=0,i=this.vertices.length;e!==i;e++)t.push(this.vertices.pop());this.vertices=t},o.prototype.isReflex=function(t){return s.right(this.at(t-1),this.at(t),this.at(t+1))};var l=[],c=[];o.prototype.canSee=function(t,e){var i,o,n=l,a=c;if(s.leftOn(this.at(t+1),this.at(t),this.at(e))&&s.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;o=s.sqdist(this.at(t),this.at(e));for(var h=0;h!==this.vertices.length;++h)if((h+1)%this.vertices.length!==t&&h!==t&&s.leftOn(this.at(t),this.at(e),this.at(h+1))&&s.rightOn(this.at(t),this.at(e),this.at(h))&&(n[0]=this.at(t),n[1]=this.at(e),a[0]=this.at(h),a[1]=this.at(h+1),i=r.lineInt(n,a),s.sqdist(this.at(t),i)<o))return!1;return!0},o.prototype.copy=function(t,e,i){var n=i||new o;if(n.clear(),t<e)for(var r=t;r<=e;r++)n.vertices.push(this.vertices[r]);else{for(var r=0;r<=e;r++)n.vertices.push(this.vertices[r]);for(var r=t;r<this.vertices.length;r++)n.vertices.push(this.vertices[r])}return n},o.prototype.getCutEdges=function(){for(var t=[],e=[],i=[],n=new o,r=Number.MAX_VALUE,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var a=0;a<this.vertices.length;++a)if(this.canSee(s,a)){e=this.copy(s,a,n).getCutEdges(),i=this.copy(a,s,n).getCutEdges();for(var l=0;l<i.length;l++)e.push(i[l]);e.length<r&&(t=e,r=e.length,t.push([this.at(s),this.at(a)]))}return t},o.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},o.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],i=0;i<t.length;i++)for(var o=t[i],n=0;n<e.length;n++){var r=e[n],s=r.slice(o);if(s){e.splice(n,1),e.push(s[0],s[1]);break}}return e}var o=t,i=this.vertices.indexOf(o[0]),n=this.vertices.indexOf(o[1]);return i!=-1&&n!=-1&&[this.copy(i,n),this.copy(n,i)]},o.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var i=0;i<e-1;i++)if(r.segmentsIntersect(t[e],t[e+1],t[i],t[i+1]))return!1;for(var e=1;e<t.length-2;e++)if(r.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},o.prototype.quickDecomp=function(t,e,i,r,a,l){a=a||100,l=l||0,r=r||25,t="undefined"!=typeof t?t:[],e=e||[],i=i||[];var c=[0,0],h=[0,0],u=[0,0],p=0,d=0,f=0,v=0,y=0,g=0,m=0,b=new o,w=new o,A=this,x=this.vertices;if(x.length<3)return t;if(l++,l>a)return console.warn("quickDecomp: max level ("+a+") reached."),t;for(var C=0;C<this.vertices.length;++C)if(A.isReflex(C)){e.push(A.vertices[C]),p=d=Number.MAX_VALUE;for(var B=0;B<this.vertices.length;++B)s.left(A.at(C-1),A.at(C),A.at(B))&&s.rightOn(A.at(C-1),A.at(C),A.at(B-1))&&(u=n(A.at(C-1),A.at(C),A.at(B),A.at(B-1)),s.right(A.at(C+1),A.at(C),u)&&(f=s.sqdist(A.vertices[C],u),f<d&&(d=f,h=u,g=B))),s.left(A.at(C+1),A.at(C),A.at(B+1))&&s.rightOn(A.at(C+1),A.at(C),A.at(B))&&(u=n(A.at(C+1),A.at(C),A.at(B),A.at(B+1)),s.left(A.at(C-1),A.at(C),u)&&(f=s.sqdist(A.vertices[C],u),f<p&&(p=f,c=u,y=B)));if(g==(y+1)%this.vertices.length)u[0]=(h[0]+c[0])/2,u[1]=(h[1]+c[1])/2,i.push(u),C<y?(b.append(A,C,y+1),b.vertices.push(u),w.vertices.push(u),0!=g&&w.append(A,g,A.vertices.length),w.append(A,0,C+1)):(0!=C&&b.append(A,C,A.vertices.length),b.append(A,0,y+1),b.vertices.push(u),w.vertices.push(u),w.append(A,g,C+1));else{if(g>y&&(y+=this.vertices.length),v=Number.MAX_VALUE,y<g)return t;for(var B=g;B<=y;++B)s.leftOn(A.at(C-1),A.at(C),A.at(B))&&s.rightOn(A.at(C+1),A.at(C),A.at(B))&&(f=s.sqdist(A.at(C),A.at(B)),f<v&&(v=f,m=B%this.vertices.length));C<m?(b.append(A,C,m+1),0!=m&&w.append(A,m,x.length),w.append(A,0,C+1)):(0!=C&&b.append(A,C,x.length),b.append(A,0,m+1),w.append(A,m,C+1))}return b.vertices.length<w.vertices.length?(b.quickDecomp(t,e,i,r,a,l),w.quickDecomp(t,e,i,r,a,l)):(w.quickDecomp(t,e,i,r,a,l),b.quickDecomp(t,e,i,r,a,l)),t}return t.push(this),t},o.prototype.removeCollinearPoints=function(t){for(var e=0,i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i)s.collinear(this.at(i-1),this.at(i),this.at(i+1),t)&&(this.vertices.splice(i%this.vertices.length,1),i--,e++);return e}},function(t,e,i){"use strict";function o(){}var n=i(19);t.exports=o,o.lineInt=function(t,e,i){i=i||0;var o,r,s,a,l,c,h,u=[0,0];return o=t[1][1]-t[0][1],r=t[0][0]-t[1][0],s=o*t[0][0]+r*t[0][1],a=e[1][1]-e[0][1],l=e[0][0]-e[1][0],c=a*e[0][0]+l*e[0][1],h=o*l-a*r,n.eq(h,0,i)||(u[0]=(l*s-r*c)/h,u[1]=(o*c-a*s)/h),u},o.segmentsIntersect=function(t,e,i,o){var n=e[0]-t[0],r=e[1]-t[1],s=o[0]-i[0],a=o[1]-i[1];if(s*r-a*n==0)return!1;var l=(n*(i[1]-t[1])+r*(t[0]-i[0]))/(s*r-a*n),c=(s*(t[1]-i[1])+a*(i[0]-t[0]))/(a*n-s*r);return l>=0&&l<=1&&c>=0&&c<=1}},function(t,e){"use strict";
function i(){}t.exports=i,i.eq=function(t,e,i){return i=i||0,Math.abs(t-e)<i}},function(t,e){"use strict";function i(){}t.exports=i,i.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])},i.left=function(t,e,o){return i.area(t,e,o)>0},i.leftOn=function(t,e,o){return i.area(t,e,o)>=0},i.right=function(t,e,o){return i.area(t,e,o)<0},i.rightOn=function(t,e,o){return i.area(t,e,o)<=0};var o=[],n=[];i.collinear=function(t,e,r,s){if(s){var a=o,l=n;a[0]=e[0]-t[0],a[1]=e[1]-t[1],l[0]=r[0]-e[0],l[1]=r[1]-e[1];var c=a[0]*l[0]+a[1]*l[1],h=Math.sqrt(a[0]*a[0]+a[1]*a[1]),u=Math.sqrt(l[0]*l[0]+l[1]*l[1]),p=Math.acos(c/(h*u));return p<s}return 0==i.area(t,e,r)},i.sqdist=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o}},function(t,e,i){"use strict";function o(t){t=t?c(t):{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],i=0;i<e.length;i++)this.vertices.push(s.clone(e[i]));for(var o=this.normals=[],i=0;i<e.length;i++)o.push(s.create());if(this.updateNormals(),this.centerOfMass=s.create(),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=t.type||r.CONVEX,r.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in counter-clockwise winding.")}function n(t,e,i){return.5*((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))}var r=i(22),s=i(11),a=s.dot,l=i(23),c=i(12).shallowClone;t.exports=o,o.prototype=new r,o.prototype.constructor=o;var h=s.create(),u=s.create();o.prototype.updateNormals=function(){for(var t=this.vertices,e=this.normals,i=0;i<t.length;i++){var o=t[i],n=t[(i+1)%t.length],r=e[i];s.subtract(r,n,o),s.rotate90cw(r,r),s.normalize(r,r)}},o.prototype.projectOntoLocalAxis=function(t,e){for(var i,o,n=null,r=null,t=h,l=0;l<this.vertices.length;l++)i=this.vertices[l],o=a(i,t),(null===n||o>n)&&(n=o),(null===r||o<r)&&(r=o);if(r>n){var c=r;r=n,n=c}s.set(e,r,n)},o.prototype.projectOntoWorldAxis=function(t,e,i,o){var n=u;this.projectOntoLocalAxis(t,o),0!==i?s.rotate(n,t,i):n=t;var r=a(e,n);s.set(o,o[0]+r,o[1]+r)},o.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}for(var o=l.Triangulate(t),e=0;e<o.length;e+=3){var n=o[e],r=o[e+1],s=o[e+2];this.triangles.push([n,r,s])}};var p=s.create(),d=s.create(),f=s.create(),v=s.create(),y=s.create();o.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,o=p,r=f,a=v,l=y,c=d;s.set(i,0,0);for(var h=0,u=0;u!==t.length;u++){var g=t[u],r=e[g[0]],a=e[g[1]],l=e[g[2]];s.centroid(o,r,a,l);var m=n(r,a,l);h+=m,s.scale(c,o,m),s.add(i,i,c)}s.scale(i,i,1/h)},o.prototype.computeMomentOfInertia=function(){for(var t=0,e=0,i=this.vertices.length,o=i-1,n=0;n<i;o=n,n++){var r=this.vertices[o],l=this.vertices[n],c=Math.abs(s.crossLength(r,l)),h=a(l,l)+a(l,r)+a(r,r);t+=c*h,e+=c}return 1/6*(t/e)},o.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,i=0;i!==t.length;i++){var o=s.squaredLength(t[i]);o>e&&(e=o)}this.boundingRadius=Math.sqrt(e)},o.triangleArea=n,o.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,i=0;i!==t.length;i++){var o=t[i],r=e[o[0]],s=e[o[1]],a=e[o[2]],l=n(r,s,a);this.area+=l}},o.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var g=s.create(),m=s.create(),b=s.create();o.prototype.raycast=function(t,e,i,o){var n=g,r=m,a=b,l=this.vertices;s.toLocalFrame(n,e.from,i,o),s.toLocalFrame(r,e.to,i,o);for(var c=l.length,h=0;h<c&&!t.shouldStop(e);h++){var u=l[h],p=l[(h+1)%c],d=s.getLineSegmentsIntersectionFraction(n,r,u,p);d>=0&&(s.subtract(a,p,u),s.rotate(a,a,-Math.PI/2+o),s.normalize(a,a),e.reportIntersection(t,d,a,h))}};var w=s.create(),A=s.create();o.prototype.pointTest=function(t){for(var e=w,i=A,o=this.vertices,n=null,r=o.length,a=0;a<r+1;a++){var l=o[a%r],c=o[(a+1)%r];s.subtract(e,l,t),s.subtract(i,c,t);var h=s.crossLength(e,i);if(null===n&&(n=h),h*n<0)return!1;n=h}return!0}},function(t,e,i){"use strict";function o(t){t=t||{},this.body=null,this.position=n.create(),t.position&&n.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=o.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}t.exports=o;var n=i(11);o.idCounter=0,o.CIRCLE=1,o.PARTICLE=2,o.PLANE=4,o.CONVEX=8,o.LINE=16,o.BOX=32,o.CAPSULE=64,o.HEIGHTFIELD=128,o.prototype={computeMomentOfInertia:function(){},updateBoundingRadius:function(){},updateArea:function(){},computeAABB:function(){},raycast:function(){},pointTest:function(){return!1},worldPointToLocal:function(){var t=n.create();return function(e,i){var o=this.body;n.rotate(t,this.position,o.angle),n.add(t,t,o.position),n.toLocalFrame(e,i,t,this.body.angle+this.angle)}}()}},function(t,e){"use strict";var i={};i.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,i=0,o=0;o<e;o+=2)i+=(t[o+2]-t[o])*(t[o+1]+t[o+3]);return i+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-i},i.Triangulate=function(t){var e=t.length>>1;if(e<3)return[];for(var o=[],n=[],r=0;r<e;r++)n.push(r);for(var r=0,s=e;s>3;){var a=n[(r+0)%s],l=n[(r+1)%s],c=n[(r+2)%s],h=t[2*a],u=t[2*a+1],p=t[2*l],d=t[2*l+1],f=t[2*c],v=t[2*c+1],y=!1;if(i._convex(h,u,p,d,f,v)){y=!0;for(var g=0;g<s;g++){var m=n[g];if(m!=a&&m!=l&&m!=c&&i._PointInTriangle(t[2*m],t[2*m+1],h,u,p,d,f,v)){y=!1;break}}}if(y)o.push(a,l,c),n.splice((r+1)%s,1),s--,r=0;else if(r++>3*s)break}return o.push(n[0],n[1],n[2]),o},i._PointInTriangle=function(t,e,i,o,n,r,s,a){var l=s-i,c=a-o,h=n-i,u=r-o,p=t-i,d=e-o,f=l*l+c*c,v=l*h+c*u,y=l*p+c*d,g=h*h+u*u,m=h*p+u*d,b=1/(f*g-v*v),w=(g*y-v*m)*b,A=(f*m-v*y)*b;return w>=0&&A>=0&&w+A<1},i._convex=function(t,e,i,o,n,r){return(e-o)*(n-i)+(i-t)*(r-o)>=0},t.exports=i},function(t,e,i){"use strict";function o(){this.normal=n.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var n=i(11),r=i(25);t.exports=o,o.prototype.reset=function(){n.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},o.prototype.getHitDistance=function(t){return n.distance(t.from,t.to)*this.fraction},o.prototype.hasHit=function(){return this.fraction!==-1},o.prototype.getHitPoint=function(t,e){n.lerp(t,e.from,e.to,this.fraction)},o.prototype.stop=function(){this.isStopped=!0},o.prototype.shouldStop=function(t){return this.isStopped||this.fraction!==-1&&t.mode===r.ANY},o.prototype.set=function(t,e,i,o,r){n.copy(this.normal,t),this.shape=e,this.body=i,this.fraction=o,this.faceIndex=r}},function(t,e,i){"use strict";function o(t){t=t||{},this.from=t.from?r.clone(t.from):r.create(),this.to=t.to?r.clone(t.to):r.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:o.ANY,this.callback=t.callback||function(){},this.direction=r.create(),this.length=1,this.update()}function n(t,e,i){r.subtract(a,i,t);var o=r.dot(a,e);return r.scale(l,e,o),r.add(l,l,t),r.squaredDistance(i,l)}t.exports=o;var r=i(11);o.prototype.constructor=o,o.CLOSEST=1,o.ANY=2,o.ALL=4,o.prototype.update=function(){var t=this.direction;r.subtract(t,this.to,this.from),this.length=r.length(t),r.normalize(t,t)},o.prototype.intersectBodies=function(t,e){for(var i=0,o=e.length;!t.shouldStop(this)&&i<o;i++){var n=e[i],r=n.getAABB();(r.overlapsRay(this)>=0||r.containsPoint(this.from))&&this.intersectBody(t,n)}};var s=r.create();o.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(!i||e.collisionResponse)for(var o=s,n=0,a=e.shapes.length;n<a;n++){var l=e.shapes[n];if((!i||l.collisionResponse)&&0!==(this.collisionGroup&l.collisionMask)&&0!==(l.collisionGroup&this.collisionMask)){r.rotate(o,l.position,e.angle),r.add(o,o,e.position);var c=l.angle+e.angle;if(this.intersectShape(t,l,c,o,e),t.shouldStop(this))break}}},o.prototype.intersectShape=function(t,e,i,o,r){var s=this.from,a=n(s,this.direction,o);a>e.boundingRadius*e.boundingRadius||(this._currentBody=r,this._currentShape=e,e.raycast(t,this,o,i),this._currentBody=this._currentShape=null)},o.prototype.getAABB=function(t){var e=this.to,i=this.from;r.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1])),r.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))},o.prototype.reportIntersection=function(t,e,i,n){var s=this._currentShape,a=this._currentBody;if(!(this.skipBackfaces&&r.dot(i,this.direction)>0))switch(this.mode){case o.ALL:t.set(i,s,a,e,n),this.callback(t);break;case o.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(i,s,a,e,n);break;case o.ANY:t.set(i,s,a,e,n)}};var a=r.create(),l=r.create()},function(t,e){"use strict";function i(){this.tmpArray=[]}t.exports=i,i.prototype={constructor:i,on:function(t,e,i){e.context=i||this,void 0===this._listeners&&(this._listeners={});var o=this._listeners;return void 0===o[t]&&(o[t]=[]),o[t].indexOf(e)===-1&&o[t].push(e),this},off:function(t,e){var i=this._listeners;if(!i||!i[t])return this;var o=i[t].indexOf(e);return o!==-1&&i[t].splice(o,1),this},has:function(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;if(e){if(void 0!==i[t]&&i[t].indexOf(e)!==-1)return!0}else if(void 0!==i[t])return!0;return!1},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,i=e[t.type];if(void 0!==i){t.target=this;for(var o=this.tmpArray,n=0,r=i.length;n<r;n++)o[n]=i[n];for(var n=0,r=o.length;n<r;n++){var s=o[n];s.call(s.context,t)}o.length=0}return this}}},function(t,e,i){"use strict";function o(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=o.AABB}var n=i(11),r=i(15);t.exports=o,o.AABB=1,o.BOUNDING_CIRCLE=2,o.prototype.setWorld=function(t){this.world=t},o.prototype.getCollisionPairs=function(){},o.boundingRadiusCheck=function(t,e){var i=n.squaredDistance(t.position,e.position),o=t.boundingRadius+e.boundingRadius;return i<=o*o},o.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},o.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case o.BOUNDING_CIRCLE:i=o.boundingRadiusCheck(t,e);break;case o.AABB:i=o.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i},o.canCollide=function(t,e){var i=r.KINEMATIC,o=r.STATIC,n=t.type,s=e.type;return(n!==o||s!==o)&&(!(n===i&&s===o||n===o&&s===i)&&((n!==i||s!==i)&&((t.sleepState!==r.SLEEPING||e.sleepState!==r.SLEEPING)&&!(t.sleepState===r.SLEEPING&&s===o||e.sleepState===r.SLEEPING&&n===o))))},o.NAIVE=1,o.SAP=2,o.prototype.aabbQuery=function(){}},function(t,e,i){"use strict";function o(t){t=t?r(t):{},this.length=void 0!==t.length?t.length:1,this.radius=void 0!==t.radius?t.radius:1,t.type=n.CAPSULE,n.call(this,t)}var n=i(22),r=i(12).shallowClone,s=i(11);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){function t(t,e){return t*e*(Math.pow(t,2)+Math.pow(e,2))/12}function e(t){return Math.PI*Math.pow(t,2)/2}function i(t){return(Math.PI/4-8/(9*Math.PI))*Math.pow(t,4)}function o(t){return 4*t/(3*Math.PI)}function n(t,e){return 2*t*e+Math.PI*Math.pow(e,2)}function r(n,r){var s=n/2+o(r);return t(n,2*r)+2*(i(r)+e(r)*Math.pow(s,2))}var s=this.radius,a=this.length,l=n(a,s);return l>0?r(a,s)/l:0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var a=s.create();o.prototype.computeAABB=function(t,e,i){var o=this.radius;s.set(a,this.length/2,0),0!==i&&s.rotate(a,a,i),s.set(t.upperBound,Math.max(a[0]+o,-a[0]+o),Math.max(a[1]+o,-a[1]+o)),s.set(t.lowerBound,Math.min(a[0]-o,-a[0]-o),Math.min(a[1]-o,-a[1]-o)),s.add(t.lowerBound,t.lowerBound,e),s.add(t.upperBound,t.upperBound,e)};var l=s.create(),c=s.create(),h=s.create(),u=s.create(),p=s.fromValues(0,1);o.prototype.raycast=function(t,e,i,o){for(var n=e.from,r=e.to,a=l,d=c,f=h,v=u,y=this.length/2,g=0;g<2;g++){var m=this.radius*(2*g-1);s.set(f,-y,m),s.set(v,y,m),s.toGlobalFrame(f,f,i,o),s.toGlobalFrame(v,v,i,o);var b=s.getLineSegmentsIntersectionFraction(n,r,f,v);if(b>=0&&(s.rotate(d,p,o),s.scale(d,d,2*g-1),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}for(var w=Math.pow(this.radius,2)+Math.pow(y,2),g=0;g<2;g++){s.set(f,y*(2*g-1),0),s.toGlobalFrame(f,f,i,o);var A=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),x=2*((r[0]-n[0])*(n[0]-f[0])+(r[1]-n[1])*(n[1]-f[1])),C=Math.pow(n[0]-f[0],2)+Math.pow(n[1]-f[1],2)-Math.pow(this.radius,2),b=Math.pow(x,2)-4*A*C;if(!(b<0))if(0===b){if(s.lerp(a,n,r,b),s.squaredDistance(a,i)>w&&(s.subtract(d,a,f),s.normalize(d,d),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}else{var B=Math.sqrt(b),E=1/(2*A),_=(-x-B)*E,M=(-x+B)*E;if(_>=0&&_<=1&&(s.lerp(a,n,r,_),s.squaredDistance(a,i)>w&&(s.subtract(d,a,f),s.normalize(d,d),e.reportIntersection(t,_,d,-1),t.shouldStop(e))))return;if(M>=0&&M<=1&&(s.lerp(a,n,r,M),s.squaredDistance(a,i)>w&&(s.subtract(d,a,f),s.normalize(d,d),e.reportIntersection(t,M,d,-1),t.shouldStop(e))))return}}},o.prototype.pointTest=function(t){var e=this.radius,i=.5*this.length;return Math.abs(t[0])<=i&&Math.abs(t[1])<=e||(Math.pow(t[0]-i,2)+Math.pow(t[1],2)<=e*e||Math.pow(t[0]+i,2)+Math.pow(t[1],2)<=e*e)}},function(t,e,i){"use strict";function o(t){t=t?s(t):{},this.radius=void 0!==t.radius?t.radius:1,t.type=n.CIRCLE,n.call(this,t)}var n=i(22),r=i(11),s=i(12).shallowClone;t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){var t=this.radius;return t*t/2},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},o.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},o.prototype.computeAABB=function(t,e){var i=this.radius;r.set(t.upperBound,i,i),r.set(t.lowerBound,-i,-i),e&&(r.add(t.lowerBound,t.lowerBound,e),r.add(t.upperBound,t.upperBound,e))};var a=r.create(),l=r.create();o.prototype.raycast=function(t,e,i){var o=e.from,n=e.to,s=this.radius,c=Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2),h=2*((n[0]-o[0])*(o[0]-i[0])+(n[1]-o[1])*(o[1]-i[1])),u=Math.pow(o[0]-i[0],2)+Math.pow(o[1]-i[1],2)-Math.pow(s,2),p=Math.pow(h,2)-4*c*u,d=a,f=l;if(!(p<0))if(0===p)r.lerp(d,o,n,p),r.subtract(f,d,i),r.normalize(f,f),e.reportIntersection(t,p,f,-1);else{var v=Math.sqrt(p),y=1/(2*c),g=(-h-v)*y,m=(-h+v)*y;if(g>=0&&g<=1&&(r.lerp(d,o,n,g),r.subtract(f,d,i),r.normalize(f,f),e.reportIntersection(t,g,f,-1),t.shouldStop(e)))return;m>=0&&m<=1&&(r.lerp(d,o,n,m),r.subtract(f,d,i),r.normalize(f,f),e.reportIntersection(t,m,f,-1))}},o.prototype.pointTest=function(t){var e=this.radius;return r.squaredLength(t)<=e*e}},function(t,e){"use strict";function i(t,e,i,o){o=o||{},this.type=i,this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=void 0===o.collideConnected||o.collideConnected,o.wakeUpBodies!==!1&&(t&&t.wakeUp(),e&&e.wakeUp())}t.exports=i,i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.DISTANCE=1,i.GEAR=2,i.LOCK=3,i.PRISMATIC=4,i.REVOLUTE=5,i.prototype.setStiffness=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.stiffness=t,o.needsUpdate=!0}},i.prototype.setRelaxation=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.relaxation=t,o.needsUpdate=!0}},i.prototype.setMaxBias=function(t){for(var e=this.equations,i=0;i!==e.length;i++){var o=e[i];o.maxBias=t}}},function(t,e,i){"use strict";function o(t,e){r.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=s.create(),this.penetrationVec=s.create(),this.contactPointB=s.create(),this.normalA=s.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}function n(t,e,i,o,n){t[0]=e[0]+i[0]-o[0]-n[0],t[1]=e[1]+i[1]-o[1]-n[1]}var r=i(14),s=i(11);t.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.computeB=function(t,e,i){var o=this.bodyA,r=this.bodyB,a=this.contactPointA,l=this.contactPointB,c=o.position,h=r.position,u=this.normalA,p=this.G,d=s.crossLength(a,u),f=s.crossLength(l,u);p[0]=-u[0],p[1]=-u[1],p[2]=-d,p[3]=u[0],p[4]=u[1],p[5]=f;var v,y;if(this.firstImpact&&0!==this.restitution)y=0,v=1/e*(1+this.restitution)*this.computeGW();else{var g=this.penetrationVec;n(g,h,l,c,a),y=s.dot(u,g)+this.offset,v=this.computeGW()}var m=this.computeGiMf(),b=-y*t-v*e-i*m;return b};var a=s.create(),l=s.create(),c=s.create();o.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(a,this.contactPointA),this.bodyB.getVelocityAtPoint(l,this.contactPointB),s.subtract(c,a,l),s.dot(this.normalA,c)}},function(t,e,i){"use strict";function o(){r.apply(this,arguments)}var n=i(31),r=i(33);t.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.create=function(){return new n},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},function(t,e){"use strict";function i(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}t.exports=i,i.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},i.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},i.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},function(t,e,i){"use strict";function o(t,e,i){if(i=i||{},!(t instanceof n&&e instanceof n))throw new Error("First two arguments must be Material instances.");this.id=o.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==i.friction?i.friction:.3,this.restitution=void 0!==i.restitution?i.restitution:0,this.stiffness=void 0!==i.stiffness?i.stiffness:r.DEFAULT_STIFFNESS,this.relaxation=void 0!==i.relaxation?i.relaxation:r.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==i.frictionStiffness?i.frictionStiffness:r.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==i.frictionRelaxation?i.frictionRelaxation:r.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==i.surfaceVelocity?i.surfaceVelocity:0,this.contactSkinSize=.005}var n=i(35),r=i(14);t.exports=o,o.idCounter=0},function(t,e){"use strict";function i(){this.id=i.idCounter++}t.exports=i,i.idCounter=0},function(t,e,i){"use strict";function o(t,e,i){i=i||{},n.call(this,t,e,n.DISTANCE,i),this.localAnchorA=i.localAnchorA?s.clone(i.localAnchorA):s.create(),this.localAnchorB=i.localAnchorB?s.clone(i.localAnchorB):s.create();var o=this.localAnchorA,a=this.localAnchorB;if(this.distance=0,"number"==typeof i.distance)this.distance=i.distance;else{var l=s.create(),c=s.create(),h=s.create();s.rotate(l,o,t.angle),s.rotate(c,a,e.angle),s.add(h,e.position,c),s.subtract(h,h,l),s.subtract(h,h,t.position),this.distance=s.length(h)}var u;u="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce;var p=new r(t,e,-u,u);this.equations=[p],this.maxForce=u;var h=s.create(),d=s.create(),f=s.create(),v=this;p.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,n=e.position;return s.rotate(d,o,t.angle),s.rotate(f,a,e.angle),s.add(h,n,f),s.subtract(h,h,d),s.subtract(h,h,i),s.length(h)-v.distance},this.setMaxForce(u),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var n=i(30),r=i(14),s=i(11);t.exports=o,o.prototype=new n,o.prototype.constructor=o;var a=s.create(),l=s.create(),c=s.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,o=e.position,n=i.position,r=this.equations[0],h=t.G;s.rotate(l,this.localAnchorA,e.angle),s.rotate(c,this.localAnchorB,i.angle),s.add(a,n,c),s.subtract(a,a,l),s.subtract(a,a,o),this.position=s.length(a);var u=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(r.maxForce=0,r.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(r.maxForce=this.maxForce,r.minForce=0,this.distance=this.lowerLimit,u=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!u)return void(r.enabled=!1);r.enabled=!0,s.normalize(a,a);var p=s.crossLength(l,a),d=s.crossLength(c,a);h[0]=-a[0],h[1]=-a[1],h[2]=-p,h[3]=a[0],h[4]=a[1],h[5]=d},o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},o.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},function(t,e,i){"use strict";function o(t,e,i){r.call(this,t,e,-i,i),this.contactPointA=n.create(),this.contactPointB=n.create(),this.t=n.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var n=i(11),r=i(14);t.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},o.prototype.getSlipForce=function(){return this.maxForce},o.prototype.computeB=function(t,e,i){var o=this.contactPointA,r=this.contactPointB,s=this.t,a=this.G;a[0]=-s[0],a[1]=-s[1],a[2]=-n.crossLength(o,s),a[3]=s[0],a[4]=s[1],a[5]=n.crossLength(r,s);var l=this.computeGW(),c=this.computeGiMf(),h=-l*e-i*c;return h}},function(t,e,i){"use strict";function o(){r.apply(this,arguments)}var n=i(37),r=i(33);t.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.create=function(){return new n},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},function(t,e,i){"use strict";function o(t,e,i){i=i||{},n.call(this,t,e,n.GEAR,i),this.ratio=void 0!==i.ratio?i.ratio:1,this.angle=void 0!==i.angle?i.angle:e.angle-this.ratio*t.angle;var o=s.shallowClone(i);o.angle=this.angle,o.ratio=this.ratio,this.equations=[new r(t,e,o)],void 0!==i.maxTorque&&this.setMaxTorque(i.maxTorque)}var n=i(30),r=i(13),s=i(12);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.update=function(){var t=this.equations[0],e=this.ratio;t.ratio!==e&&t.setRatio(e),t.angle=this.angle},o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},o.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},function(t,e,i){"use strict";function o(t){s.call(this,t,s.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=void 0!==t.tolerance?t.tolerance:1e-7,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}function n(t,e){for(var i=t.length;i--;){var o=t[i];o.multiplier=o.lambda*e}}function r(t){var e=t.B,i=t.epsilon,o=t.invC,n=t.lambda,r=t.computeGWlambda(),s=t.maxForceDt,a=t.minForceDt,l=o*(e-r-i*n),c=n+l;return c<a?l=a-n:c>s&&(l=s-n),t.lambda+=l,t.addToWlambda(l),l}var s=i(41),a=i(37);t.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.solve=function(t,e){this.sortEquations();var i=0,o=this.iterations,s=this.frictionIterations,l=this.equations,c=l.length,h=Math.pow(this.tolerance*c,2),u=e.bodies,p=u.length;if(this.usedIterations=0,c)for(var d=0;d!==p;d++){var f=u[d];f.updateSolveMassProperties()}for(var d=0;d!==c;d++){var v=l[d];v.lambda=0,(v.timeStep!==t||v.needsUpdate)&&(v.timeStep=t,v.update()),v.B=v.computeB(v.a,v.b,t),v.invC=v.computeInvC(v.epsilon),v.maxForceDt=v.maxForce*t,v.minForceDt=v.minForce*t}var v,y,d,g;if(0!==c){for(d=0;d!==p;d++){var f=u[d];f.resetConstraintVelocity()}if(s){for(i=0;i!==s;i++){for(y=0,g=0;g!==c;g++){v=l[g];var m=r(v,t);y+=Math.abs(m)}if(this.usedIterations++,y*y<=h)break}for(n(l,1/t),g=0;g!==c;g++){var b=l[g];if(b instanceof a){for(var w=0,A=0;A!==b.contactEquations.length;A++)w+=b.contactEquations[A].multiplier;w*=b.frictionCoefficient/b.contactEquations.length,b.maxForce=w,b.minForce=-w,b.maxForceDt=w*t,b.minForceDt=-w*t}}}for(i=0;i!==o;i++){for(y=0,g=0;g!==c;g++){v=l[g];var m=r(v,t);y+=Math.abs(m)}if(this.usedIterations++,y*y<h)break}for(d=0;d!==p;d++)u[d].addConstraintVelocity();n(l,1/t)}}},function(t,e,i){"use strict";function o(t,e){t=t||{},n.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var n=i(26);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")},o.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},o.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},o.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var o=t[e];o.enabled&&this.equations.push(o)}},o.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);e!==-1&&this.equations.splice(e,1)},o.prototype.removeAllEquations=function(){this.equations.length=0},o.GS=1},function(t,e,i){"use strict";function o(t){t=t?s(t):{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=void 0!==t.elementWidth?t.elementWidth:.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=n.HEIGHTFIELD,n.call(this,t)}var n=i(22),r=i(11),s=i(12).shallowClone;t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],i=t[0],o=0;o!==t.length;o++){var n=t[o];n>e&&(e=n),n<i&&(i=n)}this.maxValue=e,this.minValue=i},o.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.updateArea=function(){for(var t=this.heights,e=0,i=0;i<t.length-1;i++)e+=(t[i]+t[i+1])/2*this.elementWidth;this.area=e};var a=[r.create(),r.create(),r.create(),r.create()];o.prototype.computeAABB=function(t,e,i){r.set(a[0],0,this.maxValue),r.set(a[1],this.elementWidth*this.heights.length,this.maxValue),r.set(a[2],this.elementWidth*this.heights.length,this.minValue),r.set(a[3],0,this.minValue),t.setFromPoints(a,e,i)},o.prototype.getLineSegment=function(t,e,i){var o=this.heights,n=this.elementWidth;r.set(t,i*n,o[i]),r.set(e,(i+1)*n,o[i+1])},o.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},o.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};var l=r.create(),c=r.create(),h=r.create(),u=r.create(),p=r.create();o.prototype.raycast=function(t,e,i,o){var n=e.from,s=e.to,a=l,d=c,f=h,v=u,y=p;r.toLocalFrame(v,n,i,o),r.toLocalFrame(y,s,i,o);var g=this.getClampedSegmentIndex(v),m=this.getClampedSegmentIndex(y);if(g>m){var b=g;g=m,m=b}for(var w=0;w<this.heights.length-1;w++){this.getLineSegment(d,f,w);var A=r.getLineSegmentsIntersectionFraction(v,y,d,f);if(A>=0&&(r.subtract(a,f,d),r.rotate(a,a,o+Math.PI/2),r.normalize(a,a),e.reportIntersection(t,A,a,-1),t.shouldStop(e)))return}}},function(t,e,i){"use strict";function o(t){t=t?r(t):{},this.length=void 0!==t.length?t.length:1,t.type=n.LINE,n.call(this,t)}var n=i(22),r=i(12).shallowClone,s=i(11);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return Math.pow(this.length,2)/12},o.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var a=[s.create(),s.create()];o.prototype.computeAABB=function(t,e,i){var o=this.length/2;s.set(a[0],-o,0),s.set(a[1],o,0),t.setFromPoints(a,e,i,0)};var l=s.create(),c=s.create(),h=s.create(),u=s.fromValues(0,1);o.prototype.raycast=function(t,e,i,o){var n=e.from,r=e.to,a=c,p=h,d=this.length/2;s.set(a,-d,0),s.set(p,d,0),s.toGlobalFrame(a,a,i,o),s.toGlobalFrame(p,p,i,o);var f=s.getLineSegmentsIntersectionFraction(a,p,n,r);if(f>=0){var v=l;s.rotate(v,u,o),e.reportIntersection(t,f,v,-1)}}},function(t,e,i){"use strict";function o(t,e,i){i=i||{},n.call(this,t,e,n.LOCK,i);var o="undefined"==typeof i.maxForce?Number.MAX_VALUE:i.maxForce,a=new s(t,e,-o,o),l=new s(t,e,-o,o),c=new s(t,e,-o,o),h=r.create(),u=r.create(),p=this;a.computeGq=function(){return r.rotate(h,p.localOffsetB,t.angle),r.subtract(u,e.position,t.position),r.subtract(u,u,h),u[0]},l.computeGq=function(){return r.rotate(h,p.localOffsetB,t.angle),r.subtract(u,e.position,t.position),r.subtract(u,u,h),u[1]};var d=r.create(),f=r.create();c.computeGq=function(){return r.rotate(d,p.localOffsetB,e.angle-p.localAngleB),r.scale(d,d,-1),r.subtract(u,t.position,e.position),r.add(u,u,d),r.rotate(f,d,-Math.PI/2),r.normalize(f,f),r.dot(u,f)},this.localOffsetB=r.create(),i.localOffsetB?r.copy(this.localOffsetB,i.localOffsetB):(r.subtract(this.localOffsetB,e.position,t.position),r.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof i.localAngleB?this.localAngleB=i.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(a,l,c),this.setMaxForce(o)}var n=i(30),r=i(11),s=i(14);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.setMaxForce=function(t){for(var e=this.equations,i=0;i<this.equations.length;i++)e[i].maxForce=t,e[i].minForce=-t},o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var a=r.create(),l=r.create(),c=r.create(),h=r.fromValues(1,0),u=r.fromValues(0,1);o.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],o=this.bodyA,n=this.bodyB;r.rotate(a,this.localOffsetB,o.angle),r.rotate(l,this.localOffsetB,n.angle-this.localAngleB),r.scale(l,l,-1),r.rotate(c,l,Math.PI/2),r.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-r.crossLength(a,h),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-r.crossLength(a,u),e.G[4]=1,i.G[0]=-c[0],i.G[1]=-c[1],i.G[3]=c[0],i.G[4]=c[1],i.G[5]=r.crossLength(l,c)}},function(t,e,i){"use strict";function o(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.contactEquationPool=new A({size:32}),this.frictionEquationPool=new x({size:64}),this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new C,this.currentContactMaterial=null}function n(t,e){var i=e.radius,o=.5*e.length,n=t.vertices;u.set(n[0],-o,-i),u.set(n[1],o,-i),u.set(n[2],o,i),u.set(n[3],-o,i)}function r(t,e,i,o){var n=J,r=$,s=tt,a=e.vertices,l=null;u.toLocalFrame(n,t,i,o);for(var c=0,h=a.length;c!==h+1;c++){var d=a[c%h],f=a[(c+1)%h];p(r,d,n),p(s,f,n);var v=u.crossLength(r,s);if(null===l&&(l=v),v*l<0)return!1;l=v}return!0}function s(t,e){for(var i=$,o=tt,n=e.vertices,r=null,s=n.length,a=0;a<s+1;a++){var l=n[a%s],c=n[(a+1)%s];p(i,l,t),p(o,c,t);var h=u.crossLength(i,o);if(null===r&&(r=h),h*r<0)return!1;r=h}return!0}function a(t,e,i,o){t[0]=e[0]+i[0]-o[0],t[1]=e[1]+i[1]-o[1]}function l(t,e,i,o,n,r,s){for(var a=e.vertices.length,l=n.vertices.length,c=e.normals,h=e.vertices,p=n.vertices,d=nt,f=rt,v=st,y=at,g=o-s,m=0,b=-Number.MAX_VALUE,w=0;w<a;++w){u.rotate(d,c[w],g),u.toGlobalFrame(y,h[w],i,o),u.toLocalFrame(f,y,r,s);for(var A=Number.MAX_VALUE,x=0;x<l;++x){u.subtract(v,p[x],f);var C=u.dot(d,v);C<A&&(A=C)}A>b&&(b=A,m=w)}return t[0]=b,m}function c(t,e,i,o,n,r,s,a){var l=e.normals,c=r.vertices.length,h=r.vertices,p=r.normals,d=lt;u.rotate(d,l[n],o-a);for(var f=0,v=Number.MAX_VALUE,y=0;y<c;++y){var g=u.dot(d,p[y]);g<v&&(v=g,f=y)}var m=f,b=m+1<c?m+1:0;u.toGlobalFrame(t[0],h[m],s,a),u.toGlobalFrame(t[1],h[b],s,a)}function h(t,e,i,o){var n=0,r=u.dot(i,e[0])-o,s=u.dot(i,e[1])-o;if(r<=0&&u.copy(t[n++],e[0]),s<=0&&u.copy(t[n++],e[1]),r*s<0){var a=r/(r-s),l=t[n];u.subtract(l,e[1],e[0]),u.scale(l,l,a),u.add(l,l,e[0]),++n}return n}var u=i(11),p=u.subtract,d=u.add,f=u.dot,v=u.rotate,y=u.normalize,g=u.copy,m=u.scale,b=u.squaredLength,w=u.create,A=i(32),x=i(38),C=i(46),B=i(29),E=i(21),_=i(22),M=i(47);t.exports=o;var P=u.fromValues(0,1),k=w(),O=w(),S=w(),F=w(),L=w(),T=w(),I=w(),q=w(),R=w(),N=w(),G=w(),V=w(),D=w(),W=w(),j=w(),U=[],X=w(),Y=w();o.prototype.bodiesOverlap=function(t,e,i){for(var o=X,n=Y,r=0,s=t.shapes.length;r!==s;r++)for(var a=t.shapes[r],l=0,c=e.shapes.length;l!==c;l++){var h=e.shapes[l];if(i&&(0===(a.collisionGroup&h.collisionMask)||0===(h.collisionGroup&a.collisionMask)))return;
if(t.toWorldFrame(o,a.position),e.toWorldFrame(n,h.position),a.type<=h.type){if(this[a.type|h.type](t,a,o,a.angle+t.angle,e,h,n,h.angle+e.angle,!0))return!0}else if(this[a.type|h.type](e,h,n,h.angle+e.angle,t,a,o,a.angle+t.angle,!0))return!0}return!1},o.prototype.collidedLastStep=function(t,e){var i=0|t.id,o=0|e.id;return!!this.collidingBodiesLastStep.get(i,o)},o.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var i=t[e],o=i.bodyA.id,n=i.bodyB.id;this.collidingBodiesLastStep.set(o,n,!0)}for(var r=this.contactEquations,s=this.frictionEquations,a=0;a<r.length;a++)this.contactEquationPool.release(r[a]);for(var a=0;a<s.length;a++)this.frictionEquationPool.release(s[a]);this.contactEquations.length=this.frictionEquations.length=0},o.prototype.createContactEquation=function(t,e,i,o){var n=this.contactEquationPool.get(),r=this.currentContactMaterial;return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=o,n.enabled=this.enabledEquations,n.firstImpact=!this.collidedLastStep(t,e),n.restitution=r.restitution,n.stiffness=r.stiffness,n.relaxation=r.relaxation,n.offset=r.contactSkinSize,n.needsUpdate=!0,n},o.prototype.createFrictionEquation=function(t,e,i,o){var n=this.frictionEquationPool.get(),r=this.currentContactMaterial;return n.bodyA=t,n.bodyB=e,n.shapeA=i,n.shapeB=o,n.setSlipForce(this.slipForce),n.enabled=this.enabledEquations,n.frictionCoefficient=r.friction,n.relativeVelocity=r.surfaceVelocity,n.stiffness=r.frictionStiffness,n.relaxation=r.frictionRelaxation,n.needsUpdate=!0,n.contactEquations.length=0,n},o.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return g(e.contactPointA,t.contactPointA),g(e.contactPointB,t.contactPointB),u.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},o.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),o=e.bodyA;u.set(i.contactPointA,0,0),u.set(i.contactPointB,0,0),u.set(i.t,0,0);for(var n=0;n!==t;n++)e=this.contactEquations[this.contactEquations.length-1-n],e.bodyA===o?(d(i.t,i.t,e.normalA),d(i.contactPointA,i.contactPointA,e.contactPointA),d(i.contactPointB,i.contactPointB,e.contactPointB)):(p(i.t,i.t,e.normalA),d(i.contactPointA,i.contactPointA,e.contactPointB),d(i.contactPointB,i.contactPointB,e.contactPointA)),i.contactEquations.push(e);var r=1/t;return m(i.contactPointA,i.contactPointA,r),m(i.contactPointB,i.contactPointB,r),y(i.t,i.t),u.rotate90cw(i.t,i.t),i},o.prototype[_.CONVEX|_.LINE]=o.prototype.convexLine=function(){return 0},o.prototype[_.LINE|_.BOX]=o.prototype.lineBox=function(){return 0};var H=new M({width:1,height:1}),z=w();o.prototype[_.CONVEX|_.CAPSULE]=o.prototype[_.BOX|_.CAPSULE]=o.prototype.convexCapsule=function(t,e,i,o,r,s,a,l,c){var h=z,p=s.length/2;u.set(h,p,0),u.toGlobalFrame(h,h,a,l);var d=this.circleConvex(r,s,h,l,t,e,i,o,c,s.radius);u.set(h,-p,0),u.toGlobalFrame(h,h,a,l);var f=this.circleConvex(r,s,h,l,t,e,i,o,c,s.radius);if(c&&d+f!==0)return 1;var v=H;n(v,s);var y=this.convexConvex(t,e,i,o,r,v,a,l,c);return y+d+f},o.prototype[_.LINE|_.CAPSULE]=o.prototype.lineCapsule=function(){return 0};var K=w(),Z=w(),Q=new M({width:1,height:1});o.prototype[_.CAPSULE]=o.prototype.capsuleCapsule=function(t,e,i,o,r,s,a,l,c){for(var h,p=K,d=Z,f=0,v=0;v<2;v++){u.set(p,(0===v?-1:1)*e.length/2,0),u.toGlobalFrame(p,p,i,o);for(var y=0;y<2;y++){u.set(d,(0===y?-1:1)*s.length/2,0),u.toGlobalFrame(d,d,a,l),this.enableFrictionReduction&&(h=this.enableFriction,this.enableFriction=!1);var g=this.circleCircle(t,e,p,o,r,s,d,l,c,e.radius,s.radius);if(this.enableFrictionReduction&&(this.enableFriction=h),c&&0!==g)return 1;f+=g}}this.enableFrictionReduction&&(h=this.enableFriction,this.enableFriction=!1);var m=Q;n(m,e);var b=this.convexCapsule(t,m,i,o,r,s,a,l,c);if(this.enableFrictionReduction&&(this.enableFriction=h),c&&0!==b)return 1;if(f+=b,this.enableFrictionReduction){var h=this.enableFriction;this.enableFriction=!1}n(m,s);var w=this.convexCapsule(r,m,a,l,t,e,i,o,c);return this.enableFrictionReduction&&(this.enableFriction=h),c&&0!==w?1:(f+=w,this.enableFrictionReduction&&f&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f)},o.prototype[_.LINE]=o.prototype.lineLine=function(){return 0},o.prototype[_.PLANE|_.LINE]=o.prototype.planeLine=function(t,e,i,o,n,r,s,a,l){var c=k,h=O,b=S,w=F,A=L,x=T,C=I,B=q,E=R,_=U,M=0;u.set(c,-r.length/2,0),u.set(h,r.length/2,0),u.toGlobalFrame(b,c,s,a),u.toGlobalFrame(w,h,s,a),g(c,b),g(h,w),p(A,h,c),y(x,A),u.rotate90cw(E,x),v(B,P,o),_[0]=c,_[1]=h;for(var N=0;N<_.length;N++){var G=_[N];p(C,G,i);var V=f(C,B);if(V<0){if(l)return 1;var D=this.createContactEquation(t,n,e,r);M++,g(D.normalA,B),y(D.normalA,D.normalA),m(C,B,V),p(D.contactPointA,G,C),p(D.contactPointA,D.contactPointA,t.position),p(D.contactPointB,G,s),d(D.contactPointB,D.contactPointB,s),p(D.contactPointB,D.contactPointB,n.position),this.contactEquations.push(D),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}}return l?0:(this.enableFrictionReduction||M&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(M)),M)},o.prototype[_.PARTICLE|_.CAPSULE]=o.prototype.particleCapsule=function(t,e,i,o,n,r,s,a,l){return this.circleLine(t,e,i,o,n,r,s,a,l,r.radius,0)},o.prototype[_.CIRCLE|_.LINE]=o.prototype.circleLine=function(t,e,i,o,n,r,s,a,l,c,h){var c=c||0,h=void 0!==h?h:e.radius,v=k,w=O,A=S,x=F,C=L,B=T,E=I,_=q,M=R,P=N,j=G,X=V,Y=D,H=W,z=U,K=r.length/2;u.set(_,-K,0),u.set(M,K,0),u.toGlobalFrame(P,_,s,a),u.toGlobalFrame(j,M,s,a),g(_,P),g(M,j),p(B,M,_),y(E,B),u.rotate90cw(C,E),p(X,i,_);var Z=f(X,C);p(x,_,s),p(Y,i,s);var Q=h+c;if(Math.abs(Z)<Q){m(v,C,Z),p(A,i,v),m(w,C,f(C,Y)),y(w,w),m(w,w,c),d(A,A,w);var J=f(E,A),$=f(E,_),tt=f(E,M);if(J>$&&J<tt){if(l)return 1;var et=this.createContactEquation(t,n,e,r);return m(et.normalA,v,-1),y(et.normalA,et.normalA),m(et.contactPointA,et.normalA,h),d(et.contactPointA,et.contactPointA,i),p(et.contactPointA,et.contactPointA,t.position),p(et.contactPointB,A,s),d(et.contactPointB,et.contactPointB,s),p(et.contactPointB,et.contactPointB,n.position),this.contactEquations.push(et),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(et)),1}}z[0]=_,z[1]=M;for(var it=0;it<z.length;it++){var ot=z[it];if(p(X,ot,i),b(X)<Math.pow(Q,2)){if(l)return 1;var et=this.createContactEquation(t,n,e,r);return g(et.normalA,X),y(et.normalA,et.normalA),m(et.contactPointA,et.normalA,h),d(et.contactPointA,et.contactPointA,i),p(et.contactPointA,et.contactPointA,t.position),p(et.contactPointB,ot,s),m(H,et.normalA,-c),d(et.contactPointB,et.contactPointB,H),d(et.contactPointB,et.contactPointB,s),p(et.contactPointB,et.contactPointB,n.position),this.contactEquations.push(et),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(et)),1}}return 0},o.prototype[_.CIRCLE|_.CAPSULE]=o.prototype.circleCapsule=function(t,e,i,o,n,r,s,a,l){return this.circleLine(t,e,i,o,n,r,s,a,l,r.radius)},o.prototype[_.CIRCLE|_.CONVEX]=o.prototype[_.CIRCLE|_.BOX]=o.prototype.circleConvex=function(t,e,i,o,n,r,a,l,c,h){var h=void 0!==h?h:e.radius,v=k,w=O,A=S,x=F,C=L,B=T,E=I,_=q,M=N,P=G,R=D,V=W,U=j,X=-1,Y=Number.MAX_VALUE;u.set(B,0,0),u.toLocalFrame(E,i,a,l);for(var H=r.vertices,z=r.normals,K=H.length,Z=-1,Q=-Number.MAX_VALUE,J=r.boundingRadius+h,$=0;$<K;$++){p(_,E,H[$]);var tt=f(z[$],_);if(tt>J)return 0;tt>Q&&(Q=tt,Z=$)}for(var $=Z+K-1;$<Z+K+2;$++){var et=H[$%K],it=z[$%K];if(m(V,it,-h),d(V,V,E),s(V,r)){p(U,et,V);var ot=Math.abs(f(U,it));ot<Y&&(Y=ot,X=$)}}if(X!==-1){if(c)return 1;var et=H[X%K],nt=H[(X+1)%K];u.toGlobalFrame(v,et,a,l),u.toGlobalFrame(w,nt,a,l),p(A,w,v),y(x,A),u.rotate90cw(C,x),m(V,C,-h),d(V,V,i),m(R,C,Y),d(R,R,V);var rt=this.createContactEquation(t,n,e,r);return p(rt.normalA,V,i),y(rt.normalA,rt.normalA),m(rt.contactPointA,rt.normalA,h),d(rt.contactPointA,rt.contactPointA,i),p(rt.contactPointA,rt.contactPointA,t.position),p(rt.contactPointB,R,a),d(rt.contactPointB,rt.contactPointB,a),p(rt.contactPointB,rt.contactPointB,n.position),this.contactEquations.push(rt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(rt)),1}if(h>0&&Z!==-1)for(var $=Z+K;$<Z+K+2;$++){var st=H[$%K];if(p(M,st,E),b(M)<h*h){if(c)return 1;u.toGlobalFrame(P,st,a,l),p(M,P,i);var rt=this.createContactEquation(t,n,e,r);return g(rt.normalA,M),y(rt.normalA,rt.normalA),m(rt.contactPointA,rt.normalA,h),d(rt.contactPointA,rt.contactPointA,i),p(rt.contactPointA,rt.contactPointA,t.position),p(rt.contactPointB,P,a),d(rt.contactPointB,rt.contactPointB,a),p(rt.contactPointB,rt.contactPointB,n.position),this.contactEquations.push(rt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(rt)),1}}return 0};var J=w(),$=w(),tt=w();o.prototype[_.PARTICLE|_.CONVEX]=o.prototype[_.PARTICLE|_.BOX]=o.prototype.particleConvex=function(t,e,i,o,n,s,a,l,c){var h=k,b=O,w=S,A=F,x=L,C=T,B=I,E=D,_=W,M=j,P=Number.MAX_VALUE,q=!1,R=s.vertices;if(!r(i,s,a,l))return 0;if(c)return 1;for(var N=0,G=R.length;N!==G+1;N++){var V=R[N%G],U=R[(N+1)%G];v(h,V,l),v(b,U,l),d(h,h,a),d(b,b,a),p(w,b,h),y(A,w),u.rotate90cw(x,A),p(C,h,a),p(B,i,a),p(_,h,i);var X=Math.abs(f(_,x));X<P&&(P=X,m(E,x,X),d(E,E,i),g(M,x),q=!0)}if(q){var Y=this.createContactEquation(t,n,e,s);return m(Y.normalA,M,-1),y(Y.normalA,Y.normalA),u.set(Y.contactPointA,0,0),d(Y.contactPointA,Y.contactPointA,i),p(Y.contactPointA,Y.contactPointA,t.position),p(Y.contactPointB,E,a),d(Y.contactPointB,Y.contactPointB,a),p(Y.contactPointB,Y.contactPointB,n.position),this.contactEquations.push(Y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Y)),1}return 0},o.prototype[_.CIRCLE]=o.prototype.circleCircle=function(t,e,i,o,n,r,s,l,c,h,u){var d=k,h=h||e.radius,u=u||r.radius;p(d,i,s);var f=h+u;if(b(d)>f*f)return 0;if(c)return 1;var v=this.createContactEquation(t,n,e,r),g=v.contactPointA,w=v.contactPointB,A=v.normalA;return p(A,s,i),y(A,A),m(g,A,h),m(w,A,-u),a(g,g,i,t.position),a(w,w,s,n.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},o.prototype[_.PLANE|_.CONVEX]=o.prototype[_.PLANE|_.BOX]=o.prototype.planeConvex=function(t,e,i,o,n,r,s,a,l){var c=k,h=O,d=S,y=F,b=L,w=T,A=0;v(h,P,o),u.vectorToLocalFrame(b,h,a),u.toLocalFrame(y,i,s,a);for(var x=r.vertices,C=0,B=x.length;C!==B;C++){var E=x[C];if(p(w,E,y),f(w,b)<=0){if(l)return 1;u.toGlobalFrame(c,E,s,a),p(d,c,i),A++;var _=this.createContactEquation(t,n,e,r);p(d,c,i),g(_.normalA,h);var M=f(d,_.normalA);m(d,_.normalA,M),p(_.contactPointB,c,n.position),p(_.contactPointA,c,d),p(_.contactPointA,_.contactPointA,t.position),this.contactEquations.push(_),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(_))}}return this.enableFrictionReduction&&this.enableFriction&&A&&this.frictionEquations.push(this.createFrictionFromAverage(A)),A},o.prototype[_.PARTICLE|_.PLANE]=o.prototype.particlePlane=function(t,e,i,o,n,r,s,a,l){var c=k,h=O;a=a||0,p(c,i,s),v(h,P,a);var u=f(c,h);if(u>0)return 0;if(l)return 1;var d=this.createContactEquation(n,t,r,e);return g(d.normalA,h),m(c,d.normalA,u),p(d.contactPointA,i,c),p(d.contactPointA,d.contactPointA,n.position),p(d.contactPointB,i,t.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1},o.prototype[_.CIRCLE|_.PARTICLE]=o.prototype.circleParticle=function(t,e,i,o,n,r,s,a,l){var c=k,h=e.radius;if(p(c,s,i),b(c)>h*h)return 0;if(l)return 1;var u=this.createContactEquation(t,n,e,r),f=u.normalA,v=u.contactPointA,w=u.contactPointB;return g(f,c),y(f,f),m(v,f,h),d(v,v,i),p(v,v,t.position),p(w,s,n.position),this.contactEquations.push(u),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(u)),1};var et=new B({radius:1}),it=w(),ot=w();o.prototype[_.PLANE|_.CAPSULE]=o.prototype.planeCapsule=function(t,e,i,o,n,r,s,a,l){var c=it,h=ot,p=et,d=r.length/2;u.set(c,-d,0),u.set(h,d,0),u.toGlobalFrame(c,c,s,a),u.toGlobalFrame(h,h,s,a),p.radius=r.radius;var f;this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(n,p,c,0,t,e,i,o,l),y=this.circlePlane(n,p,h,0,t,e,i,o,l);if(this.enableFrictionReduction&&(this.enableFriction=f),l)return v+y;var g=v+y;return this.enableFrictionReduction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},o.prototype[_.CIRCLE|_.PLANE]=o.prototype.circlePlane=function(t,e,i,o,n,r,s,a,l){var c=e.radius,h=k,u=O,y=S;p(h,i,s),v(u,P,a);var b=f(u,h);if(b>c)return 0;if(l)return 1;var w=this.createContactEquation(n,t,r,e);g(w.normalA,u);var A=w.contactPointB;m(A,w.normalA,-c),d(A,A,i),p(A,A,t.position);var x=w.contactPointA;return m(y,w.normalA,b),p(x,h,y),d(x,x,s),p(x,x,n.position),this.contactEquations.push(w),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w)),1};var nt=u.create(),rt=u.create(),st=u.create(),at=u.create(),lt=u.create(),ct=u.create(),ht=u.create(),ut=u.create(),pt=u.create(),dt=u.create(),ft=u.create(),vt=u.create(),yt=u.create(),gt=u.create(),mt=u.create(),bt=u.create(),wt=[u.create(),u.create()],At=[u.create(),u.create()],xt=[u.create(),u.create()],Ct=2;o.prototype[_.CONVEX]=o.prototype[_.CONVEX|_.BOX]=o.prototype[_.BOX]=o.prototype.convexConvex=function(t,e,i,o,n,r,s,a,d){var f=0,v=bt,y=ct,g=ht,m=l(y,e,i,o,r,s,a),b=y[0];if(b>f)return 0;var w=l(g,r,s,a,e,i,o),A=g[0];if(A>f)return 0;var x,C,B,E,_,M,P,k,O,S;A>b?(x=r,C=e,P=n,k=t,B=s,_=a,E=i,M=o,O=w,S=1):(x=e,C=r,P=t,k=n,B=i,_=o,E=s,M=a,O=m,S=0);var F=xt;c(F,x,B,_,O,C,E,M);var L=x.vertices.length,T=x.vertices,I=O,q=O+1<L?O+1:0,R=gt,N=mt;u.copy(R,T[I]),u.copy(N,T[q]);var G=ut;u.subtract(G,N,R),u.normalize(G,G);var V=pt;u.crossVZ(V,G,1);var D=dt;u.add(D,R,N),u.scale(D,D,.5);var W=ft;u.rotate(W,G,_);var j=vt;u.crossVZ(j,W,1),u.toGlobalFrame(R,R,B,_),u.toGlobalFrame(N,N,B,_);var U=u.dot(j,R),X=-u.dot(W,R)+f,Y=u.dot(W,N)+f,H=wt,z=At,K=0,Z=yt;if(u.scale(Z,W,-1),K=h(H,F,Z,X,I),K<2)return 0;if(K=h(z,H,W,Y,q),K<2)return 0;for(var Q=0,J=0;J<Ct;++J){var $=u.dot(j,z[J])-U;if($<=f){if(d)return 1;++Q;var tt=this.createContactEquation(P,k,x,C);u.copy(tt.normalA,j),u.copy(tt.contactPointB,z[J]),p(tt.contactPointB,tt.contactPointB,k.position),u.scale(v,j,-$),u.add(tt.contactPointA,z[J],v),p(tt.contactPointA,tt.contactPointA,P.position),this.contactEquations.push(tt),this.enableFriction&&!this.enableFrictionReduction&&this.frictionEquations.push(this.createFrictionFromContact(tt))}}return Q&&this.enableFrictionReduction&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(Q)),Q};var Bt=w(),Et=w(),_t=w(),Mt=w(),Pt=w(),kt=w(),Ot=w();o.prototype[_.CIRCLE|_.HEIGHTFIELD]=o.prototype.circleHeightfield=function(t,e,i,o,n,r,s,a,l,c){var h=r.heights,c=c||e.radius,w=r.elementWidth,A=Et,x=Bt,C=Pt,B=Ot,E=kt,_=_t,M=Mt,P=Math.floor((i[0]-c-s[0])/w),k=Math.ceil((i[0]+c-s[0])/w);P<0&&(P=0),k>=h.length&&(k=h.length-1);for(var O=h[P],S=h[k],F=P;F<k;F++)h[F]<S&&(S=h[F]),h[F]>O&&(O=h[F]);if(i[1]-c>O)return 0;for(var L=!1,F=P;F<k;F++){u.set(_,F*w,h[F]),u.set(M,(F+1)*w,h[F+1]),d(_,_,s),d(M,M,s),p(E,M,_),v(E,E,Math.PI/2),y(E,E),m(x,E,-c),d(x,x,i),p(A,x,_);var T=f(A,E);if(x[0]>=_[0]&&x[0]<M[0]&&T<=0){if(l)return 1;L=!0,m(A,E,-T),d(C,x,A),g(B,E);var I=this.createContactEquation(n,t,r,e);g(I.normalA,B),m(I.contactPointB,I.normalA,-c),d(I.contactPointB,I.contactPointB,i),p(I.contactPointB,I.contactPointB,t.position),g(I.contactPointA,C),p(I.contactPointA,I.contactPointA,n.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}}if(L=!1,c>0)for(var F=P;F<=k;F++)if(u.set(_,F*w,h[F]),d(_,_,s),p(A,i,_),b(A)<Math.pow(c,2)){if(l)return 1;L=!0;var I=this.createContactEquation(n,t,r,e);g(I.normalA,A),y(I.normalA,I.normalA),m(I.contactPointB,I.normalA,-c),d(I.contactPointB,I.contactPointB,i),p(I.contactPointB,I.contactPointB,t.position),p(I.contactPointA,_,s),d(I.contactPointA,I.contactPointA,s),p(I.contactPointA,I.contactPointA,n.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}return L?1:0};var St=w(),Ft=w(),Lt=w(),Tt=new E({vertices:[w(),w(),w(),w()]});o.prototype[_.BOX|_.HEIGHTFIELD]=o.prototype[_.CONVEX|_.HEIGHTFIELD]=o.prototype.convexHeightfield=function(t,e,i,o,n,r,s,a,l){var c=r.heights,h=r.elementWidth,f=St,v=Ft,y=Lt,m=Tt,b=Math.floor((t.aabb.lowerBound[0]-s[0])/h),w=Math.ceil((t.aabb.upperBound[0]-s[0])/h);b<0&&(b=0),w>=c.length&&(w=c.length-1);for(var A=c[b],x=c[w],C=b;C<w;C++)c[C]<x&&(x=c[C]),c[C]>A&&(A=c[C]);if(t.aabb.lowerBound[1]>A)return 0;for(var B=0,C=b;C<w;C++){u.set(f,C*h,c[C]),u.set(v,(C+1)*h,c[C+1]),d(f,f,s),d(v,v,s);var E=100;u.set(y,.5*(v[0]+f[0]),.5*(v[1]+f[1]-E)),p(m.vertices[0],v,y),p(m.vertices[1],f,y),g(m.vertices[2],m.vertices[1]),g(m.vertices[3],m.vertices[0]),m.vertices[2][1]-=E,m.vertices[3][1]-=E,m.updateNormals(),B+=this.convexConvex(t,e,i,o,n,m,y,0,l)}return B}},function(t,e,i){"use strict";function o(){this.data={},this.keys=[]}var n=i(12);t.exports=o,o.prototype.getKey=function(t,e){return t|=0,e|=0,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},o.prototype.getByKey=function(t){return t|=0,this.data[t]},o.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},o.prototype.set=function(t,e,i){if(!i)throw new Error("No data!");var o=this.getKey(t,e);return this.data[o]||this.keys.push(o),this.data[o]=i,o},o.prototype.reset=function(){for(var t=this.data,e=this.keys,i=e.length;i--;)delete t[e[i]];e.length=0},o.prototype.copy=function(t){this.reset(),n.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var i=t.keys[e];this.data[i]=t.data[i]}}},function(t,e,i){"use strict";function o(t){t=t||{};var e=this.width=void 0!==t.width?t.width:1,i=this.height=void 0!==t.height?t.height:1,o=[n.fromValues(-e/2,-i/2),n.fromValues(e/2,-i/2),n.fromValues(e/2,i/2),n.fromValues(-e/2,i/2)],l=s(t);l.vertices=o,l.type=r.BOX,a.call(this,l)}var n=i(11),r=i(22),s=i(12).shallowClone,a=i(21);t.exports=o,o.prototype=new a,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){var t=this.width,e=this.height;return(e*e+t*t)/12},o.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},o.prototype.computeAABB=function(t,e,i){var o=Math.abs(Math.cos(i)),n=Math.abs(Math.sin(i)),r=this.width,s=this.height,a=.5*(r*n+s*o),l=.5*(s*n+r*o),c=t.lowerBound,h=t.upperBound,u=e[0],p=e[1];c[0]=u-l,c[1]=p-a,h[0]=u+l,h[1]=p+a},o.prototype.updateArea=function(){this.area=this.width*this.height},o.prototype.pointTest=function(t){return Math.abs(t[0])<=.5*this.width&&Math.abs(t[1])<=.5*this.height}},function(t,e,i){"use strict";function o(){n.call(this,n.NAIVE)}var n=i(27);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var o=0,r=e.length;o!==r;o++)for(var s=e[o],a=0;a<o;a++){var l=e[a];n.canCollide(s,l)&&this.boundingVolumeCheck(s,l)&&i.push(s,l)}return i},o.prototype.aabbQuery=function(t,e,i){i=i||[];for(var o=t.bodies,n=0;n<o.length;n++){var r=o[n];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&i.push(r)}return i}},function(t,e,i){"use strict";function o(t){t=t?r(t):{},t.type=n.PARTICLE,n.call(this,t)}var n=i(22),r=i(12).shallowClone,s=i(11).copy;t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=0},o.prototype.computeAABB=function(t,e){s(t.lowerBound,e),s(t.upperBound,e)}},function(t,e,i){"use strict";function o(t){t=t?s.shallowClone(t):{},t.type=n.PLANE,n.call(this,t)}var n=i(22),r=i(11),s=i(12);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeMomentOfInertia=function(){return 0},o.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},o.prototype.computeAABB=function(t,e,i){var o=i%(2*Math.PI),n=r.set,s=1e7,a=t.lowerBound,l=t.upperBound;n(a,-s,-s),n(l,s,s),0===o?l[1]=e[1]:o===Math.PI/2?a[0]=e[0]:o===Math.PI?a[1]=e[1]:o===3*Math.PI/2&&(l[0]=e[0])},o.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var a=r.create(),l=r.create(),c=r.create();o.prototype.raycast=function(t,e,i,o){var n=e.from,s=e.to,h=e.direction,u=a,p=l,d=c;r.set(p,0,1),r.rotate(p,p,o),r.subtract(d,n,i);var f=r.dot(d,p);r.subtract(d,s,i);var v=r.dot(d,p);if(!(f*v>0||r.squaredDistance(n,s)<f*f)){var y=r.dot(p,h);r.subtract(u,n,i);var g=-r.dot(p,u)/y/e.length;e.reportIntersection(t,g,p,-1)}},o.prototype.pointTest=function(t){return t[1]<=0}},function(t,e,i){"use strict";function o(t,e,i){i=i||{},n.call(this,t,e,n.REVOLUTE,i);var o=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE,f=this.pivotA=l.create(),w=this.pivotB=l.create();i.worldPivot?(c(f,i.worldPivot,t.position),c(w,i.worldPivot,e.position),u(f,f,-t.angle),u(w,w,-e.angle)):(i.localPivotA&&d(f,i.localPivotA),i.localPivotB&&d(w,i.localPivotB));var A=this.motorEquation=new s(t,e);A.enabled=!1;var x=this.upperLimitEquation=new a(t,e),C=this.lowerLimitEquation=new a(t,e);x.minForce=C.maxForce=0;var B=this.equations=[new r(t,e,-o,o),new r(t,e,-o,o),A,x,C],E=B[0],_=B[1];E.computeGq=function(){return u(v,f,t.angle),u(y,w,e.angle),h(b,e.position,y),c(b,b,t.position),c(b,b,v),p(b,g)},_.computeGq=function(){return u(v,f,t.angle),u(y,w,e.angle),h(b,e.position,y),c(b,b,t.position),c(b,b,v),p(b,m)},_.minForce=E.minForce=-o,_.maxForce=E.maxForce=o,E.G[0]=-1,E.G[1]=0,E.G[3]=1,E.G[4]=0,_.G[0]=0,_.G[1]=-1,_.G[3]=0,_.G[4]=1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0}var n=i(30),r=i(14),s=i(52),a=i(53),l=i(11),c=l.subtract,h=l.add,u=l.rotate,p=l.dot,d=l.copy,f=l.crossLength;t.exports=o;var v=l.create(),y=l.create(),g=l.fromValues(1,0),m=l.fromValues(0,1),b=l.create();o.prototype=new n,o.prototype.constructor=o,o.prototype.setLimits=function(t,e){this.lowerLimit=t,this.upperLimit=e,this.lowerLimitEnabled=this.upperLimitEnabled=!0},o.prototype.update=function(){var t=this.bodyA,e=this.bodyB,i=this.pivotA,o=this.pivotB,n=this.equations,r=n[0],s=n[1],a=this.upperLimit,l=this.lowerLimit,c=this.upperLimitEquation,h=this.lowerLimitEquation,p=this.angle=e.angle-t.angle;c.angle=a,c.enabled=this.upperLimitEnabled&&p>a,h.angle=l,h.enabled=this.lowerLimitEnabled&&p<l,u(v,i,t.angle),u(y,o,e.angle);var d=r.G;d[2]=-f(v,g),d[5]=f(y,g);var b=s.G;b[2]=-f(v,m),b[5]=f(y,m)},Object.defineProperties(o.prototype,{motorEnabled:{get:function(){return this.motorEquation.enabled},set:function(t){this.motorEquation.enabled=t}},motorSpeed:{get:function(){return this.motorEquation.relativeVelocity},set:function(t){this.motorEquation.relativeVelocity=t}},motorMaxForce:{get:function(){return this.motorEquation.maxForce},set:function(t){var e=this.motorEquation;e.maxForce=t,e.minForce=-t}}}),o.prototype.enableMotor=function(){console.warn("revolute.enableMotor() is deprecated, do revolute.motorEnabled = true; instead."),this.motorEnabled=!0},o.prototype.disableMotor=function(){console.warn("revolute.disableMotor() is deprecated, do revolute.motorEnabled = false; instead."),this.motorEnabled=!1},o.prototype.motorIsEnabled=function(){return console.warn("revolute.motorIsEnabled() is deprecated, use revolute.motorEnabled instead."),this.motorEnabled},o.prototype.setMotorSpeed=function(t){console.warn("revolute.setMotorSpeed(speed) is deprecated, do revolute.motorSpeed = speed; instead."),this.motorSpeed=t},o.prototype.getMotorSpeed=function(){return console.warn("revolute.getMotorSpeed() is deprecated, use revolute.motorSpeed instead."),this.motorSpeed}},function(t,e,i){"use strict";function o(t,e){n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var n=i(14);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.computeB=function(t,e,i){var o=this.G;o[2]=-1,o[5]=this.ratio;var n=this.computeGiMf(),r=this.computeGW(),s=-r*e-i*n;return s}},function(t,e,i){"use strict";function o(t,e,i){i=i||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=i.angle||0;var o=this.G;o[2]=1,o[5]=-1}var n=i(14),r=i(11);t.exports=o,o.prototype=new n,o.prototype.constructor=o;var s=r.create(),a=r.create(),l=r.fromValues(1,0),c=r.fromValues(0,1);o.prototype.computeGq=function(){return r.rotate(s,l,this.bodyA.angle+this.angle),r.rotate(a,c,this.bodyB.angle),r.dot(s,a)}},function(t,e,i){"use strict";function o(t,e,i){i=i||{},n.call(this,t,e,n.PRISMATIC,i);var o=a.create(),c=a.fromValues(1,0),h=a.create();i.localAnchorA&&a.copy(o,i.localAnchorA),i.localAxisA&&a.copy(c,i.localAxisA),i.localAnchorB&&a.copy(h,i.localAnchorB),this.localAnchorA=o,this.localAnchorB=h,this.localAxisA=c;var u=this.maxForce=void 0!==i.maxForce?i.maxForce:Number.MAX_VALUE,p=new s(t,e,-u,u),d=new a.create,f=new a.create,v=new a.create,y=new a.create;if(p.computeGq=function(){return a.dot(v,y)},p.updateJacobian=function(){var i=this.G,n=t.position,r=e.position;a.rotate(d,o,t.angle),a.rotate(f,h,e.angle),a.add(v,r,f),a.subtract(v,v,n),a.subtract(v,v,d),a.rotate(y,c,t.angle+Math.PI/2),i[0]=-y[0],i[1]=-y[1],i[2]=-a.crossLength(d,y)+a.crossLength(y,v),i[3]=y[0],i[4]=y[1],i[5]=a.crossLength(f,y)},this.equations.push(p),!i.disableRotationalLock){var g=new l(t,e,-u,u);this.equations.push(g)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==i.lowerLimit,this.upperLimitEnabled=void 0!==i.upperLimit,this.lowerLimit=void 0!==i.lowerLimit?i.lowerLimit:0,this.upperLimit=void 0!==i.upperLimit?i.upperLimit:1,this.upperLimitEquation=new r(t,e),this.lowerLimitEquation=new r(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=u,this.motorEquation=new s(t,e),this.motorEnabled=!1,this.motorSpeed=0;var m=this,b=this.motorEquation;b.computeGq=function(){return 0},b.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,o=e.velocity,n=i.velocity,r=e.angularVelocity,s=i.angularVelocity;return this.gmult(t,o,r,n,s)+m.motorSpeed}}var n=i(30),r=i(31),s=i(14),a=i(11),l=i(53);t.exports=o,o.prototype=new n,o.prototype.constructor=o;var c=a.create(),h=a.create(),u=a.create(),p=a.create(),d=a.create(),f=a.create();o.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,o=this.lowerLimit,n=this.upperLimitEquation,r=this.lowerLimitEquation,s=this.bodyA,l=this.bodyB,v=this.localAxisA,y=this.localAnchorA,g=this.localAnchorB;e.updateJacobian(),a.rotate(c,v,s.angle),a.rotate(p,y,s.angle),a.add(h,p,s.position),a.rotate(d,g,l.angle),a.add(u,d,l.position);var m=this.position=a.dot(u,c)-a.dot(h,c);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=c[0],b[1]=c[1],b[2]=a.crossLength(c,d),b[3]=-c[0],b[4]=-c[1],b[5]=-a.crossLength(c,p)}if(this.upperLimitEnabled&&m>i)a.scale(n.normalA,c,-1),a.subtract(n.contactPointA,h,s.position),a.subtract(n.contactPointB,u,l.position),a.scale(f,c,i),a.add(n.contactPointA,n.contactPointA,f),t.indexOf(n)===-1&&t.push(n);else{var w=t.indexOf(n);w!==-1&&t.splice(w,1)}if(this.lowerLimitEnabled&&m<o)a.scale(r.normalA,c,1),a.subtract(r.contactPointA,h,s.position),a.subtract(r.contactPointB,u,l.position),a.scale(f,c,o),a.subtract(r.contactPointB,r.contactPointB,f),t.indexOf(r)===-1&&t.push(r);else{var w=t.indexOf(r);w!==-1&&t.splice(w,1)}},o.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},o.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},o.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},function(t,e,i){"use strict";function o(){s.call(this,s.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var i=t.axisList.indexOf(e.body);i!==-1&&t.axisList.splice(i,1)}}function n(t,e){e|=0;for(var i=1,o=t.length;i<o;i++){for(var n=t[i],r=i-1;r>=0&&!(t[r].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);r--)t[r+1]=t[r];t[r+1]=n}return t}var r=i(12),s=i(27);t.exports=o,o.prototype=new s,o.prototype.constructor=o,o.prototype.setWorld=function(t){this.axisList.length=0,r.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},o.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;n(t,e)},o.prototype.getCollisionPairs=function(){var t=this.axisList,e=this.result,i=this.axisIndex;e.length=0;for(var o=t.length;o--;){var n=t[o];n.aabbNeedsUpdate&&n.updateAABB()}this.sortList();for(var r=0,a=0|t.length;r!==a;r++)for(var l=t[r],c=r+1;c<a;c++){var h=t[c],u=h.aabb.lowerBound[i]<=l.aabb.upperBound[i];if(!u)break;s.canCollide(l,h)&&this.boundingVolumeCheck(l,h)&&e.push(l,h)}return e},o.prototype.aabbQuery=function(t,e,i){i=i||[],this.sortList();for(var o=this.axisList,n=0;n<o.length;n++){var r=o[n];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&i.push(r)}return i}},function(t,e){"use strict";function i(t,e,i){i=i||{},this.stiffness=void 0!==i.stiffness?i.stiffness:100,this.damping=void 0!==i.damping?i.damping:1,this.bodyA=t,this.bodyB=e}t.exports=i,i.prototype.applyForce=function(){}},function(t,e,i){"use strict";function o(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new l({mass:0}),this.world=null;var i=this;this.preStepCallback=function(){i.update()}}function n(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new a(t.chassisBody,t.groundBody),this.sideEquation=new a(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=r.fromValues(0,1),e.localForwardVector&&r.copy(this.localForwardVector,e.localForwardVector),this.localPosition=r.create(),e.localPosition&&r.copy(this.localPosition,e.localPosition),s.call(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var r=i(11),s=i(30),a=i(37),l=i(15);t.exports=o,o.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}},o.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null},o.prototype.addWheel=function(t){var e=new n(this,t);return this.wheels.push(e),e},o.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},n.prototype=new s,n.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},n.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=r.create(),h=r.create();n.prototype.getSpeed=function(){var t=this.vehicle.chassisBody;return t.vectorToWorldFrame(h,this.localForwardVector),t.getVelocityAtPoint(c,h),r.dot(c,h)};var u=r.create();n.prototype.update=function(){var t=this.vehicle.chassisBody,e=this.forwardEquation,i=this.sideEquation,o=this.steerValue;t.vectorToWorldFrame(e.t,this.localForwardVector),r.rotate(i.t,this.localForwardVector,Math.PI/2),t.vectorToWorldFrame(i.t,i.t),r.rotate(e.t,e.t,o),r.rotate(i.t,i.t,o),t.toWorldFrame(e.contactPointB,this.localPosition),r.copy(i.contactPointB,e.contactPointB),t.vectorToWorldFrame(e.contactPointA,this.localPosition),r.copy(i.contactPointA,e.contactPointA),r.normalize(u,e.t),
r.scale(u,u,this.engineForce),this.vehicle.chassisBody.applyForce(u,e.contactPointA)}},function(t,e,i){"use strict";function o(t,e,i){i=i||{},r.call(this,t,e,i),this.localAnchorA=n.create(),this.localAnchorB=n.create(),i.localAnchorA&&n.copy(this.localAnchorA,i.localAnchorA),i.localAnchorB&&n.copy(this.localAnchorB,i.localAnchorB),i.worldAnchorA&&this.setWorldAnchorA(i.worldAnchorA),i.worldAnchorB&&this.setWorldAnchorB(i.worldAnchorB);var o=n.create(),s=n.create();this.getWorldAnchorA(o),this.getWorldAnchorB(s);var a=n.distance(o,s);this.restLength=void 0!==i.restLength?i.restLength:a}var n=i(11),r=i(56);t.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},o.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},o.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},o.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var s=n.create(),a=n.create(),l=n.create(),c=n.create(),h=n.create(),u=n.create(),p=n.create(),d=n.create(),f=n.create();o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,o=this.bodyA,r=this.bodyB,v=s,y=a,g=l,m=c,b=f,w=h,A=u,x=p,C=d;this.getWorldAnchorA(w),this.getWorldAnchorB(A),n.subtract(x,w,o.position),n.subtract(C,A,r.position),n.subtract(v,A,w);var B=n.length(v);n.normalize(y,v),n.subtract(g,r.velocity,o.velocity),n.crossZV(b,r.angularVelocity,C),n.add(g,g,b),n.crossZV(b,o.angularVelocity,x),n.subtract(g,g,b),n.scale(m,y,-t*(B-i)-e*n.dot(g,y)),n.subtract(o.force,o.force,m),n.add(r.force,r.force,m);var E=n.crossLength(x,m),_=n.crossLength(C,m);o.angularForce-=E,r.angularForce+=_}},function(t,e,i){"use strict";function o(t,e,i){i=i||{},n.call(this,t,e,i),this.restAngle=void 0!==i.restAngle?i.restAngle:e.angle-t.angle}var n=i(56);t.exports=o,o.prototype=new n,o.prototype.constructor=o,o.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,o=this.bodyA,n=this.bodyB,r=n.angle-o.angle,s=n.angularVelocity-o.angularVelocity,a=-t*(r-i)-e*s*0;o.angularForce-=a,n.angularForce+=a}},function(t,e,i){"use strict";function o(t){u.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new l,this.narrowphase=new g,this.gravity=c.fromValues(0,-9.78),t.gravity&&c.copy(this.gravity,t.gravity),this.frictionGravity=c.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new y,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new d,this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this.sleepMode=o.NO_SLEEPING,this.unionFind=new A(1),this._constraintIdCounter=0,this._bodyIdCounter=0,this.overlapKeeper=new w}function n(t,e){return t.islandId-e.islandId}function r(t,e){var i=t.bodyA.islandId>0?t.bodyA.islandId:t.bodyB.islandId,o=e.bodyA.islandId>0?e.bodyA.islandId:e.bodyB.islandId;return i!==o?i-o:t.index-e.index}function s(t,e,i,o,n,r,s,a,l,h,u,d){if(0!==(o.collisionGroup&a.collisionMask)&&0!==(a.collisionGroup&o.collisionMask)&&(c.toGlobalFrame(F,n,i.position,i.angle),c.toGlobalFrame(L,l,s.position,s.angle),!(c.distance(F,L)>o.boundingRadius+a.boundingRadius))){var f=r+i.angle,v=h+s.angle;e.enableFriction=u.friction>0;var y;y=i.type===p.STATIC||i.type===p.KINEMATIC?s.mass:s.type===p.STATIC||s.type===p.KINEMATIC?i.mass:i.mass*s.mass/(i.mass+s.mass),e.slipForce=u.friction*d*y,e.currentContactMaterial=u,e.enabledEquations=i.collisionResponse&&s.collisionResponse&&o.collisionResponse&&a.collisionResponse;var g=e[o.type|a.type],m=0;if(g){var b=o.sensor||a.sensor,w=e.frictionEquations.length;m=o.type<a.type?g.call(e,i,o,F,f,s,a,L,v,b):g.call(e,s,a,L,v,i,o,F,f,b);var A=e.frictionEquations.length-w;if(m){if(i.allowSleep&&i.type===p.DYNAMIC&&i.sleepState===p.SLEEPING&&s.sleepState===p.AWAKE&&s.type!==p.STATIC){var x=c.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2),C=Math.pow(s.sleepSpeedLimit,2);x>=2*C&&(i._wakeUpAfterNarrowphase=!0)}if(s.allowSleep&&s.type===p.DYNAMIC&&s.sleepState===p.SLEEPING&&i.sleepState===p.AWAKE&&i.type!==p.STATIC){var B=c.squaredLength(i.velocity)+Math.pow(i.angularVelocity,2),E=Math.pow(i.sleepSpeedLimit,2);B>=2*E&&(s._wakeUpAfterNarrowphase=!0)}if(t.overlapKeeper.setOverlapping(i,o,s,a),t.has("beginContact")&&t.overlapKeeper.isNewOverlap(o,a)){var _=P;if(_.shapeA=o,_.shapeB=a,_.bodyA=i,_.bodyB=s,_.contactEquations.length=0,!b)for(var M=e.contactEquations.length-m;M<e.contactEquations.length;M++)_.contactEquations.push(e.contactEquations[M]);t.emit(_)}if(!b&&A>1)for(var M=e.frictionEquations.length-A;M<e.frictionEquations.length;M++){var k=e.frictionEquations[M];k.setSlipForce(k.getSlipForce()/A)}}}}}function a(t,e){for(var i=t.constraints,o=0;o!==i.length;o++)for(var n=i[o],r=n.equations,s=0;s!==r.length;s++){var a=r[s];a.relaxation=void 0!==e.relaxation?e.relaxation:a.relaxation,a.stiffness=void 0!==e.stiffness?e.stiffness:a.stiffness,a.needsUpdate=!0}}var l=i(40),c=i(11),h=i(22),u=i(26),p=i(15),d=i(35),f=i(34),v=i(10),y=i(55),g=i(45),m=i(12),b=m.arrayRemove,w=i(61),A=i(64);t.exports=o,o.prototype=new Object(u.prototype),o.prototype.constructor=o;var x={type:"postStep"},C={type:"addBody",body:null},B={type:"removeBody",body:null},E={type:"addSpring",spring:null},_={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},M={type:"postBroadphase",pairs:null},P={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},k={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},O={type:"preSolve",contactEquations:null,frictionEquations:null};o.NO_SLEEPING=1,o.BODY_SLEEPING=2,o.ISLAND_SLEEPING=4,o.prototype.addConstraint=function(t){if(this.stepping)throw new Error("Constraints cannot be added during step.");var e=this.bodies;if(e.indexOf(t.bodyA)===-1)throw new Error("Cannot add Constraint: bodyA is not added to the World.");if(e.indexOf(t.bodyB)===-1)throw new Error("Cannot add Constraint: bodyB is not added to the World.");this.constraints.push(t)},o.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},o.prototype.removeContactMaterial=function(t){b(this.contactMaterials,t)},o.prototype.getContactMaterial=function(t,e){for(var i=this.contactMaterials,o=0,n=i.length;o!==n;o++){var r=i[o];if(r.materialA===t&&r.materialB===e||r.materialA===e&&r.materialB===t)return r}return!1},o.prototype.removeConstraint=function(t){if(this.stepping)throw new Error("Constraints cannot be removed during step.");b(this.constraints,t)};var S=c.create(),F=c.create(),L=c.create();o.prototype.step=function(t,e,i){if(i=i||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var o=0;this.accumulator>=t&&o<i;)this.internalStep(t),this.time+=t,this.accumulator-=t,o++;for(var n=this.accumulator%t/t,r=0;r!==this.bodies.length;r++){var s=this.bodies[r];c.lerp(s.interpolatedPosition,s.previousPosition,s.position,n),s.interpolatedAngle=s.previousAngle+n*(s.angle-s.previousAngle)}}};var T=[];o.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,i=this.springs,a=this.bodies,l=this.gravity,h=this.solver,u=this.bodies.length,d=this.broadphase,f=this.narrowphase,v=this.constraints,y=S,g=c.add;if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var b=c.length(this.gravity);0===b&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=b)}if(this.applyGravity)for(var w=0;w!==u;w++){var A=a[w],C=A.force;A.type===p.DYNAMIC&&A.sleepState!==p.SLEEPING&&(c.scale(y,l,A.mass*A.gravityScale),g(C,C,y))}if(this.applySpringForces)for(var w=0;w!==e;w++){var B=i[w];B.applyForce()}if(this.applyDamping)for(var w=0;w!==u;w++){var A=a[w];A.type===p.DYNAMIC&&A.applyDamping(t)}for(var E=d.getCollisionPairs(this),P=this.disabledBodyCollisionPairs,w=P.length-2;w>=0;w-=2)for(var F=E.length-2;F>=0;F-=2)(P[w]===E[F]&&P[w+1]===E[F+1]||P[w+1]===E[F]&&P[w]===E[F+1])&&E.splice(F,2);var L=v.length;for(w=0;w!==L;w++){var I=v[w];if(!I.collideConnected)for(var F=E.length-2;F>=0;F-=2)(I.bodyA===E[F]&&I.bodyB===E[F+1]||I.bodyB===E[F]&&I.bodyA===E[F+1])&&E.splice(F,2)}M.pairs=E,this.emit(M),M.pairs=null,f.reset();for(var q=this.defaultContactMaterial,R=this.frictionGravity,w=0,N=E.length;w!==N;w+=2)for(var G=E[w],V=E[w+1],D=0,W=G.shapes.length;D!==W;D++)for(var j=G.shapes[D],U=j.position,X=j.angle,Y=0,H=V.shapes.length;Y!==H;Y++){var z=V.shapes[Y],K=z.position,Z=z.angle,Q=null;j.material&&z.material&&(Q=this.getContactMaterial(j.material,z.material)),s(this,f,G,j,U,X,V,z,K,Z,Q||q,R)}for(var w=0;w!==u;w++){var J=a[w];J._wakeUpAfterNarrowphase&&(J.wakeUp(),J._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(T);for(var $=k,Y=T.length;Y--;){var tt=T[Y];$.shapeA=tt.shapeA,$.shapeB=tt.shapeB,$.bodyA=tt.bodyA,$.bodyB=tt.bodyB,this.emit($)}T.length=0}O.contactEquations=f.contactEquations,O.frictionEquations=f.frictionEquations,this.emit(O),O.contactEquations=O.frictionEquations=null;var L=v.length;for(w=0;w!==L;w++)v[w].update();if(f.contactEquations.length||f.frictionEquations.length||L){var et=[];for(m.appendArray(et,f.contactEquations),m.appendArray(et,f.frictionEquations),w=0;w!==L;w++)m.appendArray(et,v[w].equations);if(this.islandSplit){var it=this.unionFind;it.resize(this.bodies.length+1);for(var w=0;w<et.length;w++)et[w].index=w;for(var w=0;w<et.length;w++){var ot=et[w].bodyA,nt=et[w].bodyB;ot.type===p.DYNAMIC&&nt.type===p.DYNAMIC&&it.union(ot.index,nt.index)}for(var w=0;w<a.length;w++){var J=a[w];J.islandId=J.type===p.DYNAMIC?it.find(J.index):-1}et=et.sort(r);for(var rt=0;rt<et.length;){var st=et[rt++];h.addEquation(st);var at=st.bodyA.islandId>0?st.bodyA.islandId:st.bodyB.islandId,lt=-1;et[rt]&&(lt=et[rt].bodyA.islandId>0?et[rt].bodyA.islandId:et[rt].bodyB.islandId),lt===at&&rt!==et.length||(this.solveConstraints&&h.solve(t,this),h.removeAllEquations())}}else h.addEquations(et),this.solveConstraints&&h.solve(t,this),h.removeAllEquations()}for(var w=0;w!==u;w++){var J=a[w];J.type!==p.DYNAMIC&&J.type!==p.KINEMATIC||J.integrate(t)}for(var w=0;w!==u;w++)a[w].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var ct=_,w=0;w!==f.contactEquations.length;w++){var ht=f.contactEquations[w];ht.firstImpact&&(ct.bodyA=ht.bodyA,ct.bodyB=ht.bodyB,ct.shapeA=ht.shapeA,ct.shapeB=ht.shapeB,ct.contactEquation=ht,this.emit(ct))}if(this.sleepMode===o.BODY_SLEEPING)for(w=0;w!==u;w++)a[w].sleepTick(this.time,!1,t);else if(this.sleepMode===o.ISLAND_SLEEPING&&this.islandSplit){for(w=0;w!==u;w++)a[w].sleepTick(this.time,!0,t);for(var ut=a.sort(n),pt=1,dt=0;dt<ut.length;dt=pt){var ft=ut[dt].islandId;for(pt=dt+1;pt<ut.length&&ut[pt].islandId===ft;pt++);if(ft!==-1){for(var vt=!0,w=dt;w<pt;w++)if(!ut[w].wantsToSleep){vt=!1;break}if(vt)for(var w=dt;w<pt;w++)ut[w].sleep()}}}this.stepping=!1,this.emit(x)},o.prototype.addSpring=function(t){if(this.stepping)throw new Error("Springs cannot be added during step.");this.springs.push(t),E.spring=t,this.emit(E),E.spring=null},o.prototype.removeSpring=function(t){if(this.stepping)throw new Error("Springs cannot be removed during step.");b(this.springs,t)},o.prototype.addBody=function(t){if(this.stepping)throw new Error("Bodies cannot be added during step.");if(t.world)throw new Error("Body is already added to a World.");t.index=this.bodies.length,this.bodies.push(t),t.world=this,C.body=t,this.emit(C),C.body=null},o.prototype.removeBody=function(t){if(this.stepping)throw new Error("Bodies cannot be removed during step.");for(var e=this.constraints,i=e.length;i--;)if(e[i].bodyA===this||e[i].bodyB===this)throw new Error("Cannot remove Body from World: it still has constraints connected to it.");t.world=null;var o=this.bodies;b(o,t),t.index=-1;for(var i=o.length;i--;)o[i].index=i;B.body=t,t.resetConstraintVelocity(),this.emit(B),B.body=null;for(var n=this.disabledBodyCollisionPairs,r=0;r<n.length;)n[r]===t||n[r+1]===t?n.splice(r,2):r+=2},o.prototype.getBodyById=function(t){for(var e=this.bodies,i=0;i<e.length;i++){var o=e[i];if(o.id===t)return o}return!1},o.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},o.prototype.enableBodyCollision=function(t,e){for(var i=this.disabledBodyCollisionPairs,o=0;o<i.length;o+=2)if(i[o]===t&&i[o+1]===e||i[o+1]===t&&i[o]===e)return void i.splice(o,2)},o.prototype.clear=function(){this.solver.removeAllEquations();for(var t=this.constraints,e=t.length;e--;)this.removeConstraint(t[e]);var i=this.bodies;for(e=i.length;e--;)this.removeBody(i[e]);var o=this.springs;for(e=o.length;e--;)this.removeSpring(o[e]);var n=this.contactMaterials;for(e=n.length;e--;)this.removeContactMaterial(n[e])};var I=c.create(),q=c.create();o.prototype.hitTest=function(t,e,i){i=i||0;for(var o=I,n=q,r=[],s=0,a=e.length;s!==a;s++)for(var l=e[s],u=0,p=l.shapes.length;u!==p;u++){var d=l.shapes[u];d.worldPointToLocal(n,t),d.pointTest(n)?r.push(l):(c.rotate(o,d.position,l.angle),c.add(o,o,l.position),d.type===h.PARTICLE&&c.squaredDistance(o,t)<i*i&&r.push(l))}return r},o.prototype.setGlobalStiffness=function(t){a(this,{stiffness:t});for(var e=this.contactMaterials,i=0;i!==e.length;i++){var o=e[i];o.stiffness=o.frictionStiffness=t}var o=this.defaultContactMaterial;o.stiffness=o.frictionStiffness=t},o.prototype.setGlobalRelaxation=function(t){a(this,{relaxation:t});for(var e=0;e!==this.contactMaterials.length;e++){var i=this.contactMaterials[e];i.relaxation=i.frictionRelaxation=t}var i=this.defaultContactMaterial;i.relaxation=i.frictionRelaxation=t};var R=new v,N=[];o.prototype.raycast=function(t,e){return e.getAABB(R),this.broadphase.aabbQuery(this,R,N),e.intersectBodies(t,N),N.length=0,t.hasHit()}},function(t,e,i){"use strict";function o(){this.overlappingShapesLastState=new n,this.overlappingShapesCurrentState=new n,this.recordPool=new r({size:16}),this.tmpDict=new n,this.tmpArray1=[]}var n=i(46),r=i(62);t.exports=o,o.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,i=t.keys.length;i--;){var o=t.keys[i],n=t.getByKey(o);n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},o.prototype.setOverlapping=function(t,e,i,o){var n=this.overlappingShapesCurrentState;if(!n.get(e.id,o.id)){var r=this.recordPool.get();r.set(t,e,i,o),n.set(e.id,o.id,r)}},o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},o.prototype.bodiesAreOverlapping=function(t,e){for(var i=this.overlappingShapesCurrentState,o=i.keys.length;o--;){var n=i.keys[o],r=i.data[n];if(r.bodyA===t&&r.bodyB===e||r.bodyA===e&&r.bodyB===t)return!0}return!1},o.prototype.getDiff=function(t,e,i){var i=i||[],o=t,n=e;i.length=0;for(var r=n.keys.length;r--;){var s=n.keys[r],a=n.data[s];if(!a)throw new Error("Key "+s+" had no data!");var l=o.data[s];l||i.push(a)}return i},o.prototype.isNewOverlap=function(t,e){var i=0|t.id,o=0|e.id,n=this.overlappingShapesLastState,r=this.overlappingShapesCurrentState;return!n.get(i,o)&&!!r.get(i,o)},o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},o.prototype.getBodyDiff=function(t,e){e=e||[];for(var i=this.tmpDict,o=t.length;o--;){var n=t[o];i.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(o=i.keys.length;o--;){var n=i.getByKey(i.keys[o]);n&&e.push(n.bodyA,n.bodyB)}return i.reset(),e}},function(t,e,i){"use strict";function o(){r.apply(this,arguments)}var n=i(63),r=i(33);t.exports=o,o.prototype=new r,o.prototype.constructor=o,o.prototype.create=function(){return new n},o.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},function(t,e){"use strict";function i(t,e,i,o){this.shapeA=e,this.shapeB=o,this.bodyA=t,this.bodyB=i}t.exports=i,i.prototype.set=function(t,e,o,n){i.call(this,t,e,o,n)}},function(t,e){"use strict";function i(t){this.id=[],this.sz=[],this.size=t,this.count=t,this.resize(t)}t.exports=i,i.prototype={resize:function(t){this.count=this.size=t;for(var e=this.sz,i=this.id,o=0;o<t;o++)i[o]=o,e[o]=1},find:function(t){for(var e=this.id;t!==e[t];)e[t]=e[e[t]],t=e[t];return t},union:function(t,e){var i=this.find(t),o=this.find(e);if(i!==o){var n=this.sz,r=this.id;n[i]<n[o]?(r[i]=o,n[o]+=n[i]):(r[o]=i,n[i]+=n[o]),this.count--}}}},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return n(e,t),e}(Tiny.Container);e.default=r},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function t(e){i(this,t),this.mask=e};e.default=o},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=i(9),r=function t(e,i,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,c=arguments[6],h=arguments[7],u=arguments[8],p=arguments[9];o(this,t),s=e.pxm(s),this.app=e.app,this.world=e;var d={restLength:s,stiffness:a,damping:l};"undefined"!=typeof c&&null!==c&&(d.worldAnchorA=[e.pxm(c[0]),e.pxm(c[1])]),"undefined"!=typeof h&&null!==h&&(d.worldAnchorB=[e.pxm(h[0]),e.pxm(h[1])]),"undefined"!=typeof u&&null!==u&&(d.localAnchorA=[e.pxm(u[0]),e.pxm(u[1])]),"undefined"!=typeof p&&null!==p&&(d.localAnchorB=[e.pxm(p[0]),e.pxm(p[1])]),this.data=new n.LinearSpring(i,r,d),this.data.parent=this};e.default=r},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=i(9),r=function t(e,i,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;o(this,t),s&&(s=e.pxm(s)),this.app=e.app,this.world=e;var c={restAngle:s,stiffness:a,damping:l};this.data=new n.RotationalSpring(i,r,c),this.data.parent=this};e.default=r},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),a=function(t){function e(t,i,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Number.MAX_VALUE;o(this,e),s=[t.pxm(s[0]),t.pxm(s[1])];var c={localOffsetB:s,localAngleB:a,maxForce:l},h=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,r,c));return h.app=t.app,h.world=t,h}return r(e,t),e}(s.LockConstraint);e.default=a},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),a=function(t){function e(t,i,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Number.MAX_VALUE;o(this,e),s=t.pxm(s),a=[t.pxmi(a[0]),t.pxmi(a[1])],l=[t.pxmi(l[0]),t.pxmi(l[1])];var h={distance:s,localAnchorA:a,localAnchorB:l,maxForce:c},u=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,r,h));return u.app=t.app,u.world=t,u}return r(e,t),e}(s.DistanceConstraint);e.default=a},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),a=function(t){function e(t,i,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;o(this,e);var l={angle:s,ratio:a},c=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,r,l));return c.app=t.app,c.world=t,c}return r(e,t),e}(s.GearConstraint);e.default=a},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9);e.RevoluteConstraint=function(t){function e(t,i,r,s,a){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Number.MAX_VALUE,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;o(this,e),r=[t.pxmi(r[0]),t.pxmi(r[1])],a=[t.pxmi(a[0]),t.pxmi(a[1])],c&&(c=[t.pxmi(c[0]),t.pxmi(c[1])]);var h={worldPivot:c,localPivotA:r,localPivotB:a,maxForce:l},u=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,s,h));return u.world=t,u}return r(e,t),e}(s.RevoluteConstraint)},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),a=function(t){function e(t,i,r){var s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE;o(this,e),a=[t.pxmi(a[0]),t.pxmi(a[1])],l=[t.pxmi(l[0]),t.pxmi(l[1])];var u={localAnchorA:a,localAnchorB:l,localAxisA:c,maxForce:h,disableRotationalLock:!s},p=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,r,u));return p.app=t.app,p.world=t,p}return r(e,t),e}(s.PrismaticConstraint);e.default=a},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),a=function(t){function e(t){o(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.name=t,i}return r(e,t),e}(s.Material);e.default=a},function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=i(9),a=function(t){function e(t,i,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r))}return r(e,t),e}(s.ContactMaterial);e.default=a},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ON_SPRING_ADDED="springAdded",e.ON_SPRING_REMOVED="springRemoved",e.ON_END_CONTACT="endContact",e.ON_BEGIN_CONTACT="beginContact",e.ON_BODY_REMOVED="bodyRemoved",e.ON_BODY_ADDED="bodyAdded",e.ON_CONSTRAIN_ADDED="constraintAdded",e.ON_CONSTRAIN_REMOVED="constraintRemoved",e.ON_CONTACTMATERIAL_ADDED="contactMaterialAdded",e.ON_CONTACTMATERIAL_REMOVED="ContactMaterialRemoved"},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){null===d?(d=new l.default(t,e),t.onUpdate(function(){d.update()})):console.warn("物理系统已经启用了，请不要重复调用！")}Object.defineProperty(e,"__esModule",{value:!0}),e.EVENTS=e.Math=e.startSystem=void 0;var s=i(3);Object.keys(s).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return s[t]}})});var a=i(78),l=n(a),c=i(7),h=o(c),u=i(82),p=o(u),d=null;e.startSystem=r,e.Math=h,e.EVENTS=p},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),c=i(79),h=n(c),u=i(80),p=n(u),d=i(82),f=o(d),v=i(7),y=o(v),g=function(t){function e(t,i){r(this,e);var o=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return void 0===i?i={gravity:[0,0]}:i.hasOwnProperty("gravity")||(i.gravity=[0,0]),o.type="Tiny.Physics.Ant.World",o.app=t,o.app.physics=o.app.physics||{},o.app.physics.ant=o,o.config=i,o.gravity=new Tiny.Point,o.gravity.x=i.gravity[0],o.gravity.y=i.gravity[1],o.bounds=new Tiny.Rectangle(0,0,0,0),o.checkCollision={up:!0,down:!0,left:!0,right:!0},o.maxObjects=10,o.maxLevels=4,o.OVERLAP_BIAS=4,o.forceX=!1,o.skipQuadTree=!0,o._paused=!1,o._total=0,o._restitution=0,o._toRemove=[],o._bodies=[],o.physicsElapsed=1/60,o.setBoundsToWorld(!0,!0,!0,!0),o}return a(e,t),l(e,[{key:"dispatch",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];this.emit.apply(this,arguments)}},{key:"setBounds",value:function(t,e,i,o){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];this.bounds.x=t,this.bounds.y=e,this.bounds.width=i,this.bounds.height=o,void 0!==n&&(this.checkCollision.left=!!n),void 0!==r&&(this.checkCollision.right=!!r),void 0!==s&&(this.checkCollision.top=!!s),void 0!==a&&(this.checkCollision.bottom=!!a)}},{key:"setBoundsToWorld",value:function(t,e,i,o){this.setBounds(0,0,this.app.renderer.width,this.app.renderer.height,t,e,i,o)}},{key:"enable",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=1;if(Array.isArray(t))for(o=t.length;o--;)t[o]instanceof h.default?this.enable(t[o].children,e,i):(this.enableBody(t[o],e),i&&t[o].hasOwnProperty("children")&&t[o].children.length>0&&this.enable(t[o],e,!0));else t instanceof h.default?this.enable(t.children,e,i):(this.enableBody(t,e),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,e,!0))}},{key:"enableBody",value:function(t,e){t.body||(t.body=new p.default(this,t),t.body.debug=e,"undefined"!=typeof t.anchor&&t.anchor.set(.5,.5),this.addBody(t.body))}},{key:"addBody",value:function(t){if(this._toRemove)for(var e=0;e<this._toRemove.length;e++)this._toRemove[e]===this&&this._toRemove.splice(e,1);this._bodies.indexOf(t)===-1&&(this._bodies.push(t),this.dispatch(f.ON_BODY_ADDED,t))}},{key:"removeBodyNextStep",value:function(t){this._toRemove.push(t)}},{key:"computeVelocity",value:function(t,e,i,o,n){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1e4;return 1===t&&e.allowGravity?i+=(this.gravity.x+e.gravity.x)*this.physicsElapsed:2===t&&e.allowGravity&&(i+=(this.gravity.y+e.gravity.y)*this.physicsElapsed),o?i+=o*this.physicsElapsed:n&&(n*=this.physicsElapsed,
i-n>0?i-=n:i+n<0?i+=n:i=0),i>r?i=r:i<-r&&(i=-r),i}},{key:"overlap",value:function(t,e,i,o,n){if(i=i||null,o=o||null,n=n||this,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var r=0;r<e.length;r++)this.collideHandler(t,e[r],i,o,n,!0);else if(Array.isArray(t)&&!Array.isArray(e))for(var s=0;s<t.length;s++)this.collideHandler(t[s],e,i,o,n,!0);else if(Array.isArray(t)&&Array.isArray(e))for(var a=0;a<t.length;a++)for(var l=0;l<e.length;l++)this.collideHandler(t[a],e[l],i,o,n,!0);else this.collideHandler(t,e,i,o,n,!0);return this._total>0}},{key:"collide",value:function(t,e,i,o,n){if(i=i||null,o=o||null,n=n||i,this._total=0,!Array.isArray(t)&&Array.isArray(e))for(var r=0;r<e.length;r++)this.collideHandler(t,e[r],i,o,n,!1);else if(Array.isArray(t)&&!Array.isArray(e))for(var s=0;s<t.length;s++)this.collideHandler(t[s],e,i,o,n,!1);else if(Array.isArray(t)&&Array.isArray(e))for(var a=0;a<t.length;a++)for(var l=0;l<e.length;l++)this.collideHandler(t[a],e[l],i,o,n,!1);else this.collideHandler(t,e,i,o,n,!1);return this._total>0}},{key:"collideHandler",value:function(t,e,i,o,n,r){return t&&e&&t.visible&&e.visible?void(t instanceof Tiny.Sprite&&e instanceof Tiny.Sprite?this.collideSpriteVsSprite(t,e,i,o,n,r):console.warn("只支持Tiny.Sprite")):void console.warn("object1 is null or not visible")}},{key:"collideSpriteVsSprite",value:function(t,e,i,o,n,r){return!(!t.body||!e.body)&&(this.separate(t.body,e.body,o,n,r)&&(i&&i.call(n,t,e),this._total++),!0)}},{key:"separate",value:function(t,e,i,o,n){if(!t.enable||!e.enable||t.checkCollision.none||e.checkCollision.none||!this.intersects(t,e))return!1;if(i&&i.call(o,t.sprite,e.sprite)===!1)return!1;if(t.isCircle&&e.isCircle)return this.separateCircle(t,e,n);if(t.isCircle!==e.isCircle){var r=t.isCircle?e:t,s=t.isCircle?t:e,a={x:r.x,y:r.y,right:r.right,bottom:r.bottom},l={x:s.x+s.radius,y:s.y+s.radius};if((l.y<a.y||l.y>a.bottom)&&(l.x<a.x||l.x>a.right))return this.separateCircle(t,e,n)}var c=!1,h=!1;this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)?(c=this.separateX(t,e,n),this.intersects(t,e)&&(h=this.separateY(t,e,n))):(h=this.separateY(t,e,n),this.intersects(t,e)&&(c=this.separateX(t,e,n)),console.log(h,c));var u=c||h;return u&&(n?(t.onOverlap(e),e.onOverlap(t)):(t.onCollide(e),e.onCollide(t))),u}},{key:"separateX",value:function(t,e,i){var o=this.getOverlapX(t,e,i);if(i||0===o||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==o||t.embedded&&e.embedded;var n=t.velocity.x,r=e.velocity.x;if(t.immovable||e.immovable)t.immovable?(e.x+=o,e.velocity.x=n-r*e.bounce.x,t.moves&&(e.y+=(t.y-t.prev.y)*t.friction.y)):(t.x-=o,t.velocity.x=r-n*t.bounce.x,e.moves&&(t.y+=(e.y-e.prev.y)*e.friction.y));else{o*=.5,t.x-=o,e.x+=o;var s=Math.sqrt(r*r*e.mass/t.mass)*(r>0?1:-1),a=Math.sqrt(n*n*t.mass/e.mass)*(n>0?1:-1),l=.5*(s+a);s-=l,a-=l,t.velocity.x=l+s*t.bounce.x,e.velocity.x=l+a*e.bounce.x}return!0}},{key:"separateY",value:function(t,e,i){var o=this.getOverlapY(t,e,i);if(i||0===o||t.immovable&&e.immovable||t.customSeparateY||e.customSeparateY)return 0!==o||t.embedded&&e.embedded;var n=t.velocity.y,r=e.velocity.y;if(t.immovable||e.immovable)t.immovable?(e.y+=o,e.velocity.y=n-r*e.bounce.y,t.moves&&(e.x+=(t.x-t.prev.x)*t.friction.x)):(t.y-=o,t.velocity.y=r-n*t.bounce.y,e.moves&&(t.x+=(e.x-e.prev.x)*e.friction.x));else{o*=.5,t.y-=o,e.y+=o;var s=Math.sqrt(r*r*e.mass/t.mass)*(r>0?1:-1),a=Math.sqrt(n*n*t.mass/e.mass)*(n>0?1:-1),l=.5*(s+a);s-=l,a-=l,t.velocity.y=l+s*t.bounce.y,e.velocity.y=l+a*e.bounce.y}return!0}},{key:"getOverlapX",value:function(t,e,i){var o=0,n=t.deltaAbsX+e.deltaAbsX+this.OVERLAP_BIAS;return 0===t.deltaX&&0===e.deltaX?(t.embedded=!0,e.embedded=!0):t.deltaX>e.deltaX?(o=t.right-e.x,o>n&&!i||t.checkCollision.right===!1||e.checkCollision.left===!1?o=0:(t.touching.none=!1,t.touching.right=!0,e.touching.none=!1,e.touching.left=!0)):t.deltaX<e.deltaX&&(o=t.x-e.width-e.x,-o>n&&!i||t.checkCollision.left===!1||e.checkCollision.right===!1?o=0:(t.touching.none=!1,t.touching.left=!0,e.touching.none=!1,e.touching.right=!0)),t.overlapX=o,e.overlapX=o,o}},{key:"getOverlapY",value:function(t,e,i){var o=0,n=t.deltaAbsY+e.deltaAbsY+this.OVERLAP_BIAS;return 0===t.deltaY&&0===e.deltaY?(t.embedded=!0,e.embedded=!0):t.deltaY>e.deltaY?(o=t.bottom-e.y,o>n&&!i||t.checkCollision.down===!1||e.checkCollision.up===!1?o=0:(t.touching.none=!1,t.touching.down=!0,e.touching.none=!1,e.touching.up=!0)):t.deltaY<e.deltaY&&(o=t.y-e.bottom,-o>n&&!i||t.checkCollision.up===!1||e.checkCollision.down===!1?o=0:(t.touching.none=!1,t.touching.up=!0,e.touching.none=!1,e.touching.down=!0)),t.overlapY=o,e.overlapY=o,o}},{key:"separateCircle",value:function(t,e,i){console.debug("separateCircle"),this.getOverlapX(t,e),this.getOverlapY(t,e);var o=e.center.x-t.center.x,n=e.center.y-t.center.y,r=Math.atan2(n,o),s=0;if(t.isCircle!==e.isCircle){var a={x:e.isCircle?t.position.x:e.position.x,y:e.isCircle?t.position.y:e.position.y,right:e.isCircle?t.right:e.right,bottom:e.isCircle?t.bottom:e.bottom},l={x:t.isCircle?t.position.x+t.radius:e.position.x+e.radius,y:t.isCircle?t.position.y+t.radius:e.position.y+e.radius,radius:t.isCircle?t.radius:e.radius};l.y<a.y?l.x<a.x?s=y.distance(l.x,l.y,a.x,a.y)-l.radius:l.x>a.right&&(s=y.distance(l.x,l.y,a.right,a.y)-l.radius):l.y>a.bottom&&(l.x<a.x?s=y.distance(l.x,l.y,a.x,a.bottom)-l.radius:l.x>a.right&&(s=y.distance(l.x,l.y,a.right,a.bottom)-l.radius)),s*=-1}else s=t.radius+e.radius-y.distance(t.center.x,t.center.y,e.center.x,e.center.y);if(i||0===s||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==s&&(t.onOverlap(e),e.onOverlap(t)),0!==s;var c={x:t.velocity.x*Math.cos(r)+t.velocity.y*Math.sin(r),y:t.velocity.x*Math.sin(r)-t.velocity.y*Math.cos(r)},h={x:e.velocity.x*Math.cos(r)+e.velocity.y*Math.sin(r),y:e.velocity.x*Math.sin(r)-e.velocity.y*Math.cos(r)},u=((t.mass-e.mass)*c.x+2*e.mass*h.x)/(t.mass+e.mass),p=(2*t.mass*c.x+(e.mass-t.mass)*h.x)/(t.mass+e.mass);return t.immovable||(t.velocity.x=(u*Math.cos(r)-c.y*Math.sin(r))*t.bounce.x,t.velocity.y=(c.y*Math.cos(r)+u*Math.sin(r))*t.bounce.y),e.immovable||(e.velocity.x=(p*Math.cos(r)-h.y*Math.sin(r))*e.bounce.x,e.velocity.y=(h.y*Math.cos(r)+p*Math.sin(r))*e.bounce.y),Math.abs(r)<Math.PI/2?t.velocity.x>0&&!t.immovable&&e.velocity.x>t.velocity.x?t.velocity.x*=-1:e.velocity.x<0&&!e.immovable&&t.velocity.x<e.velocity.x?e.velocity.x*=-1:t.velocity.y>0&&!t.immovable&&e.velocity.y>t.velocity.y?t.velocity.y*=-1:e.velocity.y<0&&!e.immovable&&t.velocity.y<e.velocity.y&&(e.velocity.y*=-1):Math.abs(r)>Math.PI/2&&(t.velocity.x<0&&!t.immovable&&e.velocity.x<t.velocity.x?t.velocity.x*=-1:e.velocity.x>0&&!e.immovable&&t.velocity.x>e.velocity.x?e.velocity.x*=-1:t.velocity.y<0&&!t.immovable&&e.velocity.y<t.velocity.y?t.velocity.y*=-1:e.velocity.y>0&&!e.immovable&&t.velocity.x>e.velocity.y&&(e.velocity.y*=-1)),t.immovable||(t.x+=t.velocity.x*this.physicsElapsed-s*Math.cos(r),t.y+=t.velocity.y*this.physicsElapsed-s*Math.sin(r)),e.immovable||(e.x+=e.velocity.x*this.physicsElapsed+s*Math.cos(r),e.y+=e.velocity.y*this.physicsElapsed+s*Math.sin(r)),t.onCollide(e),e.onCollide(t),!0}},{key:"intersects",value:function(t,e){return t!==e&&(t.isCircle?e.isCircle?y.distance(t.center.x,t.center.y,e.center.x,e.center.y)<=t.radius+e.radius:this.circleBodyIntersects(t,e):e.isCircle?this.circleBodyIntersects(e,t):!(t.right<=e.position.x)&&(!(t.bottom<=e.position.y)&&(!(t.position.x>=e.right)&&!(t.position.y>=e.bottom))))}},{key:"circleBodyIntersects",value:function(t,e){var i=y.clamp(t.center.x,e.left,e.right),o=y.clamp(t.center.y,e.top,e.bottom),n=(t.center.x-i)*(t.center.x-i),r=(t.center.y-o)*(t.center.y-o);return n+r<=t.radius*t.radius}},{key:"velocityFromAngle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return i=i||new Tiny.Point,i.x=Math.cos(y.degToRad(t))*e,i.y=Math.sin(y.degToRad(t))*e,i}},{key:"velocityFromRotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,i=arguments[2];return i=i||new Tiny.Point,i.x=Math.cos(t)*e,i.y=Math.sin(t)*e,i}},{key:"accelerationFromRotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:60,i=arguments[2];return i=i||new Tiny.Point,i.x=Math.cos(t)*e,i.y=Math.sin(t)*e,i}},{key:"pause",value:function(){this._paused=!0}},{key:"preUpdate",value:function(){for(var t=this._toRemove.length;t--;)this.removeBody(this._toRemove[t]);this._toRemove.length=0}},{key:"update",value:function(){this.paused||(this._bodies.forEach(function(t){t.preUpdate()}),this.preUpdate(),this.processCollide(),this._bodies.forEach(function(t){t.postUpdate()}))}},{key:"processCollide",value:function(){var t=this;this._bodies.forEach(function(e){e.collidesWith.length>0&&t.collide(e.sprite,e.collidesWith),e.overlapsWith.length>0&&t.overlap(e.sprite,e.overlapsWith)})}},{key:"removeBody",value:function(t){var e=this._bodies.indexOf(t);return e===-1?t:(this._bodies.splice(e,1),this.dispatch(f.ON_BODY_REMOVED,t),t)}},{key:"paused",get:function(){return this._paused}},{key:"restitution",get:function(){return this._restitution},set:function(t){this._restitution=t}}]),e}(Tiny.EventEmitter);e.default=g},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){return i(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return n(e,t),e}(Tiny.Container);e.default=r},function(t,e,i){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),c=i(81),h=n(c),u=i(7),p=n(u),d=i(82),f=n(d),v=i(83),y=o(v),g=function(t){function e(t,i,o,n,a){r(this,e);var l=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i=i||null,o=o||0,n=n||0,l.world=t,l.app=l.world.app,l.sprite=i,l.type="Tiny.Physics.Ant.Body",l.enable=!0,l.isCircle=!1,l.radius=0,l.offset=new Tiny.Point,l.position=new Tiny.Point(i.x,i.y),l.prev=new Tiny.Point(l.position.x,l.position.y),l.allowRotation=!0,l.rotation=i.rotation,l.preRotation=l.rotation,l.width=i.width,l.height=i.height,l.sourceWidth=i.width,l.sourceHeight=i.height,i.texture&&(l.sourceWidth=i.texture.frame.width,l.sourceHeight=i.texture.frame.height),l.halfWidth=Math.abs(i.width/2),l.halfHeight=Math.abs(i.height/2),l.center=new Tiny.Point(i.x+l.halfWidth,i.y+l.halfHeight),l.velocity=new Tiny.Point,l.newVelocity=new Tiny.Point,l.deltaMax=new Tiny.Point,l.acceleration=new Tiny.Point,l.drag=new Tiny.Point,l.allowGravity=!0,l.gravity=new Tiny.Point,l.bounce=new Tiny.Point,l.bounce.x=l.world.restitution,l.bounce.y=l.world.restitution,l.worldBounce=null,l.maxVelocity=new Tiny.Point(1e4,1e4),l.friction=new Tiny.Point(1,0),l.angularVelocity=0,l.angularAcceleration=0,l.angularDrag=0,l.maxAngular=1e3,l.mass=1,l.angle=0,l.speed=0,l.facing=h.NONE,l.immovable=!1,l.moves=!0,l.customSeparateX=!1,l.customSeparateY=!1,l.overlapX=0,l.overlapY=0,l.overlapR=0,l.embedded=!1,l.collideWorldBounds=!1,l.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0},l.touching={none:!0,up:!1,down:!1,left:!1,right:!1},l.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},l.blocked={up:!1,down:!1,left:!1,right:!1},l.dirty=!1,l.syncBounds=!1,l.stopVelocityOnCollide=!0,l._reset=!0,l._sx=i.scale.x,l._sy=i.scale.y,l._dx=0,l._dy=0,l.collidesWith=[],l.overlapsWith=[],l.debugBody=null,l}return a(e,t),l(e,[{key:"dispatch",value:function(t){for(var e=arguments.length,i=Array(e>1?e-1:0),o=1;o<e;o++)i[o-1]=arguments[o];this.emit.apply(this,arguments)}},{key:"updateBounds",value:function(){if(this.syncBounds){var t=this.sprite.getBounds();t.ceilAll(),t.width===this.width&&t.height===this.height||(this.width=t.width,this.height=t.height,this._reset=!0)}else{var e=Math.abs(this.sprite.scale.x),i=Math.abs(this.sprite.scale.y);e===this._sx&&i===this._sy||(this.width=this.sourceWidth*e,this.height=this.sourceHeight*i,this._sx=e,this._sy=i,this._reset=!0)}this._reset&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight))}},{key:"updateMotion",value:function(){var t=this,e=this.world.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity;t.angularVelocity+=e,t.rotation+=t.angularVelocity*this.world.physicsElapsed,t.velocity.x=this.world.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x),t.velocity.y=this.world.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)}},{key:"preUpdate",value:function(){this.enable&&!this.world.paused&&(this.dirty=!0,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=this.sprite.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.rotation=this.sprite.rotation,this.preRotation=this.rotation,(this._reset||this.sprite.fresh)&&(console.log("set prev",this._reset,this.sprite.fresh),this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.updateMotion(),this.newVelocity.set(this.velocity.x*this.world.physicsElapsed,this.velocity.y*this.world.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.position.x===this.prev.x&&this.position.y===this.prev.y||(this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.collideWorldBounds&&this.checkWorldBounds()&&this.dispatch(f.ON_WORLD_BOUNDS,this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.deltaX,this._dy=this.deltaY,this._reset=!1)}},{key:"postUpdate",value:function(){this.enable&&this.dirty&&(this.dirty=!1,this.deltaX<0?this.facing=h.LEFT:this.deltaX>0&&(this.facing=h.RIGHT),this.deltaY<0?this.facing=h.UP:this.deltaY>0&&(this.facing=h.DOWN),this.moves&&(this._dx=this.deltaX,this._dy=this.deltaY,0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.position.x+=this._dx,this.sprite.position.y+=this._dy,this.debugBody&&this.debugBody.updateSpriteTransform(),this._reset=!0),this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.rotation+=this.deltaZ),this.prev.x=this.position.x,this.prev.y=this.position.y)}},{key:"processCollide",value:function(){this.collidesWith.length>0&&this.world.collide(this.sprite,this.collidesWith),this.overlapsWith.length>0&&this.world.overlap(this.sprite,this.overlapsWith)}},{key:"checkWorldBounds",value:function(){var t=this.position,e=this.world.bounds,i=this.world.checkCollision,o=this.worldBounce?-this.worldBounce.x:-this.bounce.x,n=this.worldBounce?-this.worldBounce.y:-this.bounce.y;if(this.isCircle){var r={x:this.center.x-this.radius,y:this.center.y-this.radius,right:this.center.x+this.radius,bottom:this.center.y+this.radius};r.x<e.x&&i.left?(t.x=e.x-this.halfWidth+this.radius,this.velocity.x*=o,this.blocked.left=!0):r.right>e.right&&i.right&&(t.x=e.right-this.halfWidth-this.radius,this.velocity.x*=o,this.blocked.right=!0),r.y<e.y&&i.up?(t.y=e.y-this.halfHeight+this.radius,this.velocity.y*=n,this.blocked.up=!0):r.bottom>e.bottom&&i.down&&(t.y=e.bottom-this.halfHeight-this.radius,this.velocity.y*=n,this.blocked.down=!0)}else t.x<e.x&&i.left?(t.x=e.x,this.velocity.x*=o,this.blocked.left=!0):this.right>e.right&&i.right&&(t.x=e.right-this.width,this.velocity.x*=o,this.blocked.right=!0),t.y<e.y&&i.up?(t.y=e.y,this.velocity.y*=n,this.blocked.up=!0):this.bottom>e.bottom&&i.down&&(t.y=e.bottom-this.height,this.velocity.y*=n,this.blocked.down=!0);return this.blocked.up||this.blocked.down||this.blocked.left||this.blocked.right}},{key:"setSize",value:function(t,e,i,o){void 0===i&&(i=this.offset.x),void 0===o&&(o=this.offset.y),this.sourceWidth=t,this.sourceHeight=e,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.set(i,o),this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.isCircle=!1,this.radius=0,this.shapeChanged()}},{key:"setCircle",value:function(t,e,i){void 0===e&&(e=this.offset.x),void 0===i&&(i=this.offset.y),t>0?(this.isCircle=!0,this.radius=t,this.sourceWidth=2*t,this.sourceHeight=2*t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.set(e,i),this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight)):this.isCircle=!1,this.shapeChanged()}},{key:"reset",value:function(t,e){this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this.position.x=t-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x,this.position.x-=this.sprite.scale.x<0?this.width:0,this.position.y=e-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y,this.position.y-=this.sprite.scale.y<0?this.height:0,this.prev.x=this.position.x,this.prev.y=this.position.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scale.x,this._sy=this.sprite.scale.y,this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight)}},{key:"hitTest",value:function(t,e){return this.isCircle?Tiny.Circle.contains(this,t,e):Tiny.Rectangle.contains(this,t,e)}},{key:"destroy",value:function(){this.removeFromWorld(),this.sprite.body=null,this.sprite=null,this.enable=!1}},{key:"onOverlap",value:function(t){this.dispatch(f.ON_OVER_LAP,this.sprite,t.sprite)}},{key:"onCollide",value:function(t){this.dispatch(f.ON_COLLIDE,this.sprite,t.sprite)}},{key:"addToWorld",value:function(){this.world.addBody(this)}},{key:"removeFromWorld",value:function(){this.world.removeBodyNextStep(this)}},{key:"moveTo",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this,r=Math.atan2(e-n.y,t-n.x);return o>0&&(i=p.distance(n.x,n.y,t,e)/(o/1e3)),this.velocity.x=Math.cos(r)*i,this.velocity.y=Math.sin(r)*i,r}},{key:"accelerateTo",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e3,r=p.angle(this.x,this.y,t,e);return this.acceleration.set(Math.cos(r)*i,Math.sin(r)*i),this.maxVelocity.set(o,n),r}},{key:"shapeChanged",value:function(){this.debugBody&&this.debugBody.draw(),this.dispatch("shapeChanged",this)}},{key:"containsCollide",value:function(t){return t instanceof e&&(t=t.sprite),this.collidesWith.indexOf(t)>-1}},{key:"addCollides",value:function(t){if(console.log("addCollides",t),Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];o instanceof e&&(o=o.sprite),o.body&&o.body!==this&&!o.body.containsCollide(this.sprite)&&(this.containsCollide(o)||this.collidesWith.push(o))}else this.collidesWith.push(t)}},{key:"removeCollides",value:function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];o instanceof e&&(o=o.sprite),this._removeCollide(o)}else this._removeCollide(t)}},{key:"removeAllCollides",value:function(){this.collidesWith=[]}},{key:"_removeCollide",value:function(t){var e=this.collidesWith.indexOf(t);return e>-1&&this.collidesWith.splice(e,1),t}},{key:"containsOverlap",value:function(t){return t instanceof e&&(t=t.sprite),this.overlapsWith.indexOf(t)>-1}},{key:"addOverlaps",value:function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];o instanceof e&&(o=o.sprite),this.containsOverlap(o)||this.overlapsWith.push(o)}else this.overlapsWith.push(t)}},{key:"removeOverlaps",value:function(t){if(Array.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];o instanceof e&&(o=o.sprite),this._removeOverlap(o)}else this._removeOverlap(t)}},{key:"removeAllOverlaps",value:function(){this.overlapsWith=[]}},{key:"_removeOverlap",value:function(t){var e=this.overlapsWith.indexOf(t);return e>-1&&this.overlapsWith.splice(e,1),t}},{key:"isOnFloor",get:function(){return this.blocked.down}},{key:"isOnCeiling",get:function(){return this.blocked.up}},{key:"isOnLeft",get:function(){return this.blocked.left}},{key:"isOnRight",get:function(){return this.blocked.right}},{key:"deltaAbsX",get:function(){return Math.abs(this.deltaX)}},{key:"deltaAbsY",get:function(){return Math.abs(this.deltaY)}},{key:"deltaX",get:function(){return this.position.x-this.prev.x}},{key:"deltaY",get:function(){return this.position.y-this.prev.y}},{key:"deltaZ",get:function(){return this.rotation-this.preRotation}},{key:"x",get:function(){return this.position.x},set:function(t){this.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.position.y=t}},{key:"left",get:function(){return this.position.x}},{key:"right",get:function(){return this.position.x+this.width}},{key:"top",get:function(){return this.position.y}},{key:"bottom",get:function(){return this.position.y+this.height}},{key:"debug",get:function(){return null!==this.debugBody},set:function(t){t&&!this.debugBody?(this.debugBody=new y.default(this),this.debugBody.draw()):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}},{key:"static",get:function(){return this.immovable},set:function(t){this.allowGravity=!1,this.immovable=!0}}]),e}(Tiny.EventEmitter);e.default=g},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.NONE=0,e.LEFT=1,e.RIGHT=2,e.UP=3,e.DOWN=4},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ON_BODY_REMOVED="bodyRemoved",e.ON_BODY_ADDED="bodyAdded",e.ON_WORLD_BOUNDS="worldBounds",e.ON_MOVE_COMPLETE="moveComplete",e.ON_OVER_LAP="overlap",e.ON_COLLIDE="collide"},function(t,e,i){"use strict";function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),l=i(3),c=o(l),h=function(t){function e(t,i){n(this,e);var o=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),s=t.world,a={lineWidth:1,alpha:.5,fill:.5,lineColor:255,fillColor:16711680};if(o.settings=c.extend(a,s.config.debug||{}),o.world=s,o.body=t,o.graphics=new Tiny.Graphics,o.graphics.alpha=o.settings.alpha,o.addChild(o.graphics),void 0===o.world.app.stageDebugLayer){var l=new Tiny.Container;l.scale.set(Tiny.config.multiplier),o.world.app.camera.addChild(l),o.world.app.stageDebugLayer=l}if(void 0===o.world.app.stageDebugLayer.ant){var h=new Tiny.Container;o.world.app.stageDebugLayer.addChild(h),o.world.app.stageDebugLayer.ant=h}return o.world.app.stageDebugLayer.ant.addChild(o),o.anchor.set(.5,.5),o.draw(),o.updateSpriteTransform(),o}return s(e,t),a(e,[{key:"updateSpriteTransform",value:function(){this.position.x=this.body.sprite.x,this.position.y=this.body.sprite.y,this.rotation=this.body.sprite.rotation}},{key:"draw",value:function(){var t=this.settings.lineWidth,e=parseInt(c.randomPastelHex(),16),i=this.settings.lineColor;this.settings.fillColor;this.graphics.clear(),this.body.isCircle?this.drawCircle(this.graphics,0,0,this.body.radius,e,t):this.drawRectangle(this.graphics,0,0,0,this.body.width,this.body.height,i,e,t)}},{key:"drawCircle",value:function(t,e,i,o,n){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16777215,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;t.lineStyle(s,0,1),this.settings.fill&&t.beginFill(r,1),t.drawCircle(e,i,o),this.settings.fill&&t.endFill(),t.moveTo(e,i),t.lineTo(e+o*Math.cos(-n),i+o*Math.sin(-n))}},{key:"drawRectangle",value:function(t,e,i,o,n,r){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=(arguments[7],arguments.length>8&&void 0!==arguments[8]?arguments[8]:1);t.lineStyle(a,s,1),this.settings.fill&&t.beginFill(16711680),t.drawRect(e-n/2,i-r/2,n,r),this.settings.fill&&t.endFill()}}]),e}(Tiny.Sprite);e.default=h}]);