/*!
 * Tiny.Physics.P2
 * Description: P2物理引擎，从Phaser的p2的改造过来的 感谢Phaser提供的解决方案
 * Author: 清扬陌客 <qingyangmoke@qq.com>
 * Version: v0.0.1
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.P2=e():(t.Tiny=t.Tiny||{},t.Tiny.Physics=t.Tiny.Physics||{},t.Tiny.Physics.P2=e())}(this,function(){return function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var o={};return e.m=t,e.c=o,e.p="/Users/song/Develop/github/tinyjs-plugin-physics/dist",e(0)}([function(t,e,o){t.exports=o(1)},function(t,e,o){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e.default=t,e}function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){null===f?(f=new l.default(t,e),t.onUpdate(function(){f&&f.update()})):console.warn("物理系统已经启用了，请不要重复调用！")}Object.defineProperty(e,"__esModule",{value:!0}),e.p2=e.EVENTS=e.Math=e.startSystem=void 0;var a=o(2);Object.keys(a).forEach(function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(e,t,{enumerable:!0,get:function(){return a[t]}})});var s=o(3),l=n(s),c=o(6),h=i(c),u=o(75),p=i(u),d=o(8),f=null;e.startSystem=r,e.Math=h,e.EVENTS=p,e.p2=d},function(t,e){"use strict";function o(t,e){for(var o in e)t[o]=e[o];return t}function i(){var t=void 0,e=void 0,o=void 0,i=void 0;return o=[255,255,255],i=Math.floor(256*Math.random()),e=Math.floor(256*Math.random()),t=Math.floor(256*Math.random()),i=Math.floor((i+3*o[0])/4),e=Math.floor((e+3*o[1])/4),t=Math.floor((t+3*o[2])/4),n(i,e,t)}function n(t,e,o){return r(t)+r(e)+r(o)}function r(t){var e=t.toString(16);return 2===e.length?e:e+"0"}Object.defineProperty(e,"__esModule",{value:!0}),e.extend=o,e.randomPastelHex=i,e.rgbToHex=n,e.componentToHex=r},function(t,e,o){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e.default=t,e}function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,o,i){return o&&t(e.prototype,o),i&&t(e,i),e}}(),c=o(4),h=n(c),u=o(64),p=n(u),d=o(65),f=n(d),v=o(5),y=n(v),g=o(66),m=n(g),b=o(67),w=n(b),A=o(68),B=n(A),C=o(69),E=n(C),M=o(70),P=n(M),x=o(71),_=n(x),S=o(72),F=n(S),L=o(73),k=n(L),O=o(74),T=n(O),I=o(75),q=i(I),N="Tiny.Physics.P2.Body",G=o(8),R=function(t){function e(t,o){r(this,e);var i=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.type="Tiny.Physics.P2.World",void 0===o?o={gravity:[0,0],broadphase:new G.SAPBroadphase}:(o.hasOwnProperty("gravity")?(o.gravity[0]=-o.gravity[0],o.gravity[1]=-o.gravity[1]):o.gravity=[0,0],o.hasOwnProperty("broadphase")||(o.broadphase=new G.SAPBroadphase)),i.app=t,i.app.physics=i.app.physics||{},i.app.physics.p2=i,i.config=o,i.world=new G.World(i.config),i.frameRate=1/60,i._paused=!1,i._toRemove=[],i._bodies=[],i.gravity=new y.default(i,i.world.gravity),i.walls={left:null,right:null,top:null,bottom:null},i._collisionGroupID=2,i._boundsLeft=!0,i._boundsRight=!0,i._boundsTop=!0,i._boundsBottom=!0,i._boundsOwnGroup=!1,i.collisionGroups=[],i.nothingCollisionGroup=new f.default(1),i.boundsCollisionGroup=new f.default(2),i.everythingCollisionGroup=new f.default(2147483648),i._impactEvents=!1,i.world.on(q.ON_BEGIN_CONTACT,i.beginContactHandler,i),i.world.on(q.ON_END_CONTACT,i.endContactHandler,i),i.setBoundsToWorld(!0,!0,!0,!0,!1),i}return s(e,t),l(e,[{key:"enable",value:function(t,e,o){void 0===e&&(e=!1),void 0===o&&(o=!0);var i=1;if(Array.isArray(t))for(i=t.length;i--;)t[i]instanceof p.default?this.enable(t[i].children,e,o):(this.enableBody(t[i],e),o&&t[i].hasOwnProperty("children")&&t[i].children.length>0&&this.enable(t[i],e,!0));else t instanceof p.default?this.enable(t.children,e,o):(this.enableBody(t,e),o&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,e,!0))}},{key:"enableBody",value:function(t,e){console.log("enableBody",t.body),void 0===t.body&&(t.body=new h.default(this,t,t.x,t.y,1),t.body.debug=e,"undefined"!=typeof t.anchor&&t.anchor.set(.5,.5),this.addBody(t.body))}},{key:"addBody",value:function(t){if(this._toRemove)for(var e=0;e<this._toRemove.length;e++)this._toRemove[e]===this&&this._toRemove.splice(e,1);return t.data.world!==this.world&&(this.world.addBody(t.data),this.dispatch(q.ON_BODY_ADDED,t),this._bodies.indexOf(t)===-1&&this._bodies.push(t),!0)}},{key:"preUpdate",value:function(){for(var t=this._toRemove.length;t--;)this.removeBody(this._toRemove[t]);this._toRemove.length=0}},{key:"update",value:function(){this.paused||(this._bodies.forEach(function(t){t.preUpdate()}),this.preUpdate(),this._bodies.forEach(function(t){t.postUpdate()}),this.world.step(this.frameRate))}},{key:"checkIfSetup",value:function(){if(null===this.app)throw new Error("引擎未setup")}},{key:"clear",value:function(){this.world.time=0,this.world.fixedStepTime=0,this.world.solver&&this.world.solver.equations.length&&this.world.solver.removeAllEquations();for(var t=this.world.constraints,e=t.length-1;e>=0;e--)this.world.removeConstraint(t[e]);for(var o=this.world.bodies,i=o.length-1;i>=0;i--)this.world.removeBody(o[i]);for(var n=this.world.springs,r=n.length-1;r>=0;r--)this.world.removeSpring(n[r]);for(var a=this.world.contactMaterials,s=a.length-1;s>=0;s--)this.world.removeContactMaterial(a[s]);this.world.off(q.ON_BEGIN_CONTACT,this.beginContactHandler,this),this.world.off(q.ON_END_CONTACT,this.endContactHandler,this),this.postBroadphaseCallback=null,this.callbackContext=null,this.impactCallback=null,this.collisionGroups=[],this._toRemove=[],this.boundsCollidesWith=[],this.walls={left:null,right:null,top:null,bottom:null}}},{key:"reset",value:function(){this.world.on(q.ON_BEGIN_CONTACT,this.beginContactHandler,this),this.world.on(q.ON_END_CONTACT,this.endContactHandler,this),this.nothingCollisionGroup=new f.default(1),this.boundsCollisionGroup=new f.default(2),this.everythingCollisionGroup=new f.default(2147483648),this._collisionGroupID=2,this.setBoundsToWorld(!0,!0,!0,!0,!1)}},{key:"destroy",value:function(){this.clear(),this.app.physics===this&&(this.app.physics=null),this.app=null}},{key:"dispatch",value:function(t){for(var e=arguments.length,o=Array(e>1?e-1:0),i=1;i<e;i++)o[i-1]=arguments[i];this.emit.apply(this,arguments)}},{key:"pxm",value:function(t){return.05*t}},{key:"pxmi",value:function(t){return-this.pxm(t)}},{key:"mpx",value:function(t){return 20*t}},{key:"mpxi",value:function(t){return-this.mpx(t)}},{key:"removeBodyNextStep",value:function(t){this._toRemove.push(t)}},{key:"removeBody",value:function(t){return t.data.world===this.world&&(this.world.removeBody(t.data),t.debug=!1,this.dispatch(q.ON_BODY_REMOVED,t)),t}},{key:"pause",value:function(){this._paused=!0}},{key:"resume",value:function(){this._paused=!1}},{key:"beginContactHandler",value:function(t){t.bodyA&&t.bodyB&&(this.dispatch(q.ON_BEGIN_CONTACT,{bodyA:t.bodyA.parent,bodyB:t.bodyB.parent,shapeA:t.shapeA,shapeB:t.shapeB,contactEquations:t.contactEquations}),t.bodyA.parent&&t.bodyA.parent.dispatch(q.ON_BEGIN_CONTACT,t.bodyB.parent,t.shapeB,t.bodyA.parent,t.shapeA,t.contactEquations),t.bodyB.parent&&t.bodyB.parent.dispatch(q.ON_BEGIN_CONTACT,t.bodyA.parent,t.shapeA,t.bodyB.parent,t.shapeB,t.contactEquations))}},{key:"endContactHandler",value:function(t){t.bodyA&&t.bodyB&&(this.dispatch(q.ON_END_CONTACT,{bodyA:t.bodyA.parent,bodyB:t.bodyB.parent,shapeA:t.shapeA,shapeB:t.shapeB}),t.bodyA.parent&&t.bodyA.parent.dispatch(q.ON_END_CONTACT,t.bodyB.parent,t.bodyB,t.bodyA.parent,t.shapeA,t.shapeB),t.bodyB.parent&&t.bodyB.parent.dispatch(q.ON_END_CONTACT,t.bodyA.parent,t.bodyA,t.shapeB.parent,t.shapeB))}},{key:"createBody",value:function(t,e,o,i,n,r){void 0===i&&(i=!1);var a=new h.default(this,null,t,e,o);if(r){var s=a.addPolygon(n,r);if(!s)return!1}return i&&this.world.addBody(a.data),a}},{key:"setBoundsToWorld",value:function(t,e,o,i,n){this.setBounds(0,0,this.app.renderer.width,this.app.renderer.height,t,e,o,i,n)}},{key:"setBounds",value:function(t,e,o,i,n,r,a,s,l){void 0===n&&(n=this._boundsLeft),void 0===r&&(r=this._boundsRight),void 0===a&&(a=this._boundsTop),void 0===s&&(s=this._boundsBottom),void 0===l&&(l=this._boundsOwnGroup),this.setupWall(n,"left",t,e,1.5707963267948966,l),this.setupWall(r,"right",t+o,e,-1.5707963267948966,l),this.setupWall(a,"top",t,e,-3.141592653589793,l),this.setupWall(s,"bottom",t,e+i,0,l),this._boundsLeft=n,this._boundsRight=r,this._boundsTop=a,this._boundsBottom=s,this._boundsOwnGroup=l}},{key:"setupWall",value:function(t,e,o,i,n,r){if(console.log("setupWall",t,e,o,i,n,r),t){if(this.walls[e])this.walls[e].position=[this.pxmi(o),this.pxmi(i)];else{var a={mass:0,position:[this.pxmi(o),this.pxmi(i)],angle:n};console.log(e,a),this.walls[e]=new G.Body(a),this.walls[e].addShape(new G.Plane),this.world.addBody(this.walls[e]),console.log("add wall")}r&&(this.walls[e].shapes[0].collisionGroup=this.boundsCollisionGroup.mask,console.log("setCollisionGroup",this.boundsCollisionGroup.mask))}else this.walls[e]&&(this.world.removeBody(this.walls[e]),this.walls[e]=null)}},{key:"setWallMaterial",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];e&&this.walls.left&&(this.walls.left.shapes[0].material=t),o&&this.walls.right&&(this.walls.right.shapes[0].material=t),i&&this.walls.top&&(this.walls.top.shapes[0].material=t),n&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=t)}},{key:"updateBoundsCollisionGroup",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=t?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;this.walls.left&&(this.walls.left.shapes[0].collisionGroup=e),this.walls.right&&(this.walls.right.shapes[0].collisionGroup=e),this.walls.top&&(this.walls.top.shapes[0].collisionGroup=e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=e),this._boundsOwnGroup=t}},{key:"toJSON",value:function(){return this.world.toJSON()}},{key:"hitTest",value:function(t,e,o,i){void 0===e&&(e=this.world.bodies),void 0===o&&(o=5),void 0===i&&(i=!1);for(var n=[this.pxmi(t.x),this.pxmi(t.y)],r=[],a=e.length;a--;)e[a]instanceof h.default&&(!i||e[a].data.type!==G.Body.STATIC)?r.push(e[a].data):e[a]instanceof G.Body&&e[a].parent&&(!i||e[a].type!==G.Body.STATIC)?r.push(e[a]):e[a]instanceof Tiny.Sprite&&e[a].hasOwnProperty("body")&&(!i||e[a].body.data.type!==G.Body.STATIC)&&r.push(e[a].body.data);return this.world.hitTest(n,r,o)}},{key:"getBody",value:function(t){return t instanceof G.Body?t:t instanceof h.default?t.data:t.body&&t.body.type===N?t.body.data:null}},{key:"getBodies",value:function(){for(var t=[],e=this.world.bodies.length;e--;)t.push(this.world.bodies[e].parent);return t}},{key:"addSpring",value:function(t){return t instanceof m.default||t instanceof w.default?this.world.addSpring(t.data):this.world.addSpring(t),this.dispatch(q.ON_SPRING_ADDED,t),t}},{key:"createSpring",value:function(t,e,o,i,n,r,a,s,l){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addSpring(new m.default(this,t,e,o,i,n,r,a,s,l)):void console.warn("Cannot create Spring, invalid body objects given")}},{key:"createRotationalSpring",value:function(t,e,o,i,n){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addSpring(new w.default(this,t,e,o,i,n)):void console.warn("Cannot create Rotational Spring, invalid body objects given")}},{key:"removeSpring",value:function(t){return t instanceof m.default||t instanceof w.default?this.world.removeSpring(t.data):this.world.removeSpring(t),this.dispatch(q.ON_SPRING_REMOVED,t),t}},{key:"getSprings",value:function(){for(var t=[],e=this.world.springs.length;e--;)t.push(this.world.springs[e].parent);return t}},{key:"getConstraints",value:function(){for(var t=[],e=this.world.constraints.length;e--;)t.push(this.world.constraints[e]);return t}},{key:"createLockConstraint",value:function(t,e,o,i,n){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new B.default(this,t,e,o,i,n)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"createDistanceConstraint",value:function(t,e,o,i,n,r){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new E.default(this,t,e,o,i,n,r)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"createGearConstraint",value:function(t,e,o,i){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new P.default(this,t,e,o,i)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"createRevoluteConstraint",value:function(t,e,o,i,n,r){return t=this.getBody(t),o=this.getBody(o),t&&o?this.addConstraint(new _.default(this,t,e,o,i,n,r)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"createPrismaticConstraint",value:function(t,e,o,i,n,r,a){return t=this.getBody(t),e=this.getBody(e),t&&e?this.addConstraint(new F.default(this,t,e,o,i,n,r,a)):void console.warn("Cannot create Constraint, invalid body objects given")}},{key:"addConstraint",value:function(t){return this.world.addConstraint(t),this.dispatch(q.ON_CONSTRAIN_ADDED,t),t}},{key:"removeConstraint",value:function(t){return this.world.removeConstraint(t),this.dispatch(q.ON_CONSTRAIN_REMOVED,t),t}},{key:"addContactMaterial",value:function(t){return this.world.addContactMaterial(t),this.dispatch(q.ON_CONTACTMATERIAL_ADDED,t),t}},{key:"removeContactMaterial",value:function(t){return this.world.removeContactMaterial(t),this.dispatch(q.ON_CONTACTMATERIAL_REMOVED,t),t}},{key:"getContactMaterial",value:function(t,e){return this.world.getContactMaterial(t,e)}},{key:"setMaterial",value:function(t,e){for(var o=e.length;o--;)e[o].setMaterial(t)}},{key:"createMaterial",value:function(t,e){t=t||"";var o=new k.default(t);return this.materials.push(o),"undefined"!=typeof e&&e.setMaterial(o),o}},{key:"createContactMaterial",value:function(t,e,o){void 0===t&&(t=this.createMaterial()),void 0===e&&(e=this.createMaterial());var i=new T.default(t,e,o);return this.addContactMaterial(i)}},{key:"createCollisionGroup",value:function(t){var e=Math.pow(2,this._collisionGroupID);this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|e),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|e),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|e),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|e),this._collisionGroupID++;var o=new f.default(e);return this.collisionGroups.push(o),t&&this.setCollisionGroup(t,o),o}},{key:"setCollisionGroup",value:function(t,e){if(t instanceof p.default)for(var o=0;o<t.total;o++)t.children[o].body&&t.children[o].body.type===N&&t.children[o].body.setCollisionGroup(e);else t.body.setCollisionGroup(e)}},{key:"impactHandler",value:function(t){if(t.bodyA.parent&&t.bodyB.parent){var e=t.bodyA.parent,o=t.bodyB.parent;e._bodyCallbacks[t.bodyB.id]&&e._bodyCallbacks[t.bodyB.id].call(e._bodyCallbackContext[t.bodyB.id],e,o,t.shapeA,t.shapeB),o._bodyCallbacks[t.bodyA.id]&&o._bodyCallbacks[t.bodyA.id].call(o._bodyCallbackContext[t.bodyA.id],o,e,t.shapeB,t.shapeA),e._groupCallbacks[t.shapeB.collisionGroup]&&e._groupCallbacks[t.shapeB.collisionGroup].call(e._groupCallbackContext[t.shapeB.collisionGroup],e,o,t.shapeA,t.shapeB),o._groupCallbacks[t.shapeA.collisionGroup]&&o._groupCallbacks[t.shapeA.collisionGroup].call(o._groupCallbackContext[t.shapeA.collisionGroup],o,e,t.shapeB,t.shapeA)}}},{key:"setupImpactEvents",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._impactEvents!==t&&(t?this.world.on("impact",this.impactHandler,this):this.world.off("impact",this.impactHandler,this),this._impactEvents=t)}},{key:"paused",get:function(){return this._paused}},{key:"friction",get:function(){return this.world.defaultContactMaterial.friction},set:function(t){this.world.defaultContactMaterial.friction=t}},{key:"restitution",get:function(){return this.world.defaultContactMaterial.restitution},set:function(t){this.world.defaultContactMaterial.restitution=t}},{key:"defaultContactMaterial",get:function(){return this.world.defaultContactMaterial},set:function(t){this.world.defaultContactMaterial=t}},{key:"applySpringForces",get:function(){return this.world.applySpringForces},set:function(t){this.world.applySpringForces=t}},{key:"applyDamping",get:function(){return this.world.applyDamping},set:function(t){this.world.applyDamping=t}},{key:"applyGravity",get:function(){return this.world.applyGravity},set:function(t){this.world.applyGravity=t}},{key:"solveConstraints",get:function(){return this.world.solveConstraints},set:function(t){this.world.solveConstraints=t}},{key:"time",get:function(){return this.world.time}},{key:"emitImpactEvent",get:function(){return this.world.emitImpactEvent},set:function(t){this.world.emitImpactEvent=t}},{key:"sleepMode",get:function(){return this.world.sleepMode},set:function(t){this.world.sleepMode=t}},{key:"bodyCount",get:function(){return this.world.bodies.length}}]),e}(Tiny.EventEmitter);e.default=R},function(t,e,o){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e.default=t,e}function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,o,i){return o&&t(e.prototype,o),i&&t(e,i),e}}(),c=o(5),h=n(c),u=o(6),p=i(u),d=o(7),f=n(d),v=o(8),y=1,g=2,m=function(t){function e(t,o,i,n,s){r(this,e);var l=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o=o||null,i=i||0,n=n||0,void 0===s&&(s=1),l.world=t,l.app=l.world.app,l.sprite=o,l.type="Tiny.Physics.P2.Body",l.offset=new Tiny.Point,l.data=new v.Body({position:[l.world.pxmi(i),l.world.pxmi(n)],mass:s}),l.data.parent=l,l.velocity=new h.default(l.world,l.data.velocity),l.force=new h.default(l.world,l.data.force),l.collidesWith=[],l.removeNextStep=!1,l.debugBody=null,l.dirty=!1,l._collideWorldBounds=!0,l._bodyCallbacks={},l._bodyCallbackContext={},l._groupCallbacks={},l._groupCallbackContext={},l._reset=!1,o&&l.setRectangleFromSprite(o),l}return s(e,t),l(e,[{key:"getCollisionMask",value:function(){var t=0;this._collideWorldBounds&&(t=this.world.boundsCollisionGroup.mask);for(var e=0;e<this.collidesWith.length;e++)t|=this.collidesWith[e].mask;return t}},{key:"updateCollisionMask",value:function(t){var e=this.getCollisionMask();if(void 0===t)for(var o=this.data.shapes.length-1;o>=0;o--)this.data.shapes[o].collisionMask=e;else t.collisionMask=e}},{key:"setCollisionGroup",value:function(t,e){var o=this.getCollisionMask();if(void 0===e)for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionGroup=t.mask,this.data.shapes[i].collisionMask=o;else e.collisionGroup=t.mask,e.collisionMask=o}},{key:"clearCollision",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments[2];if(void 0===o)for(var i=this.data.shapes.length-1;i>=0;i--)t&&(this.data.shapes[i].collisionGroup=null),e&&(this.data.shapes[i].collisionMask=null);else t&&(o.collisionGroup=null),e&&(o.collisionMask=null);t&&(this.collidesWith.length=0)}},{key:"removeCollisionGroup",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments[2],i=void 0;if(Array.isArray(t))for(var n=0;n<t.length;n++)i=this.collidesWith.indexOf(t[n]),i>-1&&(this.collidesWith.splice(i,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));else i=this.collidesWith.indexOf(t),i>-1&&(this.collidesWith.splice(i,1),e&&(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]));var r=this.getCollisionMask();if(void 0===o)for(var a=this.data.shapes.length-1;a>=0;a--)this.data.shapes[a].collisionMask=r;else o.collisionMask=r}},{key:"collides",value:function(t,e,o,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.collidesWith.indexOf(t[n])===-1&&(this.collidesWith.push(t[n]),e&&this.createGroupCallback(t[n],e,o));else this.collidesWith.indexOf(t)===-1&&(this.collidesWith.push(t),e&&this.createGroupCallback(t,e,o));var r=this.getCollisionMask();if(void 0===i)for(var a=this.data.shapes.length-1;a>=0;a--)this.data.shapes[a].collisionMask=r;else i.collisionMask=r}},{key:"createBodyCallback",value:function(t,e,o){var i=-1;t.id?i=t.id:t.body&&(i=t.body.id),i>-1&&(null===e?(delete this._bodyCallbacks[i],delete this._bodyCallbackContext[i]):(this._bodyCallbacks[i]=e,this._bodyCallbackContext[i]=o))}},{key:"createGroupCallback",value:function(t,e,o){null===e?(delete this._groupCallbacks[t.mask],delete this._groupCallbackContext[t.mask]):(this._groupCallbacks[t.mask]=e,this._groupCallbackContext[t.mask]=o)}},{key:"applyDamping",value:function(t){this.data.applyDamping(t)}},{key:"applyImpulse",value:function(t,e,o){this.data.applyImpulse(t,[this.world.pxmi(e),this.world.pxmi(o)])}},{key:"applyImpulseLocal",value:function(t,e,o){this.data.applyImpulseLocal(t,[this.world.pxmi(e),this.world.pxmi(o)])}},{key:"applyForce",value:function(t,e,o){this.data.applyForce(t,[this.world.pxmi(e),this.world.pxmi(o)])}},{key:"addRectangle",value:function(t,e,o,i,n){var r=new v.Box({width:this.world.pxm(t),height:this.world.pxm(e)});return this.addShape(r,o,i,n)}},{key:"addPolygon",value:function(t,e){t=t||{},Array.isArray(e)||(e=Array.prototype.slice.call(arguments,1));var o=[];if(1===e.length&&Array.isArray(e[0]))o=e[0].slice(0);else if(Array.isArray(e[0]))o=e.slice();else if("number"==typeof e[0])for(var i=0,n=e.length;i<n;i+=2)o.push([e[i],e[i+1]]);var r=o.length-1;o[r][0]===o[0][0]&&o[r][1]===o[0][1]&&o.pop();for(var a=0;a<o.length;a++)o[a][0]=this.world.pxmi(o[a][0]),o[a][1]=this.world.pxmi(o[a][1]);var s=this.data.fromPolygon(o,t);return this.shapeChanged(),s}},{key:"addCircle",value:function(t,e,o,i){var n=new v.Circle({radius:this.world.pxm(t)});return this.addShape(n,e,o,i)}},{key:"addPlane",value:function(t,e,o){var i=new v.Plane;return this.addShape(i,t,e,o)}},{key:"addParticle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=new v.Particle;return this.addShape(i,t,e,o)}},{key:"addLine",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=new v.Line({length:this.world.pxm(t)});return this.addShape(n,e,o,i)}},{key:"addCapsule",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=new v.Capsule({length:this.world.pxm(t),radius:this.world.pxm(e)});return this.addShape(r,o,i,n)}},{key:"addShape",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.data.addShape(t,[this.world.pxmi(e),this.world.pxmi(o)],i),this.shapeChanged(),t}},{key:"removeShape",value:function(t){var e=this.data.removeShape(t);return this.shapeChanged(),e}},{key:"setCircle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clearShapes(),this.addCircle(t,e,o,i)}},{key:"setRectangle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return this.clearShapes(),this.addRectangle(t,e,o,i,n)}},{key:"setRectangleFromSprite",value:function(t){return void 0===t&&(t=this.sprite),this.clearShapes(),this.addRectangle(t.width,t.height,0,0,t.rotation)}},{key:"setMaterial",value:function(t,e){if(void 0===e)for(var o=this.data.shapes.length-1;o>=0;o--)this.data.shapes[o].material=t;else e.material=t}},{key:"loadPolygon",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&this.clearShapes();for(var o=t,i=v.vec2.create(),n=0;n<o.length;n++){for(var r=[],a=0;a<o[n].shape.length;a+=2)r.push([this.world.pxmi(o[n].shape[a]),this.world.pxmi(o[n].shape[a+1])]);for(var s=new v.Convex({vertices:r}),l=0;l!==s.vertices.length;l++){var c=s.vertices[l];v.vec2.sub(c,c,s.centerOfMass)}v.vec2.scale(i,s.centerOfMass,1),i[0]-=this.world.pxmi(this.sprite.width/2),i[1]-=this.world.pxmi(this.sprite.height/2),s.updateTriangles(),s.updateCenterOfMass(),s.updateBoundingRadius(),this.data.addShape(s,i)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}},{key:"clearShapes",value:function(){for(var t=this.data.shapes.length;t--;)this.data.removeShape(this.data.shapes[t]);this.shapeChanged()}},{key:"shapeChanged",value:function(){this.debugBody&&this.debugBody.draw(),this.dispatch("shapeChanged",this)}},{key:"preUpdate",value:function(){this.dirty=!0,this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)}},{key:"postUpdate",value:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x,this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y,this.fixedRotation?this.data.angle=this.sprite.rotation:this.sprite.rotation=this.data.angle,this.debugBody&&this.debugBody.updateSpriteTransform(),this.dirty=!1}},{key:"addToWorld",value:function(){this.world.addBody(this)}},{key:"removeFromWorld",value:function(){this.data.world===this.world.world&&this.world.removeBodyNextStep(this)}},{key:"destroy",value:function(){this.removeFromWorld(),this.clearShapes(),this._bodyCallbacks={},this._bodyCallbackContext={},this._groupCallbacks={},this._groupCallbackContext={},this.debugBody&&this.debugBody.destroy(!0,!0),this.debugBody=null,this.sprite&&(this.sprite.body=null,this.sprite=null)}},{key:"dispatch",value:function(t){for(var e=arguments.length,o=Array(e>1?e-1:0),i=1;i<e;i++)o[i-1]=arguments[i];this.emit.apply(this,arguments)}},{key:"setZeroForce",value:function(){this.data.setZeroForce()}},{key:"setZeroRotation",value:function(){this.data.angularVelocity=0}},{key:"setZeroVelocity",value:function(){this.data.velocity[0]=0,this.data.velocity[1]=0}},{key:"setZeroDamping",value:function(){this.damping=0,this.angularDamping=0}},{key:"moveForward",value:function(t){var e=this.world.pxmi(-t),o=this.data.angle+Math.PI/2;this.data.velocity[0]=e*Math.cos(o),this.data.velocity[1]=e*Math.sin(o)}},{key:"moveBackward",value:function(t){var e=this.world.pxmi(-t),o=this.data.angle+Math.PI/2;this.data.velocity[0]=-(e*Math.cos(o)),this.data.velocity[1]=-(e*Math.sin(o))}},{key:"moveLeft",value:function(t){this.data.velocity[0]=this.world.pxmi(-t)}},{key:"moveRight",value:function(t){this.data.velocity[0]=this.world.pxmi(t)}},{key:"moveUp",value:function(t){this.data.velocity[1]=this.world.pxmi(-t)}},{key:"moveDown",value:function(t){this.data.velocity[1]=this.world.pxmi(t)}},{key:"angle",get:function(){return p.wrapAngle(p.radToDeg(this.data.angle))},set:function(t){this.data.angle=p.degToRad(p.wrapAngle(t))}},{key:"mass",get:function(){return this.data.mass},set:function(t){t!==this.data.mass&&(this.data.mass=t,this.data.updateMassProperties())}},{key:"static",get:function(){return this.data.type===g},set:function(t){t&&this.data.type!==g?(this.data.type=g,this.mass=0):t||this.data.type!==g||(this.data.type=y,this.mass=1)}},{key:"allowSleep",get:function(){return this.data.allowSleep},set:function(t){t!==this.data.allowSleep&&(this.data.allowSleep=t)}},{key:"angularVelocity",get:function(){return this.data.angularVelocity},set:function(t){this.data.angularVelocity=t}},{key:"fixedRotation",get:function(){return this.data.fixedRotation},set:function(t){t!==this.data.fixedRotation&&(this.data.fixedRotation=t)}},{key:"inertia",get:function(){return this.data.inertia},set:function(t){this.data.inertia=t}},{key:"x",get:function(){return this.world.mpxi(this.data.position[0])},set:function(t){this.data.position[0]=this.world.pxmi(t)}},{key:"y",get:function(){return this.world.mpxi(this.data.position[1])},set:function(t){this.data.position[1]=this.world.pxmi(t)}},{key:"id",get:function(){return this.data.id}},{key:"damping",get:function(){return this.data.damping},set:function(t){this.data.damping=t}},{key:"angularDamping",get:function(){return this.data.angularDamping},set:function(t){this.data.angularDamping=t}},{key:"sleepSpeedLimit",get:function(){return this.data.sleepSpeedLimit},set:function(t){this.data.sleepSpeedLimit=t}},{key:"debug",get:function(){return null!==this.debugBody},set:function(t){t&&!this.debugBody?this.debugBody=new f.default(this):!t&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}},{key:"collideWorldBounds",get:function(){return this._collideWorldBounds},set:function(t){t&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!t&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}}]),e}(Tiny.EventEmitter);e.default=m},function(t,e){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,o,i){return o&&t(e.prototype,o),i&&t(e,i),e}}(),n=function(){function t(e,i){o(this,t),this.world=e,this.destination=i}return i(t,[{key:"x",get:function(){return this.world.mpxi(this.destination[0])},set:function(t){this.destination[0]=this.world.pxmi(t)}},{key:"y",get:function(){return this.world.mpxi(this.destination[1])},set:function(t){this.destination[1]=this.world.pxmi(t)}},{key:"mx",get:function(){return this.destination[0]},set:function(t){this.destination[0]=-t}},{key:"my",get:function(){return this.destination[1]},set:function(t){this.destination[1]=-t;
}}]),t}();e.default=n},function(t,e){"use strict";function o(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)}function i(t,e,o){var i=o-e;if(i<=0)return 0;var n=(t-e)%i;return n<0&&(n+=i),n+e}function n(t){return t*c}function r(t){return t*h}function a(t,e,o,i){var n=t-o,r=e-i;return Math.sqrt(n*n+r*r)}function s(t,e,o,i){return Math.atan2(i-e,o-t)}function l(t,e,o){return t<e?e:o<t?o:t}Object.defineProperty(e,"__esModule",{value:!0}),e.wrapAngle=o,e.wrap=i,e.degToRad=n,e.radToDeg=r,e.distance=a,e.angle=s,e.clamp=l;var c=Math.PI/180,h=180/Math.PI},function(t,e,o){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e.default=t,e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,o,i){return o&&t(e.prototype,o),i&&t(e,i),e}}(),l=o(2),c=i(l),h=o(8),u=function(t){function e(t,o){n(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),a=t.world,s={pixelsPerLengthUnit:a.mpx(1),debugPolygons:!1,lineWidth:1,alpha:.5,lineColor:16711680,fill:.5,fillColor:16711680};if(i.settings=c.extend(s,o),i.ppu=i.settings.pixelsPerLengthUnit,i.ppu=-1*i.ppu,i.world=a,i.body=t,i.p2body=t.data,i.canvas=new Tiny.Graphics,i.canvas.alpha=i.settings.alpha,i.addChild(i.canvas),void 0===i.world.app.stageDebugLayer){var l=new Tiny.Container;l.scale.set(Tiny.config.multiplier),i.world.app.camera.addChild(l),i.world.app.stageDebugLayer=l}if(void 0===i.world.app.stageDebugLayer.p2){var h=new Tiny.Container;i.world.app.stageDebugLayer.addChild(h),i.world.app.stageDebugLayer.p2=h}return i.world.app.stageDebugLayer.p2.addChild(i),i.draw(),i.updateSpriteTransform(),i}return a(e,t),s(e,[{key:"updateSpriteTransform",value:function(){this.position.x=this.body.x,this.position.y=this.body.y,this.rotation=this.body.sprite.rotation}},{key:"draw",value:function(){var t=void 0,e=void 0,o=void 0,i=void 0,n=void 0,r=void 0,a=void 0,s=void 0,l=void 0,u=void 0,p=void 0,d=void 0,f=void 0,v=void 0,y=void 0;if(s=this.p2body,u=this.canvas,u.clear(),o=parseInt(c.randomPastelHex(),16),r=this.settings.lineColor,a=this.settings.lineWidth,s instanceof h.Body&&s.shapes.length){var g=s.shapes.length;for(i=0;i!==g;){if(e=s.shapes[i],l=e.position||0,t=e.angle||0,e instanceof h.Circle)this.drawCircle(u,l[0]*this.ppu,l[1]*this.ppu,t,e.radius*this.ppu,o,a);else if(e instanceof h.Capsule)this.drawCapsule(u,l[0]*this.ppu,l[1]*this.ppu,t,e.length*this.ppu,e.radius*this.ppu,r,o,a);else if(e instanceof h.Plane)this.drawPlane(u,l[0]*this.ppu,-l[1]*this.ppu,o,r,5*a,10*a,10*a,100*this.ppu,t);else if(e instanceof h.Line)this.drawLine(u,e.length*this.ppu,r,a);else if(e instanceof h.Box)this.drawRectangle(u,l[0]*this.ppu,l[1]*this.ppu,t,e.width*this.ppu,e.height*this.ppu,r,o,a);else if(e instanceof h.Convex){for(d=[],f=h.vec2.create(),n=v=0,y=e.vertices.length;0<=y?v<y:v>y;n=0<=y?++v:--v)p=e.vertices[n],h.vec2.rotate(f,p,t),d.push([(f[0]+l[0])*this.ppu,-(f[1]+l[1])*this.ppu]);this.drawConvex(u,d,e.triangles,r,o,a,this.settings.debugPolygons,[l[0]*this.ppu,-l[1]*this.ppu])}else console.log("[BodyDebug] >> not defined");i++}}}},{key:"drawRectangle",value:function(t,e,o,i,n,r){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=(arguments[7],arguments.length>8&&void 0!==arguments[8]?arguments[8]:1);n=-n,r=-r,t.lineStyle(s,a,1),t.beginFill(16711680),t.drawRect(e-n/2,o-r/2,n,r),console.log("[BodyDebug] >> drawRectangles",e-n/2,o-r/2,n,r)}},{key:"drawCircle",value:function(t,e,o,i,n){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16777215,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;t.lineStyle(a,0,1),t.beginFill(r,1),t.drawCircle(e,o,-n),t.endFill(),t.moveTo(e,o),t.lineTo(e+n*Math.cos(-i),o+n*Math.sin(-i)),console.log("[BodyDebug] >> drawCircle",e,o,-n)}},{key:"drawLine",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.lineStyle(5*i,o,1),t.moveTo(-e/2,0),t.lineTo(e/2,0),console.log("[BodyDebug] >> drawLine",-e/2,0,e/2,0)}},{key:"drawConvex",value:function(t,e,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments[6],s=arguments[7],l=void 0,c=void 0,h=void 0,u=void 0,p=void 0,d=void 0,f=void 0,v=void 0,y=void 0,g=void 0,m=void 0;if(a){for(l=[16711680,65280,255],c=0;c!==e.length+1;)u=e[c%e.length],p=e[(c+1)%e.length],f=u[0],g=u[1],v=p[0],m=p[1],t.lineStyle(r,l[c%l.length],1),t.moveTo(f,-g),t.lineTo(v,-m),t.drawCircle(f,-g,2*r),c++;return t.lineStyle(r,0,1),t.drawCircle(s[0],s[1],2*r)}for(t.lineStyle(r,i,1),t.beginFill(n),c=0;c!==e.length;)h=e[c],d=h[0],y=h[1],0===c?t.moveTo(d,-y):t.lineTo(d,-y),c++;return t.endFill(),e.length>2?(t.moveTo(e[e.length-1][0],-e[e.length-1][1]),t.lineTo(e[0][0],-e[0][1])):void console.log("[BodyDebug] >> drawConvex")}},{key:"drawPath",value:function(t,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=void 0,a=void 0,s=void 0,l=void 0,c=void 0,h=void 0,u=void 0,p=void 0,d=void 0,f=void 0,v=void 0,y=void 0,g=void 0;for(t.lineStyle(n,o,1),"number"==typeof i&&t.beginFill(i),s=null,l=null,a=0;a<e.length;)v=e[a],y=v[0],g=v[1],y===s&&g===l||(0===a?t.moveTo(y,g):(c=s,h=l,u=y,p=g,d=e[(a+1)%e.length][0],f=e[(a+1)%e.length][1],r=(u-c)*(f-h)-(d-c)*(p-h),0!==r&&t.lineTo(y,g)),s=y,l=g),a++;"number"==typeof i&&t.endFill(),e.length>2&&"number"==typeof i&&(t.moveTo(e[e.length-1][0],e[e.length-1][1]),t.lineTo(e[0][0],e[0][1])),console.log("[BodyDebug] >> drawPath")}},{key:"drawPlane",value:function(t,e,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16777215,n=arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=(arguments[6],arguments[7],arguments[8]),s=arguments[9],l=void 0,c=void 0,h=void 0;t.lineStyle(r,n,11),t.beginFill(i),l=a,t.moveTo(e,-o),c=e+Math.cos(s)*this.game.width,h=o+Math.sin(s)*this.game.height,t.lineTo(c,-h),t.moveTo(e,-o),c=e+Math.cos(s)*-this.game.width,h=o+Math.sin(s)*-this.game.height,t.lineTo(c,-h),console.log("[BodyDebug] >> drawPlane")}},{key:"drawCapsule",value:function(t,e,o,i,n,r){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1;t.lineStyle(l,a,1);var c=Math.cos(i),h=Math.sin(i);t.beginFill(s,1),t.drawCircle(-n/2*c+e,-n/2*h+o,2*-r),t.drawCircle(n/2*c+e,n/2*h+o,2*-r),t.endFill(),t.lineStyle(l,a,0),t.beginFill(s,1),t.moveTo(-n/2*c+r*h+e,-n/2*h+r*c+o),t.lineTo(n/2*c+r*h+e,n/2*h+r*c+o),t.lineTo(n/2*c-r*h+e,n/2*h-r*c+o),t.lineTo(-n/2*c-r*h+e,-n/2*h-r*c+o),t.endFill(),t.lineStyle(l,a,1),t.moveTo(-n/2*c+r*h+e,-n/2*h+r*c+o),t.lineTo(n/2*c+r*h+e,n/2*h+r*c+o),t.moveTo(-n/2*c-r*h+e,-n/2*h-r*c+o),t.lineTo(n/2*c-r*h+e,n/2*h-r*c+o),console.log("[BodyDebug] >> drawCapsule")}},{key:"destroy",value:function(){this.canvas&&(this.removeChild(this.canvas),this.world.app.stage.addChild(this),this.canvas=null)}}]),e}(Tiny.Sprite);e.default=u},function(t,e,o){"use strict";t.exports={AABB:o(9),AngleLockEquation:o(12),Body:o(14),Broadphase:o(26),Capsule:o(27),Circle:o(28),Constraint:o(29),ContactEquation:o(30),ContactEquationPool:o(31),ContactMaterial:o(33),Convex:o(20),DistanceConstraint:o(35),Equation:o(13),EventEmitter:o(25),FrictionEquation:o(36),FrictionEquationPool:o(37),GearConstraint:o(38),GSSolver:o(39),Heightfield:o(41),Line:o(42),LockConstraint:o(43),Material:o(34),Narrowphase:o(44),NaiveBroadphase:o(47),Particle:o(48),Plane:o(49),Pool:o(32),RevoluteConstraint:o(50),PrismaticConstraint:o(53),Ray:o(24),RaycastResult:o(23),Box:o(46),RotationalVelocityEquation:o(51),SAPBroadphase:o(54),Shape:o(21),Solver:o(40),Spring:o(55),TopDownVehicle:o(56),LinearSpring:o(57),RotationalSpring:o(58),Utils:o(11),World:o(59),vec2:o(10),version:"0.7.1"}},function(t,e,o){"use strict";function i(t){t=t||{},this.lowerBound=t.lowerBound?n.clone(t.lowerBound):n.create(),this.upperBound=t.upperBound?n.clone(t.upperBound):n.create()}var n=o(10);t.exports=i;var r=n.create();i.prototype.setFromPoints=function(t,e,o,i){var a=this.lowerBound,s=this.upperBound;o=o||0,0!==o?n.rotate(a,t[0],o):n.copy(a,t[0]),n.copy(s,a);for(var l=Math.cos(o),c=Math.sin(o),h=1;h<t.length;h++){var u=t[h];if(0!==o){var p=u[0],d=u[1];r[0]=l*p-c*d,r[1]=c*p+l*d,u=r}for(var f=0;f<2;f++)u[f]>s[f]&&(s[f]=u[f]),u[f]<a[f]&&(a[f]=u[f])}e&&(n.add(a,a,e),n.add(s,s,e)),i&&(a[0]-=i,a[1]-=i,s[0]+=i,s[1]+=i)},i.prototype.copy=function(t){n.copy(this.lowerBound,t.lowerBound),n.copy(this.upperBound,t.upperBound)},i.prototype.extend=function(t){for(var e=this.lowerBound,o=this.upperBound,i=2;i--;){var n=t.lowerBound[i];e[i]>n&&(e[i]=n);var r=t.upperBound[i];o[i]<r&&(o[i]=r)}},i.prototype.overlaps=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound;return(i[0]<=o[0]&&o[0]<=n[0]||e[0]<=n[0]&&n[0]<=o[0])&&(i[1]<=o[1]&&o[1]<=n[1]||e[1]<=n[1]&&n[1]<=o[1])},i.prototype.containsPoint=function(t){var e=this.lowerBound,o=this.upperBound;return e[0]<=t[0]&&t[0]<=o[0]&&e[1]<=t[1]&&t[1]<=o[1]},i.prototype.overlapsRay=function(t){var e=1/t.direction[0],o=1/t.direction[1],i=t.from,n=this.lowerBound,r=this.upperBound,a=(n[0]-i[0])*e,s=(r[0]-i[0])*e,l=(n[1]-i[1])*o,c=(r[1]-i[1])*o,h=Math.max(Math.max(Math.min(a,s),Math.min(l,c))),u=Math.min(Math.min(Math.max(a,s),Math.max(l,c)));return u<0?-1:h>u?-1:h/t.length}},function(t,e,o){"use strict";var i=t.exports={},n=o(11);i.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},i.crossVZ=function(t,e,o){return i.rotate(t,e,-Math.PI/2),i.scale(t,t,o),t},i.crossZV=function(t,e,o){return i.rotate(t,o,Math.PI/2),i.scale(t,t,e),t},i.rotate=function(t,e,o){if(0!==o){var i=Math.cos(o),n=Math.sin(o),r=e[0],a=e[1];t[0]=i*r-n*a,t[1]=n*r+i*a}else t[0]=e[0],t[1]=e[1];return t},i.rotate90cw=function(t,e){var o=e[0],i=e[1];return t[0]=i,t[1]=-o,t},i.toLocalFrame=function(t,e,o,i){var n=Math.cos(-i),r=Math.sin(-i),a=e[0]-o[0],s=e[1]-o[1];return t[0]=n*a-r*s,t[1]=r*a+n*s,t},i.toGlobalFrame=function(t,e,o,i){var n=Math.cos(i),r=Math.sin(i),a=e[0],s=e[1],l=o[0],c=o[1];t[0]=n*a-r*s+l,t[1]=r*a+n*s+c},i.vectorToLocalFrame=function(t,e,o){var i=Math.cos(-o),n=Math.sin(-o),r=e[0],a=e[1];return t[0]=i*r-n*a,t[1]=n*r+i*a,t},i.vectorToGlobalFrame=i.rotate,i.centroid=function(t,e,o,n){return i.add(t,e,o),i.add(t,t,n),i.scale(t,t,1/3),t},i.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},i.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},i.fromValues=function(t,e){var o=new n.ARRAY_TYPE(2);return o[0]=t,o[1]=e,o},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},i.set=function(t,e,o){return t[0]=e,t[1]=o,t},i.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t},i.sub=i.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t},i.multiply=function(t,e,o){return t[0]=e[0]*o[0],t[1]=e[1]*o[1],t},i.divide=function(t,e,o){return t[0]=e[0]/o[0],t[1]=e[1]/o[1],t},i.scale=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t},i.distance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(o*o+i*i)},i.squaredDistance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i},i.length=function(t){var e=t[0],o=t[1];return Math.sqrt(e*e+o*o)},i.squaredLength=function(t){var e=t[0],o=t[1];return e*e+o*o},i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},i.normalize=function(t,e){var o=e[0],i=e[1],n=o*o+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},i.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},i.lerp=function(t,e,o,i){var n=e[0],r=e[1];return t[0]=n+i*(o[0]-n),t[1]=r+i*(o[1]-r),t},i.reflect=function(t,e,o){var i=e[0]*o[0]+e[1]*o[1];t[0]=e[0]-2*o[0]*i,t[1]=e[1]-2*o[1]*i},i.getLineSegmentsIntersection=function(t,e,o,n,r){var a=i.getLineSegmentsIntersectionFraction(e,o,n,r);return!(a<0)&&(t[0]=e[0]+a*(o[0]-e[0]),t[1]=e[1]+a*(o[1]-e[1]),!0)},i.getLineSegmentsIntersectionFraction=function(t,e,o,i){var n,r,a=e[0]-t[0],s=e[1]-t[1],l=i[0]-o[0],c=i[1]-o[1];return n=(-s*(t[0]-o[0])+a*(t[1]-o[1]))/(-l*s+a*c),r=(l*(t[1]-o[1])-c*(t[0]-o[0]))/(-l*s+a*c),n>=0&&n<=1&&r>=0&&r<=1?r:-1}},function(t,e){"use strict";function o(){}t.exports=o,o.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var o=0,i=e.length;o!==i;++o)t.push(e[o])},o.splice=function(t,e,o){o=o||1;for(var i=e,n=t.length-o;i<n;i++)t[i]=t[i+o];t.length=n},o.arrayRemove=function(t,e){var i=t.indexOf(e);i!==-1&&o.splice(t,i,1)},"undefined"!=typeof P2_ARRAY_TYPE?o.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?o.ARRAY_TYPE=Float32Array:o.ARRAY_TYPE=Array,o.extend=function(t,e){for(var o in e)t[o]=e[o]},o.shallowClone=function(t){var e={};return o.extend(e,t),e},o.defaults=function(t,e){console.warn("Utils.defaults is deprecated."),t=t||{};for(var o in e)o in t||(t[o]=e[o]);return t}},function(t,e,o){"use strict";function i(t,e,o){o=o||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0,this.ratio=void 0!==o.ratio?o.ratio:1,this.setRatio(this.ratio)}var n=o(13);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},i.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},i.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},function(t,e,o){"use strict";function i(t,e,o,n){this.minForce=void 0===o?-Number.MAX_VALUE:o,this.maxForce=void 0===n?Number.MAX_VALUE:n,this.maxBias=Number.MAX_VALUE,this.bodyA=t,this.bodyB=e,this.stiffness=i.DEFAULT_STIFFNESS,this.relaxation=i.DEFAULT_RELAXATION,this.G=new c.ARRAY_TYPE(6);for(var r=0;r<6;r++)this.G[r]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0,this.lambda=this.B=this.invC=this.minForceDt=this.maxForceDt=0,this.index=-1}function n(t,e,o,i,n,r){t[0]+=e*i*n*r[0],t[1]+=o*i*n*r[1]}t.exports=i;var r=o(10),a=r.scale,s=r.multiply,l=r.create,c=o(11);i.DEFAULT_STIFFNESS=1e6,i.DEFAULT_RELAXATION=4;var h=l(),u=l(),p=l(),d=l();i.prototype={update:function(){var t=this.stiffness,e=this.relaxation,o=this.timeStep;this.a=4/(o*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(o*o*t*(1+4*e)),this.needsUpdate=!1},gmult:function(t,e,o,i,n){return t[0]*e[0]+t[1]*e[1]+t[2]*o+t[3]*i[0]+t[4]*i[1]+t[5]*n},computeB:function(t,e,o){var i=this.computeGW(),n=this.computeGq(),r=this.maxBias;Math.abs(n)>r&&(n=n>0?r:-r);var a=this.computeGiMf(),s=-n*t-i*e-a*o;return s},computeGq:function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.angle,n=o.angle;return this.gmult(t,h,i,u,n)+this.offset},computeGW:function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,a=o.angularVelocity;return this.gmult(t,i,r,n,a)+this.relativeVelocity},computeGWlambda:function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.vlambda,n=o.vlambda,r=e.wlambda,a=o.wlambda;return this.gmult(t,i,r,n,a)},computeGiMf:function(){var t=this.bodyA,e=this.bodyB,o=t.force,i=t.angularForce,n=e.force,r=e.angularForce,l=t.invMassSolve,c=e.invMassSolve,h=t.invInertiaSolve,u=e.invInertiaSolve,f=this.G;return a(p,o,l),s(p,t.massMultiplier,p),a(d,n,c),s(d,e.massMultiplier,d),this.gmult(f,p,i*h,d,r*u)},computeGiMGt:function(){var t=this.bodyA,e=this.bodyB,o=t.invMassSolve,i=e.invMassSolve,n=t.invInertiaSolve,r=e.invInertiaSolve,a=this.G;return a[0]*a[0]*o*t.massMultiplier[0]+a[1]*a[1]*o*t.massMultiplier[1]+a[2]*a[2]*n+a[3]*a[3]*i*e.massMultiplier[0]+a[4]*a[4]*i*e.massMultiplier[1]+a[5]*a[5]*r},addToWlambda:function(t){var e=this.bodyA,o=this.bodyB,i=e.invMassSolve,r=o.invMassSolve,a=e.invInertiaSolve,s=o.invInertiaSolve,l=this.G;n(e.vlambda,l[0],l[1],i,t,e.massMultiplier),e.wlambda+=a*l[2]*t,n(o.vlambda,l[3],l[4],r,t,o.massMultiplier),o.wlambda+=s*l[5]*t},computeInvC:function(t){var e=1/(this.computeGiMGt()+t);return e}}},function(t,e,o){"use strict";function i(t){t=t||{},d.call(this),this.id=t.id||++i._idCounter,this.index=-1,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=s(),this.position=t.position?n.clone(t.position):s(),this.interpolatedPosition=n.clone(this.position),this.previousPosition=n.clone(this.position),this.velocity=t.velocity?n.clone(t.velocity):s(),this.vlambda=s(),this.wlambda=0,this.angle=t.angle||0,this.previousAngle=this.angle,this.interpolatedAngle=this.angle,this.angularVelocity=t.angularVelocity||0,this.force=t.force?n.clone(t.force):s(),this.angularForce=t.angularForce||0,this.damping=void 0!==t.damping?t.damping:.1,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.1,this.type=i.STATIC,void 0!==t.type?this.type=t.type:t.mass?this.type=i.DYNAMIC:this.type=i.STATIC,this.boundingRadius=0,this.aabb=new p,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=i.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.islandId=-1,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var n=o(10),r=n.add,a=n.subtract,s=n.create,l=o(15),c=o(20),h=o(23),u=o(24),p=o(9),d=o(25);t.exports=i,i.prototype=new d,i.prototype.constructor=i,i._idCounter=0;var f={type:"sleepy"},v={type:"sleep"},y={type:"wakeup"};i.prototype.updateSolveMassProperties=function(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},i.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},i.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},i.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var g=new p,m=s();i.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,o=m,i=this.angle,r=0;r!==e;r++){var a=t[r],s=a.angle+i;n.toGlobalFrame(o,a.position,this.position,i),a.computeAABB(g,o,s),0===r?this.aabb.copy(g):this.aabb.extend(g)}this.aabbNeedsUpdate=!1},i.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,o=0,i=0;i!==e;i++){var r=t[i],a=n.length(r.position),s=r.boundingRadius;a+s>o&&(o=a+s)}this.boundingRadius=o},i.prototype.addShape=function(t,e,o){if(t.body)throw new Error("A shape can only be added to one body.");var i=this.world;if(i&&i.stepping)throw new Error("A shape cannot be added during step.");t.body=this,e?n.copy(t.position,e):n.set(t.position,0,0),t.angle=o||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},i.prototype.removeShape=function(t){var e=this.world;if(e&&e.stepping)throw new Error("A shape cannot be removed during step.");var o=this.shapes.indexOf(t);return o!==-1&&(this.shapes.splice(o,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},i.prototype.updateMassProperties=function(){if(this.type===i.STATIC||this.type===i.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,o=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var r=0;r<e;r++){var a=t[r],s=n.squaredLength(a.position),l=a.computeMomentOfInertia();o+=l+s}this.inertia=this.mass*o,this.invInertia=o>0?1/o:0}this.invMass=1/this.mass,n.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}},i.prototype.applyForce=function(t,e){if(r(this.force,this.force,t),e){var o=n.crossLength(e,t);this.angularForce+=o}};var b=s(),w=s(),A=s();i.prototype.applyForceLocal=function(t,e){e=e||A;var o=b,i=w;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyForce(o,i)};var B=s();i.prototype.applyImpulse=function(t,e){if(this.type===i.DYNAMIC){var o=B;if(n.scale(o,t,this.invMass),n.multiply(o,this.massMultiplier,o),r(this.velocity,o,this.velocity),e){var a=n.crossLength(e,t);a*=this.invInertia,this.angularVelocity+=a}}};var C=s(),E=s(),M=s();i.prototype.applyImpulseLocal=function(t,e){e=e||M;var o=C,i=E;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyImpulse(o,i)},i.prototype.toLocalFrame=function(t,e){n.toLocalFrame(t,e,this.position,this.angle)},i.prototype.toWorldFrame=function(t,e){n.toGlobalFrame(t,e,this.position,this.angle)},i.prototype.vectorToLocalFrame=function(t,e){n.vectorToLocalFrame(t,e,this.angle)},i.prototype.vectorToWorldFrame=function(t,e){n.vectorToGlobalFrame(t,e,this.angle)},i.prototype.fromPolygon=function(t,e){e=e||{};for(var o=this.shapes.length;o>=0;--o)this.removeShape(this.shapes[o]);for(var i=[],o=0;o<t.length;o++)i[o]=n.clone(t[o]);if(l.makeCCW(i),void 0!==e.removeCollinearPoints&&l.removeCollinearPoints(i,e.removeCollinearPoints),!e.skipSimpleCheck&&!l.isSimple(i))return!1;for(var r=this.concavePath=[],o=0;o<i.length;o++)r[o]=n.clone(i[o]);var h;h=e.optimalDecomp?l.decomp(i):l.quickDecomp(i);for(var u=s(),o=0;o!==h.length;o++){for(var p=new c({vertices:h[o]}),d=0;d!==p.vertices.length;d++){var f=p.vertices[d];a(f,f,p.centerOfMass)}n.copy(u,p.centerOfMass),p=new c({vertices:p.vertices}),this.addShape(p,u)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var P=s(),x=s(),_=s();i.prototype.adjustCenterOfMass=function(){var t=P,e=x,o=_,i=0;n.set(e,0,0);for(var s=0;s!==this.shapes.length;s++){var l=this.shapes[s];n.scale(t,l.position,l.area),r(e,e,t),i+=l.area}n.scale(o,e,1/i);for(var s=0;s!==this.shapes.length;s++){var l=this.shapes[s];a(l.position,l.position,o)}r(this.position,this.position,o);for(var s=0;this.concavePath&&s<this.concavePath.length;s++)a(this.concavePath[s],this.concavePath[s],o);this.updateMassProperties(),this.updateBoundingRadius()},i.prototype.setZeroForce=function(){var t=this.force;t[0]=t[1]=this.angularForce=0},i.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;n.set(e,0,0),t.wlambda=0},i.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;r(e,e,t.vlambda),t.angularVelocity+=t.wlambda},i.prototype.applyDamping=function(t){if(this.type===i.DYNAMIC){var e=this.velocity;n.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},i.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=i.AWAKE,this.idleTime=0,t!==i.AWAKE&&this.emit(y)},i.prototype.sleep=function(){this.sleepState=i.SLEEPING,this.angularVelocity=this.angularForce=0,n.set(this.velocity,0,0),n.set(this.force,0,0),this.emit(v)},i.prototype.sleepTick=function(t,e,o){if(this.allowSleep&&this.type!==i.SLEEPING){this.wantsToSleep=!1;var r=n.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),a=Math.pow(this.sleepSpeedLimit,2);r>=a?(this.idleTime=0,this.sleepState=i.AWAKE):(this.idleTime+=o,this.sleepState!==i.SLEEPY&&(this.sleepState=i.SLEEPY,this.emit(f))),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},i.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var S=s(),F=s();i.prototype.integrate=function(t){var e=this.invMass,o=this.force,i=this.position,a=this.velocity;n.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),n.scale(S,o,t*e),n.multiply(S,this.massMultiplier,S),r(a,S,a),this.integrateToTimeOfImpact(t)||(n.scale(F,a,t),r(i,i,F),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var L=new h,k=new u({mode:u.CLOSEST,skipBackfaces:!0}),O=s(),T=s(),I=s(),q=s();i.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||n.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;for(var e=[],o=this.world.disabledBodyCollisionPairs,i=0;i<o.length;i+=2){var s=o[i],l=o[i+1];s===this?e.push(l):l===this&&e.push(s)}n.normalize(O,this.velocity),n.scale(T,this.velocity,t),r(T,T,this.position),a(I,T,this.position);var c,h=this.angularVelocity*t,u=n.length(I),p=1;n.copy(k.from,this.position),n.copy(k.to,T),k.update();for(var i=0;i<this.shapes.length;i++){var d=this.shapes[i];if(L.reset(),k.collisionGroup=d.collisionGroup,k.collisionMask=d.collisionMask,this.world.raycast(L,k),c=L.body,c!==this&&e.indexOf(c)===-1||(c=null),c)break}if(!c||!p)return!1;L.getHitPoint(T,k),a(I,T,this.position),p=n.distance(T,this.position)/u;var f=this.angle;n.copy(q,this.position);for(var v=0,y=0,g=p,m=1;m>=y&&v<this.ccdIterations;){v++,g=(m+y)/2,n.scale(F,I,g),r(this.position,q,F),this.angle=f+h*g,this.updateAABB();var b=this.aabb.overlaps(c.aabb)&&this.world.narrowphase.bodiesOverlap(this,c,!0);b?m=g:y=g}return p=m,n.copy(this.position,q),this.angle=f,n.scale(F,I,p),r(this.position,this.position,F),this.fixedRotation||(this.angle+=h*p),!0},i.prototype.getVelocityAtPoint=function(t,e){return n.crossVZ(t,e,this.angularVelocity),n.subtract(t,this.velocity,t),t},i.DYNAMIC=1,i.STATIC=2,i.KINEMATIC=4,i.AWAKE=0,i.SLEEPY=1,i.SLEEPING=2},function(t,e,o){"use strict";t.exports={Polygon:o(16),Point:o(19)}},function(t,e,o){"use strict";function i(){this.vertices=[]}function n(t,e,o,i,n){n=n||0;var r=e[1]-t[1],a=t[0]-e[0],l=r*t[0]+a*t[1],c=i[1]-o[1],h=o[0]-i[0],u=c*o[0]+h*o[1],p=r*h-c*a;return s.eq(p,0,n)?[0,0]:[(h*l-a*u)/p,(r*u-c*l)/p]}var r=o(17),a=o(19),s=o(18);t.exports=i,i.prototype.at=function(t){var e=this.vertices,o=e.length;return e[t<0?t%o+o:t%o]},i.prototype.first=function(){return this.vertices[0]},i.prototype.last=function(){return this.vertices[this.vertices.length-1]},i.prototype.clear=function(){this.vertices.length=0},i.prototype.append=function(t,e,o){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof o)throw new Error("To is not given!");if(o-1<e)throw new Error("lol1");if(o>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var i=e;i<o;i++)this.vertices.push(t.vertices[i])},i.prototype.makeCCW=function(){for(var t=0,e=this.vertices,o=1;o<this.vertices.length;++o)(e[o][1]<e[t][1]||e[o][1]==e[t][1]&&e[o][0]>e[t][0])&&(t=o);a.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},i.prototype.reverse=function(){for(var t=[],e=0,o=this.vertices.length;e!==o;e++)t.push(this.vertices.pop());this.vertices=t},i.prototype.isReflex=function(t){return a.right(this.at(t-1),this.at(t),this.at(t+1))};var l=[],c=[];i.prototype.canSee=function(t,e){var o,i,n=l,s=c;if(a.leftOn(this.at(t+1),this.at(t),this.at(e))&&a.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;i=a.sqdist(this.at(t),this.at(e));for(var h=0;h!==this.vertices.length;++h)if((h+1)%this.vertices.length!==t&&h!==t&&a.leftOn(this.at(t),this.at(e),this.at(h+1))&&a.rightOn(this.at(t),this.at(e),this.at(h))&&(n[0]=this.at(t),n[1]=this.at(e),s[0]=this.at(h),s[1]=this.at(h+1),o=r.lineInt(n,s),a.sqdist(this.at(t),o)<i))return!1;return!0},i.prototype.copy=function(t,e,o){var n=o||new i;if(n.clear(),t<e)for(var r=t;r<=e;r++)n.vertices.push(this.vertices[r]);else{for(var r=0;r<=e;r++)n.vertices.push(this.vertices[r]);for(var r=t;r<this.vertices.length;r++)n.vertices.push(this.vertices[r])}return n},i.prototype.getCutEdges=function(){for(var t=[],e=[],o=[],n=new i,r=Number.MAX_VALUE,a=0;a<this.vertices.length;++a)if(this.isReflex(a))for(var s=0;s<this.vertices.length;++s)if(this.canSee(a,s)){e=this.copy(a,s,n).getCutEdges(),o=this.copy(s,a,n).getCutEdges();for(var l=0;l<o.length;l++)e.push(o[l]);e.length<r&&(t=e,r=e.length,t.push([this.at(a),this.at(s)]))}return t},i.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},i.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],o=0;o<t.length;o++)for(var i=t[o],n=0;n<e.length;n++){var r=e[n],a=r.slice(i);if(a){e.splice(n,1),e.push(a[0],a[1]);break}}return e}var i=t,o=this.vertices.indexOf(i[0]),n=this.vertices.indexOf(i[1]);return o!=-1&&n!=-1&&[this.copy(o,n),this.copy(n,o)]},i.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var o=0;o<e-1;o++)if(r.segmentsIntersect(t[e],t[e+1],t[o],t[o+1]))return!1;for(var e=1;e<t.length-2;e++)if(r.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},i.prototype.quickDecomp=function(t,e,o,r,s,l){s=s||100,l=l||0,r=r||25,t="undefined"!=typeof t?t:[],e=e||[],o=o||[];var c=[0,0],h=[0,0],u=[0,0],p=0,d=0,f=0,v=0,y=0,g=0,m=0,b=new i,w=new i,A=this,B=this.vertices;if(B.length<3)return t;if(l++,l>s)return console.warn("quickDecomp: max level ("+s+") reached."),t;for(var C=0;C<this.vertices.length;++C)if(A.isReflex(C)){e.push(A.vertices[C]),p=d=Number.MAX_VALUE;for(var E=0;E<this.vertices.length;++E)a.left(A.at(C-1),A.at(C),A.at(E))&&a.rightOn(A.at(C-1),A.at(C),A.at(E-1))&&(u=n(A.at(C-1),A.at(C),A.at(E),A.at(E-1)),a.right(A.at(C+1),A.at(C),u)&&(f=a.sqdist(A.vertices[C],u),f<d&&(d=f,h=u,g=E))),a.left(A.at(C+1),A.at(C),A.at(E+1))&&a.rightOn(A.at(C+1),A.at(C),A.at(E))&&(u=n(A.at(C+1),A.at(C),A.at(E),A.at(E+1)),a.left(A.at(C-1),A.at(C),u)&&(f=a.sqdist(A.vertices[C],u),f<p&&(p=f,c=u,y=E)));if(g==(y+1)%this.vertices.length)u[0]=(h[0]+c[0])/2,u[1]=(h[1]+c[1])/2,o.push(u),C<y?(b.append(A,C,y+1),b.vertices.push(u),w.vertices.push(u),0!=g&&w.append(A,g,A.vertices.length),w.append(A,0,C+1)):(0!=C&&b.append(A,C,A.vertices.length),b.append(A,0,y+1),b.vertices.push(u),w.vertices.push(u),w.append(A,g,C+1));else{if(g>y&&(y+=this.vertices.length),v=Number.MAX_VALUE,y<g)return t;for(var E=g;E<=y;++E)a.leftOn(A.at(C-1),A.at(C),A.at(E))&&a.rightOn(A.at(C+1),A.at(C),A.at(E))&&(f=a.sqdist(A.at(C),A.at(E)),f<v&&(v=f,m=E%this.vertices.length));C<m?(b.append(A,C,m+1),0!=m&&w.append(A,m,B.length),w.append(A,0,C+1)):(0!=C&&b.append(A,C,B.length),b.append(A,0,m+1),w.append(A,m,C+1))}return b.vertices.length<w.vertices.length?(b.quickDecomp(t,e,o,r,s,l),w.quickDecomp(t,e,o,r,s,l)):(w.quickDecomp(t,e,o,r,s,l),b.quickDecomp(t,e,o,r,s,l)),t}return t.push(this),t},i.prototype.removeCollinearPoints=function(t){for(var e=0,o=this.vertices.length-1;this.vertices.length>3&&o>=0;--o)a.collinear(this.at(o-1),this.at(o),this.at(o+1),t)&&(this.vertices.splice(o%this.vertices.length,1),o--,e++);return e}},function(t,e,o){"use strict";function i(){}var n=o(18);t.exports=i,i.lineInt=function(t,e,o){o=o||0;var i,r,a,s,l,c,h,u=[0,0];return i=t[1][1]-t[0][1],r=t[0][0]-t[1][0],a=i*t[0][0]+r*t[0][1],s=e[1][1]-e[0][1],l=e[0][0]-e[1][0],c=s*e[0][0]+l*e[0][1],h=i*l-s*r,n.eq(h,0,o)||(u[0]=(l*a-r*c)/h,u[1]=(i*c-s*a)/h),u},i.segmentsIntersect=function(t,e,o,i){var n=e[0]-t[0],r=e[1]-t[1],a=i[0]-o[0],s=i[1]-o[1];if(a*r-s*n==0)return!1;var l=(n*(o[1]-t[1])+r*(t[0]-o[0]))/(a*r-s*n),c=(a*(t[1]-o[1])+s*(o[0]-t[0]))/(s*n-a*r);return l>=0&&l<=1&&c>=0&&c<=1}},function(t,e){"use strict";function o(){}
t.exports=o,o.eq=function(t,e,o){return o=o||0,Math.abs(t-e)<o}},function(t,e){"use strict";function o(){}t.exports=o,o.area=function(t,e,o){return(e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1])},o.left=function(t,e,i){return o.area(t,e,i)>0},o.leftOn=function(t,e,i){return o.area(t,e,i)>=0},o.right=function(t,e,i){return o.area(t,e,i)<0},o.rightOn=function(t,e,i){return o.area(t,e,i)<=0};var i=[],n=[];o.collinear=function(t,e,r,a){if(a){var s=i,l=n;s[0]=e[0]-t[0],s[1]=e[1]-t[1],l[0]=r[0]-e[0],l[1]=r[1]-e[1];var c=s[0]*l[0]+s[1]*l[1],h=Math.sqrt(s[0]*s[0]+s[1]*s[1]),u=Math.sqrt(l[0]*l[0]+l[1]*l[1]),p=Math.acos(c/(h*u));return p<a}return 0==o.area(t,e,r)},o.sqdist=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i}},function(t,e,o){"use strict";function i(t){t=t?c(t):{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],o=0;o<e.length;o++)this.vertices.push(a.clone(e[o]));for(var i=this.normals=[],o=0;o<e.length;o++)i.push(a.create());if(this.updateNormals(),this.centerOfMass=a.create(),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=t.type||r.CONVEX,r.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in counter-clockwise winding.")}function n(t,e,o){return.5*((e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1]))}var r=o(21),a=o(10),s=a.dot,l=o(22),c=o(11).shallowClone;t.exports=i,i.prototype=new r,i.prototype.constructor=i;var h=a.create(),u=a.create();i.prototype.updateNormals=function(){for(var t=this.vertices,e=this.normals,o=0;o<t.length;o++){var i=t[o],n=t[(o+1)%t.length],r=e[o];a.subtract(r,n,i),a.rotate90cw(r,r),a.normalize(r,r)}},i.prototype.projectOntoLocalAxis=function(t,e){for(var o,i,n=null,r=null,t=h,l=0;l<this.vertices.length;l++)o=this.vertices[l],i=s(o,t),(null===n||i>n)&&(n=i),(null===r||i<r)&&(r=i);if(r>n){var c=r;r=n,n=c}a.set(e,r,n)},i.prototype.projectOntoWorldAxis=function(t,e,o,i){var n=u;this.projectOntoLocalAxis(t,i),0!==o?a.rotate(n,t,o):n=t;var r=s(e,n);a.set(i,i[0]+r,i[1]+r)},i.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var o=this.vertices[e];t.push(o[0],o[1])}for(var i=l.Triangulate(t),e=0;e<i.length;e+=3){var n=i[e],r=i[e+1],a=i[e+2];this.triangles.push([n,r,a])}};var p=a.create(),d=a.create(),f=a.create(),v=a.create(),y=a.create();i.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,o=this.centerOfMass,i=p,r=f,s=v,l=y,c=d;a.set(o,0,0);for(var h=0,u=0;u!==t.length;u++){var g=t[u],r=e[g[0]],s=e[g[1]],l=e[g[2]];a.centroid(i,r,s,l);var m=n(r,s,l);h+=m,a.scale(c,i,m),a.add(o,o,c)}a.scale(o,o,1/h)},i.prototype.computeMomentOfInertia=function(){for(var t=0,e=0,o=this.vertices.length,i=o-1,n=0;n<o;i=n,n++){var r=this.vertices[i],l=this.vertices[n],c=Math.abs(a.crossLength(r,l)),h=s(l,l)+s(l,r)+s(r,r);t+=c*h,e+=c}return 1/6*(t/e)},i.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,o=0;o!==t.length;o++){var i=a.squaredLength(t[o]);i>e&&(e=i)}this.boundingRadius=Math.sqrt(e)},i.triangleArea=n,i.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,o=0;o!==t.length;o++){var i=t[o],r=e[i[0]],a=e[i[1]],s=e[i[2]],l=n(r,a,s);this.area+=l}},i.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)};var g=a.create(),m=a.create(),b=a.create();i.prototype.raycast=function(t,e,o,i){var n=g,r=m,s=b,l=this.vertices;a.toLocalFrame(n,e.from,o,i),a.toLocalFrame(r,e.to,o,i);for(var c=l.length,h=0;h<c&&!t.shouldStop(e);h++){var u=l[h],p=l[(h+1)%c],d=a.getLineSegmentsIntersectionFraction(n,r,u,p);d>=0&&(a.subtract(s,p,u),a.rotate(s,s,-Math.PI/2+i),a.normalize(s,s),e.reportIntersection(t,d,s,h))}};var w=a.create(),A=a.create();i.prototype.pointTest=function(t){for(var e=w,o=A,i=this.vertices,n=null,r=i.length,s=0;s<r+1;s++){var l=i[s%r],c=i[(s+1)%r];a.subtract(e,l,t),a.subtract(o,c,t);var h=a.crossLength(e,o);if(null===n&&(n=h),h*n<0)return!1;n=h}return!0}},function(t,e,o){"use strict";function i(t){t=t||{},this.body=null,this.position=n.create(),t.position&&n.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=i.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}t.exports=i;var n=o(10);i.idCounter=0,i.CIRCLE=1,i.PARTICLE=2,i.PLANE=4,i.CONVEX=8,i.LINE=16,i.BOX=32,i.CAPSULE=64,i.HEIGHTFIELD=128,i.prototype={computeMomentOfInertia:function(){},updateBoundingRadius:function(){},updateArea:function(){},computeAABB:function(){},raycast:function(){},pointTest:function(){return!1},worldPointToLocal:function(){var t=n.create();return function(e,o){var i=this.body;n.rotate(t,this.position,i.angle),n.add(t,t,i.position),n.toLocalFrame(e,o,t,this.body.angle+this.angle)}}()}},function(t,e){"use strict";var o={};o.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,o=0,i=0;i<e;i+=2)o+=(t[i+2]-t[i])*(t[i+1]+t[i+3]);return o+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-o},o.Triangulate=function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],n=[],r=0;r<e;r++)n.push(r);for(var r=0,a=e;a>3;){var s=n[(r+0)%a],l=n[(r+1)%a],c=n[(r+2)%a],h=t[2*s],u=t[2*s+1],p=t[2*l],d=t[2*l+1],f=t[2*c],v=t[2*c+1],y=!1;if(o._convex(h,u,p,d,f,v)){y=!0;for(var g=0;g<a;g++){var m=n[g];if(m!=s&&m!=l&&m!=c&&o._PointInTriangle(t[2*m],t[2*m+1],h,u,p,d,f,v)){y=!1;break}}}if(y)i.push(s,l,c),n.splice((r+1)%a,1),a--,r=0;else if(r++>3*a)break}return i.push(n[0],n[1],n[2]),i},o._PointInTriangle=function(t,e,o,i,n,r,a,s){var l=a-o,c=s-i,h=n-o,u=r-i,p=t-o,d=e-i,f=l*l+c*c,v=l*h+c*u,y=l*p+c*d,g=h*h+u*u,m=h*p+u*d,b=1/(f*g-v*v),w=(g*y-v*m)*b,A=(f*m-v*y)*b;return w>=0&&A>=0&&w+A<1},o._convex=function(t,e,o,i,n,r){return(e-i)*(n-o)+(o-t)*(r-i)>=0},t.exports=o},function(t,e,o){"use strict";function i(){this.normal=n.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var n=o(10),r=o(24);t.exports=i,i.prototype.reset=function(){n.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},i.prototype.getHitDistance=function(t){return n.distance(t.from,t.to)*this.fraction},i.prototype.hasHit=function(){return this.fraction!==-1},i.prototype.getHitPoint=function(t,e){n.lerp(t,e.from,e.to,this.fraction)},i.prototype.stop=function(){this.isStopped=!0},i.prototype.shouldStop=function(t){return this.isStopped||this.fraction!==-1&&t.mode===r.ANY},i.prototype.set=function(t,e,o,i,r){n.copy(this.normal,t),this.shape=e,this.body=o,this.fraction=i,this.faceIndex=r}},function(t,e,o){"use strict";function i(t){t=t||{},this.from=t.from?r.clone(t.from):r.create(),this.to=t.to?r.clone(t.to):r.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:i.ANY,this.callback=t.callback||function(){},this.direction=r.create(),this.length=1,this.update()}function n(t,e,o){r.subtract(s,o,t);var i=r.dot(s,e);return r.scale(l,e,i),r.add(l,l,t),r.squaredDistance(o,l)}t.exports=i;var r=o(10);i.prototype.constructor=i,i.CLOSEST=1,i.ANY=2,i.ALL=4,i.prototype.update=function(){var t=this.direction;r.subtract(t,this.to,this.from),this.length=r.length(t),r.normalize(t,t)},i.prototype.intersectBodies=function(t,e){for(var o=0,i=e.length;!t.shouldStop(this)&&o<i;o++){var n=e[o],r=n.getAABB();(r.overlapsRay(this)>=0||r.containsPoint(this.from))&&this.intersectBody(t,n)}};var a=r.create();i.prototype.intersectBody=function(t,e){var o=this.checkCollisionResponse;if(!o||e.collisionResponse)for(var i=a,n=0,s=e.shapes.length;n<s;n++){var l=e.shapes[n];if((!o||l.collisionResponse)&&0!==(this.collisionGroup&l.collisionMask)&&0!==(l.collisionGroup&this.collisionMask)){r.rotate(i,l.position,e.angle),r.add(i,i,e.position);var c=l.angle+e.angle;if(this.intersectShape(t,l,c,i,e),t.shouldStop(this))break}}},i.prototype.intersectShape=function(t,e,o,i,r){var a=this.from,s=n(a,this.direction,i);s>e.boundingRadius*e.boundingRadius||(this._currentBody=r,this._currentShape=e,e.raycast(t,this,i,o),this._currentBody=this._currentShape=null)},i.prototype.getAABB=function(t){var e=this.to,o=this.from;r.set(t.lowerBound,Math.min(e[0],o[0]),Math.min(e[1],o[1])),r.set(t.upperBound,Math.max(e[0],o[0]),Math.max(e[1],o[1]))},i.prototype.reportIntersection=function(t,e,o,n){var a=this._currentShape,s=this._currentBody;if(!(this.skipBackfaces&&r.dot(o,this.direction)>0))switch(this.mode){case i.ALL:t.set(o,a,s,e,n),this.callback(t);break;case i.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(o,a,s,e,n);break;case i.ANY:t.set(o,a,s,e,n)}};var s=r.create(),l=r.create()},function(t,e){"use strict";function o(){this.tmpArray=[]}t.exports=o,o.prototype={constructor:o,on:function(t,e,o){e.context=o||this,void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[t]&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e),this},off:function(t,e){var o=this._listeners;if(!o||!o[t])return this;var i=o[t].indexOf(e);return i!==-1&&o[t].splice(i,1),this},has:function(t,e){if(void 0===this._listeners)return!1;var o=this._listeners;if(e){if(void 0!==o[t]&&o[t].indexOf(e)!==-1)return!0}else if(void 0!==o[t])return!0;return!1},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,o=e[t.type];if(void 0!==o){t.target=this;for(var i=this.tmpArray,n=0,r=o.length;n<r;n++)i[n]=o[n];for(var n=0,r=i.length;n<r;n++){var a=i[n];a.call(a.context,t)}i.length=0}return this}}},function(t,e,o){"use strict";function i(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=i.AABB}var n=o(10),r=o(14);t.exports=i,i.AABB=1,i.BOUNDING_CIRCLE=2,i.prototype.setWorld=function(t){this.world=t},i.prototype.getCollisionPairs=function(){},i.boundingRadiusCheck=function(t,e){var o=n.squaredDistance(t.position,e.position),i=t.boundingRadius+e.boundingRadius;return o<=i*i},i.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},i.prototype.boundingVolumeCheck=function(t,e){var o;switch(this.boundingVolumeType){case i.BOUNDING_CIRCLE:o=i.boundingRadiusCheck(t,e);break;case i.AABB:o=i.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return o},i.canCollide=function(t,e){var o=r.KINEMATIC,i=r.STATIC,n=t.type,a=e.type;return(n!==i||a!==i)&&(!(n===o&&a===i||n===i&&a===o)&&((n!==o||a!==o)&&((t.sleepState!==r.SLEEPING||e.sleepState!==r.SLEEPING)&&!(t.sleepState===r.SLEEPING&&a===i||e.sleepState===r.SLEEPING&&n===i))))},i.NAIVE=1,i.SAP=2,i.prototype.aabbQuery=function(){}},function(t,e,o){"use strict";function i(t){t=t?r(t):{},this.length=void 0!==t.length?t.length:1,this.radius=void 0!==t.radius?t.radius:1,t.type=n.CAPSULE,n.call(this,t)}var n=o(21),r=o(11).shallowClone,a=o(10);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(){function t(t,e){return t*e*(Math.pow(t,2)+Math.pow(e,2))/12}function e(t){return Math.PI*Math.pow(t,2)/2}function o(t){return(Math.PI/4-8/(9*Math.PI))*Math.pow(t,4)}function i(t){return 4*t/(3*Math.PI)}function n(t,e){return 2*t*e+Math.PI*Math.pow(e,2)}function r(n,r){var a=n/2+i(r);return t(n,2*r)+2*(o(r)+e(r)*Math.pow(a,2))}var a=this.radius,s=this.length,l=n(s,a);return l>0?r(s,a)/l:0},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=a.create();i.prototype.computeAABB=function(t,e,o){var i=this.radius;a.set(s,this.length/2,0),0!==o&&a.rotate(s,s,o),a.set(t.upperBound,Math.max(s[0]+i,-s[0]+i),Math.max(s[1]+i,-s[1]+i)),a.set(t.lowerBound,Math.min(s[0]-i,-s[0]-i),Math.min(s[1]-i,-s[1]-i)),a.add(t.lowerBound,t.lowerBound,e),a.add(t.upperBound,t.upperBound,e)};var l=a.create(),c=a.create(),h=a.create(),u=a.create(),p=a.fromValues(0,1);i.prototype.raycast=function(t,e,o,i){for(var n=e.from,r=e.to,s=l,d=c,f=h,v=u,y=this.length/2,g=0;g<2;g++){var m=this.radius*(2*g-1);a.set(f,-y,m),a.set(v,y,m),a.toGlobalFrame(f,f,o,i),a.toGlobalFrame(v,v,o,i);var b=a.getLineSegmentsIntersectionFraction(n,r,f,v);if(b>=0&&(a.rotate(d,p,i),a.scale(d,d,2*g-1),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}for(var w=Math.pow(this.radius,2)+Math.pow(y,2),g=0;g<2;g++){a.set(f,y*(2*g-1),0),a.toGlobalFrame(f,f,o,i);var A=Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2),B=2*((r[0]-n[0])*(n[0]-f[0])+(r[1]-n[1])*(n[1]-f[1])),C=Math.pow(n[0]-f[0],2)+Math.pow(n[1]-f[1],2)-Math.pow(this.radius,2),b=Math.pow(B,2)-4*A*C;if(!(b<0))if(0===b){if(a.lerp(s,n,r,b),a.squaredDistance(s,o)>w&&(a.subtract(d,s,f),a.normalize(d,d),e.reportIntersection(t,b,d,-1),t.shouldStop(e)))return}else{var E=Math.sqrt(b),M=1/(2*A),P=(-B-E)*M,x=(-B+E)*M;if(P>=0&&P<=1&&(a.lerp(s,n,r,P),a.squaredDistance(s,o)>w&&(a.subtract(d,s,f),a.normalize(d,d),e.reportIntersection(t,P,d,-1),t.shouldStop(e))))return;if(x>=0&&x<=1&&(a.lerp(s,n,r,x),a.squaredDistance(s,o)>w&&(a.subtract(d,s,f),a.normalize(d,d),e.reportIntersection(t,x,d,-1),t.shouldStop(e))))return}}},i.prototype.pointTest=function(t){var e=this.radius,o=.5*this.length;return Math.abs(t[0])<=o&&Math.abs(t[1])<=e||(Math.pow(t[0]-o,2)+Math.pow(t[1],2)<=e*e||Math.pow(t[0]+o,2)+Math.pow(t[1],2)<=e*e)}},function(t,e,o){"use strict";function i(t){t=t?a(t):{},this.radius=void 0!==t.radius?t.radius:1,t.type=n.CIRCLE,n.call(this,t)}var n=o(21),r=o(10),a=o(11).shallowClone;t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(){var t=this.radius;return t*t/2},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},i.prototype.computeAABB=function(t,e){var o=this.radius;r.set(t.upperBound,o,o),r.set(t.lowerBound,-o,-o),e&&(r.add(t.lowerBound,t.lowerBound,e),r.add(t.upperBound,t.upperBound,e))};var s=r.create(),l=r.create();i.prototype.raycast=function(t,e,o){var i=e.from,n=e.to,a=this.radius,c=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),h=2*((n[0]-i[0])*(i[0]-o[0])+(n[1]-i[1])*(i[1]-o[1])),u=Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2)-Math.pow(a,2),p=Math.pow(h,2)-4*c*u,d=s,f=l;if(!(p<0))if(0===p)r.lerp(d,i,n,p),r.subtract(f,d,o),r.normalize(f,f),e.reportIntersection(t,p,f,-1);else{var v=Math.sqrt(p),y=1/(2*c),g=(-h-v)*y,m=(-h+v)*y;if(g>=0&&g<=1&&(r.lerp(d,i,n,g),r.subtract(f,d,o),r.normalize(f,f),e.reportIntersection(t,g,f,-1),t.shouldStop(e)))return;m>=0&&m<=1&&(r.lerp(d,i,n,m),r.subtract(f,d,o),r.normalize(f,f),e.reportIntersection(t,m,f,-1))}},i.prototype.pointTest=function(t){var e=this.radius;return r.squaredLength(t)<=e*e}},function(t,e){"use strict";function o(t,e,o,i){i=i||{},this.type=o,this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=void 0===i.collideConnected||i.collideConnected,i.wakeUpBodies!==!1&&(t&&t.wakeUp(),e&&e.wakeUp())}t.exports=o,o.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},o.DISTANCE=1,o.GEAR=2,o.LOCK=3,o.PRISMATIC=4,o.REVOLUTE=5,o.prototype.setStiffness=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.stiffness=t,i.needsUpdate=!0}},o.prototype.setRelaxation=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.relaxation=t,i.needsUpdate=!0}},o.prototype.setMaxBias=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.maxBias=t}}},function(t,e,o){"use strict";function i(t,e){r.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=a.create(),this.penetrationVec=a.create(),this.contactPointB=a.create(),this.normalA=a.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}function n(t,e,o,i,n){t[0]=e[0]+o[0]-i[0]-n[0],t[1]=e[1]+o[1]-i[1]-n[1]}var r=o(13),a=o(10);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.computeB=function(t,e,o){var i=this.bodyA,r=this.bodyB,s=this.contactPointA,l=this.contactPointB,c=i.position,h=r.position,u=this.normalA,p=this.G,d=a.crossLength(s,u),f=a.crossLength(l,u);p[0]=-u[0],p[1]=-u[1],p[2]=-d,p[3]=u[0],p[4]=u[1],p[5]=f;var v,y;if(this.firstImpact&&0!==this.restitution)y=0,v=1/e*(1+this.restitution)*this.computeGW();else{var g=this.penetrationVec;n(g,h,l,c,s),y=a.dot(u,g)+this.offset,v=this.computeGW()}var m=this.computeGiMf(),b=-y*t-v*e-o*m;return b};var s=a.create(),l=a.create(),c=a.create();i.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(s,this.contactPointA),this.bodyB.getVelocityAtPoint(l,this.contactPointB),a.subtract(c,s,l),a.dot(this.normalA,c)}},function(t,e,o){"use strict";function i(){r.apply(this,arguments)}var n=o(30),r=o(32);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.create=function(){return new n},i.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},function(t,e){"use strict";function o(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}t.exports=o,o.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},o.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},o.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},function(t,e,o){"use strict";function i(t,e,o){if(o=o||{},!(t instanceof n&&e instanceof n))throw new Error("First two arguments must be Material instances.");this.id=i.idCounter++,this.materialA=t,this.materialB=e,this.friction=void 0!==o.friction?o.friction:.3,this.restitution=void 0!==o.restitution?o.restitution:0,this.stiffness=void 0!==o.stiffness?o.stiffness:r.DEFAULT_STIFFNESS,this.relaxation=void 0!==o.relaxation?o.relaxation:r.DEFAULT_RELAXATION,this.frictionStiffness=void 0!==o.frictionStiffness?o.frictionStiffness:r.DEFAULT_STIFFNESS,this.frictionRelaxation=void 0!==o.frictionRelaxation?o.frictionRelaxation:r.DEFAULT_RELAXATION,this.surfaceVelocity=void 0!==o.surfaceVelocity?o.surfaceVelocity:0,this.contactSkinSize=.005}var n=o(34),r=o(13);t.exports=i,i.idCounter=0},function(t,e){"use strict";function o(){this.id=o.idCounter++}t.exports=o,o.idCounter=0},function(t,e,o){"use strict";function i(t,e,o){o=o||{},n.call(this,t,e,n.DISTANCE,o),this.localAnchorA=o.localAnchorA?a.clone(o.localAnchorA):a.create(),this.localAnchorB=o.localAnchorB?a.clone(o.localAnchorB):a.create();var i=this.localAnchorA,s=this.localAnchorB;if(this.distance=0,"number"==typeof o.distance)this.distance=o.distance;else{var l=a.create(),c=a.create(),h=a.create();a.rotate(l,i,t.angle),a.rotate(c,s,e.angle),a.add(h,e.position,c),a.subtract(h,h,l),a.subtract(h,h,t.position),this.distance=a.length(h)}var u;u="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce;var p=new r(t,e,-u,u);this.equations=[p],this.maxForce=u;var h=a.create(),d=a.create(),f=a.create(),v=this;p.computeGq=function(){var t=this.bodyA,e=this.bodyB,o=t.position,n=e.position;return a.rotate(d,i,t.angle),a.rotate(f,s,e.angle),a.add(h,n,f),a.subtract(h,h,d),a.subtract(h,h,o),a.length(h)-v.distance},this.setMaxForce(u),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var n=o(29),r=o(13),a=o(10);t.exports=i,i.prototype=new n,i.prototype.constructor=i;var s=a.create(),l=a.create(),c=a.create();i.prototype.update=function(){var t=this.equations[0],e=this.bodyA,o=this.bodyB,i=e.position,n=o.position,r=this.equations[0],h=t.G;a.rotate(l,this.localAnchorA,e.angle),a.rotate(c,this.localAnchorB,o.angle),a.add(s,n,c),a.subtract(s,s,l),a.subtract(s,s,i),this.position=a.length(s);var u=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(r.maxForce=0,r.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(r.maxForce=this.maxForce,r.minForce=0,this.distance=this.lowerLimit,u=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!u)return void(r.enabled=!1);r.enabled=!0,a.normalize(s,s);var p=a.crossLength(l,s),d=a.crossLength(c,s);h[0]=-s[0],h[1]=-s[1],h[2]=-p,h[3]=s[0],h[4]=s[1],h[5]=d},i.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},i.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},function(t,e,o){"use strict";function i(t,e,o){r.call(this,t,e,-o,o),this.contactPointA=n.create(),this.contactPointB=n.create(),this.t=n.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var n=o(10),r=o(13);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},i.prototype.getSlipForce=function(){return this.maxForce},i.prototype.computeB=function(t,e,o){var i=this.contactPointA,r=this.contactPointB,a=this.t,s=this.G;s[0]=-a[0],s[1]=-a[1],s[2]=-n.crossLength(i,a),s[3]=a[0],s[4]=a[1],s[5]=n.crossLength(r,a);var l=this.computeGW(),c=this.computeGiMf(),h=-l*e-o*c;return h}},function(t,e,o){"use strict";function i(){r.apply(this,arguments)}var n=o(36),r=o(32);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.create=function(){return new n},i.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},function(t,e,o){"use strict";function i(t,e,o){o=o||{},n.call(this,t,e,n.GEAR,o),this.ratio=void 0!==o.ratio?o.ratio:1,this.angle=void 0!==o.angle?o.angle:e.angle-this.ratio*t.angle;var i=a.shallowClone(o);i.angle=this.angle,i.ratio=this.ratio,this.equations=[new r(t,e,i)],void 0!==o.maxTorque&&this.setMaxTorque(o.maxTorque)}var n=o(29),r=o(12),a=o(11);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.update=function(){var t=this.equations[0],e=this.ratio;t.ratio!==e&&t.setRatio(e),t.angle=this.angle},i.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},i.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},function(t,e,o){"use strict";function i(t){a.call(this,t,a.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=void 0!==t.tolerance?t.tolerance:1e-7,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}function n(t,e){for(var o=t.length;o--;){var i=t[o];i.multiplier=i.lambda*e}}function r(t){var e=t.B,o=t.epsilon,i=t.invC,n=t.lambda,r=t.computeGWlambda(),a=t.maxForceDt,s=t.minForceDt,l=i*(e-r-o*n),c=n+l;return c<s?l=s-n:c>a&&(l=a-n),t.lambda+=l,t.addToWlambda(l),l}var a=o(40),s=o(36);t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.solve=function(t,e){this.sortEquations();var o=0,i=this.iterations,a=this.frictionIterations,l=this.equations,c=l.length,h=Math.pow(this.tolerance*c,2),u=e.bodies,p=u.length;if(this.usedIterations=0,c)for(var d=0;d!==p;d++){var f=u[d];f.updateSolveMassProperties()}for(var d=0;d!==c;d++){var v=l[d];v.lambda=0,(v.timeStep!==t||v.needsUpdate)&&(v.timeStep=t,v.update()),v.B=v.computeB(v.a,v.b,t),v.invC=v.computeInvC(v.epsilon),v.maxForceDt=v.maxForce*t,v.minForceDt=v.minForce*t}var v,y,d,g;if(0!==c){for(d=0;d!==p;d++){var f=u[d];f.resetConstraintVelocity()}if(a){for(o=0;o!==a;o++){for(y=0,g=0;g!==c;g++){v=l[g];var m=r(v,t);y+=Math.abs(m)}if(this.usedIterations++,y*y<=h)break}for(n(l,1/t),g=0;g!==c;g++){var b=l[g];if(b instanceof s){for(var w=0,A=0;A!==b.contactEquations.length;A++)w+=b.contactEquations[A].multiplier;w*=b.frictionCoefficient/b.contactEquations.length,b.maxForce=w,b.minForce=-w,b.maxForceDt=w*t,b.minForceDt=-w*t}}}for(o=0;o!==i;o++){for(y=0,g=0;g!==c;g++){v=l[g];var m=r(v,t);y+=Math.abs(m)}if(this.usedIterations++,y*y<h)break}for(d=0;d!==p;d++)u[d].addConstraintVelocity();n(l,1/t)}}},function(t,e,o){"use strict";function i(t,e){t=t||{},n.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var n=o(25);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!")},i.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.addEquations=function(t){for(var e=0,o=t.length;e!==o;e++){var i=t[e];i.enabled&&this.equations.push(i)}},i.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);e!==-1&&this.equations.splice(e,1)},i.prototype.removeAllEquations=function(){this.equations.length=0},i.GS=1},function(t,e,o){"use strict";function i(t){t=t?a(t):{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=void 0!==t.elementWidth?t.elementWidth:.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=n.HEIGHTFIELD,n.call(this,t)}var n=o(21),r=o(10),a=o(11).shallowClone;t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],o=t[0],i=0;i!==t.length;i++){var n=t[i];n>e&&(e=n),n<o&&(o=n)}this.maxValue=e,this.minValue=o},i.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE},i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},i.prototype.updateArea=function(){for(var t=this.heights,e=0,o=0;o<t.length-1;o++)e+=(t[o]+t[o+1])/2*this.elementWidth;this.area=e};var s=[r.create(),r.create(),r.create(),r.create()];i.prototype.computeAABB=function(t,e,o){r.set(s[0],0,this.maxValue),r.set(s[1],this.elementWidth*this.heights.length,this.maxValue),r.set(s[2],this.elementWidth*this.heights.length,this.minValue),r.set(s[3],0,this.minValue),t.setFromPoints(s,e,o)},i.prototype.getLineSegment=function(t,e,o){var i=this.heights,n=this.elementWidth;r.set(t,o*n,i[o]),r.set(e,(o+1)*n,i[o+1])},i.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},i.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};var l=r.create(),c=r.create(),h=r.create(),u=r.create(),p=r.create();i.prototype.raycast=function(t,e,o,i){var n=e.from,a=e.to,s=l,d=c,f=h,v=u,y=p;r.toLocalFrame(v,n,o,i),r.toLocalFrame(y,a,o,i);var g=this.getClampedSegmentIndex(v),m=this.getClampedSegmentIndex(y);if(g>m){var b=g;g=m,m=b}for(var w=0;w<this.heights.length-1;w++){this.getLineSegment(d,f,w);var A=r.getLineSegmentsIntersectionFraction(v,y,d,f);if(A>=0&&(r.subtract(s,f,d),r.rotate(s,s,i+Math.PI/2),r.normalize(s,s),e.reportIntersection(t,A,s,-1),t.shouldStop(e)))return}}},function(t,e,o){"use strict";function i(t){t=t?r(t):{},this.length=void 0!==t.length?t.length:1,t.type=n.LINE,n.call(this,t)}var n=o(21),r=o(11).shallowClone,a=o(10);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(){return Math.pow(this.length,2)/12},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[a.create(),a.create()];i.prototype.computeAABB=function(t,e,o){var i=this.length/2;a.set(s[0],-i,0),a.set(s[1],i,0),t.setFromPoints(s,e,o,0)};var l=a.create(),c=a.create(),h=a.create(),u=a.fromValues(0,1);i.prototype.raycast=function(t,e,o,i){var n=e.from,r=e.to,s=c,p=h,d=this.length/2;a.set(s,-d,0),a.set(p,d,0),a.toGlobalFrame(s,s,o,i),a.toGlobalFrame(p,p,o,i);var f=a.getLineSegmentsIntersectionFraction(s,p,n,r);if(f>=0){var v=l;a.rotate(v,u,i),e.reportIntersection(t,f,v,-1)}}},function(t,e,o){"use strict";function i(t,e,o){o=o||{},n.call(this,t,e,n.LOCK,o);var i="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce,s=new a(t,e,-i,i),l=new a(t,e,-i,i),c=new a(t,e,-i,i),h=r.create(),u=r.create(),p=this;s.computeGq=function(){return r.rotate(h,p.localOffsetB,t.angle),r.subtract(u,e.position,t.position),r.subtract(u,u,h),u[0]},l.computeGq=function(){return r.rotate(h,p.localOffsetB,t.angle),r.subtract(u,e.position,t.position),r.subtract(u,u,h),u[1]};var d=r.create(),f=r.create();c.computeGq=function(){return r.rotate(d,p.localOffsetB,e.angle-p.localAngleB),r.scale(d,d,-1),r.subtract(u,t.position,e.position),r.add(u,u,d),r.rotate(f,d,-Math.PI/2),r.normalize(f,f),r.dot(u,f)},this.localOffsetB=r.create(),o.localOffsetB?r.copy(this.localOffsetB,o.localOffsetB):(r.subtract(this.localOffsetB,e.position,t.position),r.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof o.localAngleB?this.localAngleB=o.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(s,l,c),this.setMaxForce(i)}var n=o(29),r=o(10),a=o(13);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.setMaxForce=function(t){for(var e=this.equations,o=0;o<this.equations.length;o++)e[o].maxForce=t,e[o].minForce=-t},i.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=r.create(),l=r.create(),c=r.create(),h=r.fromValues(1,0),u=r.fromValues(0,1);i.prototype.update=function(){var t=this.equations[0],e=this.equations[1],o=this.equations[2],i=this.bodyA,n=this.bodyB;r.rotate(s,this.localOffsetB,i.angle),r.rotate(l,this.localOffsetB,n.angle-this.localAngleB),r.scale(l,l,-1),r.rotate(c,l,Math.PI/2),r.normalize(c,c),t.G[0]=-1,t.G[1]=0,t.G[2]=-r.crossLength(s,h),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-r.crossLength(s,u),e.G[4]=1,o.G[0]=-c[0],o.G[1]=-c[1],o.G[3]=c[0],o.G[4]=c[1],o.G[5]=r.crossLength(l,c)}},function(t,e,o){"use strict";function i(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.contactEquationPool=new A({size:32}),this.frictionEquationPool=new B({size:64}),this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new C,this.currentContactMaterial=null}function n(t,e){var o=e.radius,i=.5*e.length,n=t.vertices;u.set(n[0],-i,-o),u.set(n[1],i,-o),u.set(n[2],i,o),u.set(n[3],-i,o)}function r(t,e,o,i){var n=Q,r=$,a=tt,s=e.vertices,l=null;u.toLocalFrame(n,t,o,i);for(var c=0,h=s.length;c!==h+1;c++){var d=s[c%h],f=s[(c+1)%h];p(r,d,n),p(a,f,n);var v=u.crossLength(r,a);if(null===l&&(l=v),v*l<0)return!1;l=v}return!0}function a(t,e){for(var o=$,i=tt,n=e.vertices,r=null,a=n.length,s=0;s<a+1;s++){var l=n[s%a],c=n[(s+1)%a];p(o,l,t),p(i,c,t);var h=u.crossLength(o,i);if(null===r&&(r=h),h*r<0)return!1;r=h}return!0}function s(t,e,o,i){t[0]=e[0]+o[0]-i[0],t[1]=e[1]+o[1]-i[1]}function l(t,e,o,i,n,r,a){for(var s=e.vertices.length,l=n.vertices.length,c=e.normals,h=e.vertices,p=n.vertices,d=nt,f=rt,v=at,y=st,g=i-a,m=0,b=-Number.MAX_VALUE,w=0;w<s;++w){u.rotate(d,c[w],g),u.toGlobalFrame(y,h[w],o,i),u.toLocalFrame(f,y,r,a);for(var A=Number.MAX_VALUE,B=0;B<l;++B){u.subtract(v,p[B],f);var C=u.dot(d,v);C<A&&(A=C)}A>b&&(b=A,m=w)}return t[0]=b,m}function c(t,e,o,i,n,r,a,s){var l=e.normals,c=r.vertices.length,h=r.vertices,p=r.normals,d=lt;u.rotate(d,l[n],i-s);for(var f=0,v=Number.MAX_VALUE,y=0;y<c;++y){var g=u.dot(d,p[y]);g<v&&(v=g,f=y)}var m=f,b=m+1<c?m+1:0;u.toGlobalFrame(t[0],h[m],a,s),u.toGlobalFrame(t[1],h[b],a,s)}function h(t,e,o,i){var n=0,r=u.dot(o,e[0])-i,a=u.dot(o,e[1])-i;if(r<=0&&u.copy(t[n++],e[0]),a<=0&&u.copy(t[n++],e[1]),r*a<0){var s=r/(r-a),l=t[n];u.subtract(l,e[1],e[0]),u.scale(l,l,s),u.add(l,l,e[0]),++n}return n}var u=o(10),p=u.subtract,d=u.add,f=u.dot,v=u.rotate,y=u.normalize,g=u.copy,m=u.scale,b=u.squaredLength,w=u.create,A=o(31),B=o(37),C=o(45),E=o(28),M=o(20),P=o(21),x=o(46);t.exports=i;var _=u.fromValues(0,1),S=w(),F=w(),L=w(),k=w(),O=w(),T=w(),I=w(),q=w(),N=w(),G=w(),R=w(),V=w(),D=w(),W=w(),j=w(),U=[],X=w(),Y=w();i.prototype.bodiesOverlap=function(t,e,o){for(var i=X,n=Y,r=0,a=t.shapes.length;r!==a;r++)for(var s=t.shapes[r],l=0,c=e.shapes.length;l!==c;l++){var h=e.shapes[l];if(o&&(0===(s.collisionGroup&h.collisionMask)||0===(h.collisionGroup&s.collisionMask)))return;if(t.toWorldFrame(i,s.position),
e.toWorldFrame(n,h.position),s.type<=h.type){if(this[s.type|h.type](t,s,i,s.angle+t.angle,e,h,n,h.angle+e.angle,!0))return!0}else if(this[s.type|h.type](e,h,n,h.angle+e.angle,t,s,i,s.angle+t.angle,!0))return!0}return!1},i.prototype.collidedLastStep=function(t,e){var o=0|t.id,i=0|e.id;return!!this.collidingBodiesLastStep.get(o,i)},i.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var o=t[e],i=o.bodyA.id,n=o.bodyB.id;this.collidingBodiesLastStep.set(i,n,!0)}for(var r=this.contactEquations,a=this.frictionEquations,s=0;s<r.length;s++)this.contactEquationPool.release(r[s]);for(var s=0;s<a.length;s++)this.frictionEquationPool.release(a[s]);this.contactEquations.length=this.frictionEquations.length=0},i.prototype.createContactEquation=function(t,e,o,i){var n=this.contactEquationPool.get(),r=this.currentContactMaterial;return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.enabled=this.enabledEquations,n.firstImpact=!this.collidedLastStep(t,e),n.restitution=r.restitution,n.stiffness=r.stiffness,n.relaxation=r.relaxation,n.offset=r.contactSkinSize,n.needsUpdate=!0,n},i.prototype.createFrictionEquation=function(t,e,o,i){var n=this.frictionEquationPool.get(),r=this.currentContactMaterial;return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.setSlipForce(this.slipForce),n.enabled=this.enabledEquations,n.frictionCoefficient=r.friction,n.relativeVelocity=r.surfaceVelocity,n.stiffness=r.frictionStiffness,n.relaxation=r.frictionRelaxation,n.needsUpdate=!0,n.contactEquations.length=0,n},i.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return g(e.contactPointA,t.contactPointA),g(e.contactPointB,t.contactPointB),u.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},i.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],o=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),i=e.bodyA;u.set(o.contactPointA,0,0),u.set(o.contactPointB,0,0),u.set(o.t,0,0);for(var n=0;n!==t;n++)e=this.contactEquations[this.contactEquations.length-1-n],e.bodyA===i?(d(o.t,o.t,e.normalA),d(o.contactPointA,o.contactPointA,e.contactPointA),d(o.contactPointB,o.contactPointB,e.contactPointB)):(p(o.t,o.t,e.normalA),d(o.contactPointA,o.contactPointA,e.contactPointB),d(o.contactPointB,o.contactPointB,e.contactPointA)),o.contactEquations.push(e);var r=1/t;return m(o.contactPointA,o.contactPointA,r),m(o.contactPointB,o.contactPointB,r),y(o.t,o.t),u.rotate90cw(o.t,o.t),o},i.prototype[P.CONVEX|P.LINE]=i.prototype.convexLine=function(){return 0},i.prototype[P.LINE|P.BOX]=i.prototype.lineBox=function(){return 0};var H=new x({width:1,height:1}),z=w();i.prototype[P.CONVEX|P.CAPSULE]=i.prototype[P.BOX|P.CAPSULE]=i.prototype.convexCapsule=function(t,e,o,i,r,a,s,l,c){var h=z,p=a.length/2;u.set(h,p,0),u.toGlobalFrame(h,h,s,l);var d=this.circleConvex(r,a,h,l,t,e,o,i,c,a.radius);u.set(h,-p,0),u.toGlobalFrame(h,h,s,l);var f=this.circleConvex(r,a,h,l,t,e,o,i,c,a.radius);if(c&&d+f!==0)return 1;var v=H;n(v,a);var y=this.convexConvex(t,e,o,i,r,v,s,l,c);return y+d+f},i.prototype[P.LINE|P.CAPSULE]=i.prototype.lineCapsule=function(){return 0};var K=w(),Z=w(),J=new x({width:1,height:1});i.prototype[P.CAPSULE]=i.prototype.capsuleCapsule=function(t,e,o,i,r,a,s,l,c){for(var h,p=K,d=Z,f=0,v=0;v<2;v++){u.set(p,(0===v?-1:1)*e.length/2,0),u.toGlobalFrame(p,p,o,i);for(var y=0;y<2;y++){u.set(d,(0===y?-1:1)*a.length/2,0),u.toGlobalFrame(d,d,s,l),this.enableFrictionReduction&&(h=this.enableFriction,this.enableFriction=!1);var g=this.circleCircle(t,e,p,i,r,a,d,l,c,e.radius,a.radius);if(this.enableFrictionReduction&&(this.enableFriction=h),c&&0!==g)return 1;f+=g}}this.enableFrictionReduction&&(h=this.enableFriction,this.enableFriction=!1);var m=J;n(m,e);var b=this.convexCapsule(t,m,o,i,r,a,s,l,c);if(this.enableFrictionReduction&&(this.enableFriction=h),c&&0!==b)return 1;if(f+=b,this.enableFrictionReduction){var h=this.enableFriction;this.enableFriction=!1}n(m,a);var w=this.convexCapsule(r,m,s,l,t,e,o,i,c);return this.enableFrictionReduction&&(this.enableFriction=h),c&&0!==w?1:(f+=w,this.enableFrictionReduction&&f&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f)},i.prototype[P.LINE]=i.prototype.lineLine=function(){return 0},i.prototype[P.PLANE|P.LINE]=i.prototype.planeLine=function(t,e,o,i,n,r,a,s,l){var c=S,h=F,b=L,w=k,A=O,B=T,C=I,E=q,M=N,P=U,x=0;u.set(c,-r.length/2,0),u.set(h,r.length/2,0),u.toGlobalFrame(b,c,a,s),u.toGlobalFrame(w,h,a,s),g(c,b),g(h,w),p(A,h,c),y(B,A),u.rotate90cw(M,B),v(E,_,i),P[0]=c,P[1]=h;for(var G=0;G<P.length;G++){var R=P[G];p(C,R,o);var V=f(C,E);if(V<0){if(l)return 1;var D=this.createContactEquation(t,n,e,r);x++,g(D.normalA,E),y(D.normalA,D.normalA),m(C,E,V),p(D.contactPointA,R,C),p(D.contactPointA,D.contactPointA,t.position),p(D.contactPointB,R,a),d(D.contactPointB,D.contactPointB,a),p(D.contactPointB,D.contactPointB,n.position),this.contactEquations.push(D),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}}return l?0:(this.enableFrictionReduction||x&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(x)),x)},i.prototype[P.PARTICLE|P.CAPSULE]=i.prototype.particleCapsule=function(t,e,o,i,n,r,a,s,l){return this.circleLine(t,e,o,i,n,r,a,s,l,r.radius,0)},i.prototype[P.CIRCLE|P.LINE]=i.prototype.circleLine=function(t,e,o,i,n,r,a,s,l,c,h){var c=c||0,h=void 0!==h?h:e.radius,v=S,w=F,A=L,B=k,C=O,E=T,M=I,P=q,x=N,_=G,j=R,X=V,Y=D,H=W,z=U,K=r.length/2;u.set(P,-K,0),u.set(x,K,0),u.toGlobalFrame(_,P,a,s),u.toGlobalFrame(j,x,a,s),g(P,_),g(x,j),p(E,x,P),y(M,E),u.rotate90cw(C,M),p(X,o,P);var Z=f(X,C);p(B,P,a),p(Y,o,a);var J=h+c;if(Math.abs(Z)<J){m(v,C,Z),p(A,o,v),m(w,C,f(C,Y)),y(w,w),m(w,w,c),d(A,A,w);var Q=f(M,A),$=f(M,P),tt=f(M,x);if(Q>$&&Q<tt){if(l)return 1;var et=this.createContactEquation(t,n,e,r);return m(et.normalA,v,-1),y(et.normalA,et.normalA),m(et.contactPointA,et.normalA,h),d(et.contactPointA,et.contactPointA,o),p(et.contactPointA,et.contactPointA,t.position),p(et.contactPointB,A,a),d(et.contactPointB,et.contactPointB,a),p(et.contactPointB,et.contactPointB,n.position),this.contactEquations.push(et),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(et)),1}}z[0]=P,z[1]=x;for(var ot=0;ot<z.length;ot++){var it=z[ot];if(p(X,it,o),b(X)<Math.pow(J,2)){if(l)return 1;var et=this.createContactEquation(t,n,e,r);return g(et.normalA,X),y(et.normalA,et.normalA),m(et.contactPointA,et.normalA,h),d(et.contactPointA,et.contactPointA,o),p(et.contactPointA,et.contactPointA,t.position),p(et.contactPointB,it,a),m(H,et.normalA,-c),d(et.contactPointB,et.contactPointB,H),d(et.contactPointB,et.contactPointB,a),p(et.contactPointB,et.contactPointB,n.position),this.contactEquations.push(et),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(et)),1}}return 0},i.prototype[P.CIRCLE|P.CAPSULE]=i.prototype.circleCapsule=function(t,e,o,i,n,r,a,s,l){return this.circleLine(t,e,o,i,n,r,a,s,l,r.radius)},i.prototype[P.CIRCLE|P.CONVEX]=i.prototype[P.CIRCLE|P.BOX]=i.prototype.circleConvex=function(t,e,o,i,n,r,s,l,c,h){var h=void 0!==h?h:e.radius,v=S,w=F,A=L,B=k,C=O,E=T,M=I,P=q,x=G,_=R,N=D,V=W,U=j,X=-1,Y=Number.MAX_VALUE;u.set(E,0,0),u.toLocalFrame(M,o,s,l);for(var H=r.vertices,z=r.normals,K=H.length,Z=-1,J=-Number.MAX_VALUE,Q=r.boundingRadius+h,$=0;$<K;$++){p(P,M,H[$]);var tt=f(z[$],P);if(tt>Q)return 0;tt>J&&(J=tt,Z=$)}for(var $=Z+K-1;$<Z+K+2;$++){var et=H[$%K],ot=z[$%K];if(m(V,ot,-h),d(V,V,M),a(V,r)){p(U,et,V);var it=Math.abs(f(U,ot));it<Y&&(Y=it,X=$)}}if(X!==-1){if(c)return 1;var et=H[X%K],nt=H[(X+1)%K];u.toGlobalFrame(v,et,s,l),u.toGlobalFrame(w,nt,s,l),p(A,w,v),y(B,A),u.rotate90cw(C,B),m(V,C,-h),d(V,V,o),m(N,C,Y),d(N,N,V);var rt=this.createContactEquation(t,n,e,r);return p(rt.normalA,V,o),y(rt.normalA,rt.normalA),m(rt.contactPointA,rt.normalA,h),d(rt.contactPointA,rt.contactPointA,o),p(rt.contactPointA,rt.contactPointA,t.position),p(rt.contactPointB,N,s),d(rt.contactPointB,rt.contactPointB,s),p(rt.contactPointB,rt.contactPointB,n.position),this.contactEquations.push(rt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(rt)),1}if(h>0&&Z!==-1)for(var $=Z+K;$<Z+K+2;$++){var at=H[$%K];if(p(x,at,M),b(x)<h*h){if(c)return 1;u.toGlobalFrame(_,at,s,l),p(x,_,o);var rt=this.createContactEquation(t,n,e,r);return g(rt.normalA,x),y(rt.normalA,rt.normalA),m(rt.contactPointA,rt.normalA,h),d(rt.contactPointA,rt.contactPointA,o),p(rt.contactPointA,rt.contactPointA,t.position),p(rt.contactPointB,_,s),d(rt.contactPointB,rt.contactPointB,s),p(rt.contactPointB,rt.contactPointB,n.position),this.contactEquations.push(rt),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(rt)),1}}return 0};var Q=w(),$=w(),tt=w();i.prototype[P.PARTICLE|P.CONVEX]=i.prototype[P.PARTICLE|P.BOX]=i.prototype.particleConvex=function(t,e,o,i,n,a,s,l,c){var h=S,b=F,w=L,A=k,B=O,C=T,E=I,M=D,P=W,x=j,_=Number.MAX_VALUE,q=!1,N=a.vertices;if(!r(o,a,s,l))return 0;if(c)return 1;for(var G=0,R=N.length;G!==R+1;G++){var V=N[G%R],U=N[(G+1)%R];v(h,V,l),v(b,U,l),d(h,h,s),d(b,b,s),p(w,b,h),y(A,w),u.rotate90cw(B,A),p(C,h,s),p(E,o,s),p(P,h,o);var X=Math.abs(f(P,B));X<_&&(_=X,m(M,B,X),d(M,M,o),g(x,B),q=!0)}if(q){var Y=this.createContactEquation(t,n,e,a);return m(Y.normalA,x,-1),y(Y.normalA,Y.normalA),u.set(Y.contactPointA,0,0),d(Y.contactPointA,Y.contactPointA,o),p(Y.contactPointA,Y.contactPointA,t.position),p(Y.contactPointB,M,s),d(Y.contactPointB,Y.contactPointB,s),p(Y.contactPointB,Y.contactPointB,n.position),this.contactEquations.push(Y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Y)),1}return 0},i.prototype[P.CIRCLE]=i.prototype.circleCircle=function(t,e,o,i,n,r,a,l,c,h,u){var d=S,h=h||e.radius,u=u||r.radius;p(d,o,a);var f=h+u;if(b(d)>f*f)return 0;if(c)return 1;var v=this.createContactEquation(t,n,e,r),g=v.contactPointA,w=v.contactPointB,A=v.normalA;return p(A,a,o),y(A,A),m(g,A,h),m(w,A,-u),s(g,g,o,t.position),s(w,w,a,n.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},i.prototype[P.PLANE|P.CONVEX]=i.prototype[P.PLANE|P.BOX]=i.prototype.planeConvex=function(t,e,o,i,n,r,a,s,l){var c=S,h=F,d=L,y=k,b=O,w=T,A=0;v(h,_,i),u.vectorToLocalFrame(b,h,s),u.toLocalFrame(y,o,a,s);for(var B=r.vertices,C=0,E=B.length;C!==E;C++){var M=B[C];if(p(w,M,y),f(w,b)<=0){if(l)return 1;u.toGlobalFrame(c,M,a,s),p(d,c,o),A++;var P=this.createContactEquation(t,n,e,r);p(d,c,o),g(P.normalA,h);var x=f(d,P.normalA);m(d,P.normalA,x),p(P.contactPointB,c,n.position),p(P.contactPointA,c,d),p(P.contactPointA,P.contactPointA,t.position),this.contactEquations.push(P),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(P))}}return this.enableFrictionReduction&&this.enableFriction&&A&&this.frictionEquations.push(this.createFrictionFromAverage(A)),A},i.prototype[P.PARTICLE|P.PLANE]=i.prototype.particlePlane=function(t,e,o,i,n,r,a,s,l){var c=S,h=F;s=s||0,p(c,o,a),v(h,_,s);var u=f(c,h);if(u>0)return 0;if(l)return 1;var d=this.createContactEquation(n,t,r,e);return g(d.normalA,h),m(c,d.normalA,u),p(d.contactPointA,o,c),p(d.contactPointA,d.contactPointA,n.position),p(d.contactPointB,o,t.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1},i.prototype[P.CIRCLE|P.PARTICLE]=i.prototype.circleParticle=function(t,e,o,i,n,r,a,s,l){var c=S,h=e.radius;if(p(c,a,o),b(c)>h*h)return 0;if(l)return 1;var u=this.createContactEquation(t,n,e,r),f=u.normalA,v=u.contactPointA,w=u.contactPointB;return g(f,c),y(f,f),m(v,f,h),d(v,v,o),p(v,v,t.position),p(w,a,n.position),this.contactEquations.push(u),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(u)),1};var et=new E({radius:1}),ot=w(),it=w();i.prototype[P.PLANE|P.CAPSULE]=i.prototype.planeCapsule=function(t,e,o,i,n,r,a,s,l){var c=ot,h=it,p=et,d=r.length/2;u.set(c,-d,0),u.set(h,d,0),u.toGlobalFrame(c,c,a,s),u.toGlobalFrame(h,h,a,s),p.radius=r.radius;var f;this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(n,p,c,0,t,e,o,i,l),y=this.circlePlane(n,p,h,0,t,e,o,i,l);if(this.enableFrictionReduction&&(this.enableFriction=f),l)return v+y;var g=v+y;return this.enableFrictionReduction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g},i.prototype[P.CIRCLE|P.PLANE]=i.prototype.circlePlane=function(t,e,o,i,n,r,a,s,l){var c=e.radius,h=S,u=F,y=L;p(h,o,a),v(u,_,s);var b=f(u,h);if(b>c)return 0;if(l)return 1;var w=this.createContactEquation(n,t,r,e);g(w.normalA,u);var A=w.contactPointB;m(A,w.normalA,-c),d(A,A,o),p(A,A,t.position);var B=w.contactPointA;return m(y,w.normalA,b),p(B,h,y),d(B,B,a),p(B,B,n.position),this.contactEquations.push(w),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w)),1};var nt=u.create(),rt=u.create(),at=u.create(),st=u.create(),lt=u.create(),ct=u.create(),ht=u.create(),ut=u.create(),pt=u.create(),dt=u.create(),ft=u.create(),vt=u.create(),yt=u.create(),gt=u.create(),mt=u.create(),bt=u.create(),wt=[u.create(),u.create()],At=[u.create(),u.create()],Bt=[u.create(),u.create()],Ct=2;i.prototype[P.CONVEX]=i.prototype[P.CONVEX|P.BOX]=i.prototype[P.BOX]=i.prototype.convexConvex=function(t,e,o,i,n,r,a,s,d){var f=0,v=bt,y=ct,g=ht,m=l(y,e,o,i,r,a,s),b=y[0];if(b>f)return 0;var w=l(g,r,a,s,e,o,i),A=g[0];if(A>f)return 0;var B,C,E,M,P,x,_,S,F,L;A>b?(B=r,C=e,_=n,S=t,E=a,P=s,M=o,x=i,F=w,L=1):(B=e,C=r,_=t,S=n,E=o,P=i,M=a,x=s,F=m,L=0);var k=Bt;c(k,B,E,P,F,C,M,x);var O=B.vertices.length,T=B.vertices,I=F,q=F+1<O?F+1:0,N=gt,G=mt;u.copy(N,T[I]),u.copy(G,T[q]);var R=ut;u.subtract(R,G,N),u.normalize(R,R);var V=pt;u.crossVZ(V,R,1);var D=dt;u.add(D,N,G),u.scale(D,D,.5);var W=ft;u.rotate(W,R,P);var j=vt;u.crossVZ(j,W,1),u.toGlobalFrame(N,N,E,P),u.toGlobalFrame(G,G,E,P);var U=u.dot(j,N),X=-u.dot(W,N)+f,Y=u.dot(W,G)+f,H=wt,z=At,K=0,Z=yt;if(u.scale(Z,W,-1),K=h(H,k,Z,X,I),K<2)return 0;if(K=h(z,H,W,Y,q),K<2)return 0;for(var J=0,Q=0;Q<Ct;++Q){var $=u.dot(j,z[Q])-U;if($<=f){if(d)return 1;++J;var tt=this.createContactEquation(_,S,B,C);u.copy(tt.normalA,j),u.copy(tt.contactPointB,z[Q]),p(tt.contactPointB,tt.contactPointB,S.position),u.scale(v,j,-$),u.add(tt.contactPointA,z[Q],v),p(tt.contactPointA,tt.contactPointA,_.position),this.contactEquations.push(tt),this.enableFriction&&!this.enableFrictionReduction&&this.frictionEquations.push(this.createFrictionFromContact(tt))}}return J&&this.enableFrictionReduction&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(J)),J};var Et=w(),Mt=w(),Pt=w(),xt=w(),_t=w(),St=w(),Ft=w();i.prototype[P.CIRCLE|P.HEIGHTFIELD]=i.prototype.circleHeightfield=function(t,e,o,i,n,r,a,s,l,c){var h=r.heights,c=c||e.radius,w=r.elementWidth,A=Mt,B=Et,C=_t,E=Ft,M=St,P=Pt,x=xt,_=Math.floor((o[0]-c-a[0])/w),S=Math.ceil((o[0]+c-a[0])/w);_<0&&(_=0),S>=h.length&&(S=h.length-1);for(var F=h[_],L=h[S],k=_;k<S;k++)h[k]<L&&(L=h[k]),h[k]>F&&(F=h[k]);if(o[1]-c>F)return 0;for(var O=!1,k=_;k<S;k++){u.set(P,k*w,h[k]),u.set(x,(k+1)*w,h[k+1]),d(P,P,a),d(x,x,a),p(M,x,P),v(M,M,Math.PI/2),y(M,M),m(B,M,-c),d(B,B,o),p(A,B,P);var T=f(A,M);if(B[0]>=P[0]&&B[0]<x[0]&&T<=0){if(l)return 1;O=!0,m(A,M,-T),d(C,B,A),g(E,M);var I=this.createContactEquation(n,t,r,e);g(I.normalA,E),m(I.contactPointB,I.normalA,-c),d(I.contactPointB,I.contactPointB,o),p(I.contactPointB,I.contactPointB,t.position),g(I.contactPointA,C),p(I.contactPointA,I.contactPointA,n.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}}if(O=!1,c>0)for(var k=_;k<=S;k++)if(u.set(P,k*w,h[k]),d(P,P,a),p(A,o,P),b(A)<Math.pow(c,2)){if(l)return 1;O=!0;var I=this.createContactEquation(n,t,r,e);g(I.normalA,A),y(I.normalA,I.normalA),m(I.contactPointB,I.normalA,-c),d(I.contactPointB,I.contactPointB,o),p(I.contactPointB,I.contactPointB,t.position),p(I.contactPointA,P,a),d(I.contactPointA,I.contactPointA,a),p(I.contactPointA,I.contactPointA,n.position),this.contactEquations.push(I),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(I))}return O?1:0};var Lt=w(),kt=w(),Ot=w(),Tt=new M({vertices:[w(),w(),w(),w()]});i.prototype[P.BOX|P.HEIGHTFIELD]=i.prototype[P.CONVEX|P.HEIGHTFIELD]=i.prototype.convexHeightfield=function(t,e,o,i,n,r,a,s,l){var c=r.heights,h=r.elementWidth,f=Lt,v=kt,y=Ot,m=Tt,b=Math.floor((t.aabb.lowerBound[0]-a[0])/h),w=Math.ceil((t.aabb.upperBound[0]-a[0])/h);b<0&&(b=0),w>=c.length&&(w=c.length-1);for(var A=c[b],B=c[w],C=b;C<w;C++)c[C]<B&&(B=c[C]),c[C]>A&&(A=c[C]);if(t.aabb.lowerBound[1]>A)return 0;for(var E=0,C=b;C<w;C++){u.set(f,C*h,c[C]),u.set(v,(C+1)*h,c[C+1]),d(f,f,a),d(v,v,a);var M=100;u.set(y,.5*(v[0]+f[0]),.5*(v[1]+f[1]-M)),p(m.vertices[0],v,y),p(m.vertices[1],f,y),g(m.vertices[2],m.vertices[1]),g(m.vertices[3],m.vertices[0]),m.vertices[2][1]-=M,m.vertices[3][1]-=M,m.updateNormals(),E+=this.convexConvex(t,e,o,i,n,m,y,0,l)}return E}},function(t,e,o){"use strict";function i(){this.data={},this.keys=[]}var n=o(11);t.exports=i,i.prototype.getKey=function(t,e){return t|=0,e|=0,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},i.prototype.getByKey=function(t){return t|=0,this.data[t]},i.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},i.prototype.set=function(t,e,o){if(!o)throw new Error("No data!");var i=this.getKey(t,e);return this.data[i]||this.keys.push(i),this.data[i]=o,i},i.prototype.reset=function(){for(var t=this.data,e=this.keys,o=e.length;o--;)delete t[e[o]];e.length=0},i.prototype.copy=function(t){this.reset(),n.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var o=t.keys[e];this.data[o]=t.data[o]}}},function(t,e,o){"use strict";function i(t){t=t||{};var e=this.width=void 0!==t.width?t.width:1,o=this.height=void 0!==t.height?t.height:1,i=[n.fromValues(-e/2,-o/2),n.fromValues(e/2,-o/2),n.fromValues(e/2,o/2),n.fromValues(-e/2,o/2)],l=a(t);l.vertices=i,l.type=r.BOX,s.call(this,l)}var n=o(10),r=o(21),a=o(11).shallowClone,s=o(20);t.exports=i,i.prototype=new s,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(){var t=this.width,e=this.height;return(e*e+t*t)/12},i.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2},i.prototype.computeAABB=function(t,e,o){var i=Math.abs(Math.cos(o)),n=Math.abs(Math.sin(o)),r=this.width,a=this.height,s=.5*(r*n+a*i),l=.5*(a*n+r*i),c=t.lowerBound,h=t.upperBound,u=e[0],p=e[1];c[0]=u-l,c[1]=p-s,h[0]=u+l,h[1]=p+s},i.prototype.updateArea=function(){this.area=this.width*this.height},i.prototype.pointTest=function(t){return Math.abs(t[0])<=.5*this.width&&Math.abs(t[1])<=.5*this.height}},function(t,e,o){"use strict";function i(){n.call(this,n.NAIVE)}var n=o(26);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.getCollisionPairs=function(t){var e=t.bodies,o=this.result;o.length=0;for(var i=0,r=e.length;i!==r;i++)for(var a=e[i],s=0;s<i;s++){var l=e[s];n.canCollide(a,l)&&this.boundingVolumeCheck(a,l)&&o.push(a,l)}return o},i.prototype.aabbQuery=function(t,e,o){o=o||[];for(var i=t.bodies,n=0;n<i.length;n++){var r=i[n];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&o.push(r)}return o}},function(t,e,o){"use strict";function i(t){t=t?r(t):{},t.type=n.PARTICLE,n.call(this,t)}var n=o(21),r=o(11).shallowClone,a=o(10).copy;t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(){return 0},i.prototype.updateBoundingRadius=function(){this.boundingRadius=0},i.prototype.computeAABB=function(t,e){a(t.lowerBound,e),a(t.upperBound,e)}},function(t,e,o){"use strict";function i(t){t=t?a.shallowClone(t):{},t.type=n.PLANE,n.call(this,t)}var n=o(21),r=o(10),a=o(11);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(){return 0},i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},i.prototype.computeAABB=function(t,e,o){var i=o%(2*Math.PI),n=r.set,a=1e7,s=t.lowerBound,l=t.upperBound;n(s,-a,-a),n(l,a,a),0===i?l[1]=e[1]:i===Math.PI/2?s[0]=e[0]:i===Math.PI?s[1]=e[1]:i===3*Math.PI/2&&(l[0]=e[0])},i.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var s=r.create(),l=r.create(),c=r.create();i.prototype.raycast=function(t,e,o,i){var n=e.from,a=e.to,h=e.direction,u=s,p=l,d=c;r.set(p,0,1),r.rotate(p,p,i),r.subtract(d,n,o);var f=r.dot(d,p);r.subtract(d,a,o);var v=r.dot(d,p);if(!(f*v>0||r.squaredDistance(n,a)<f*f)){var y=r.dot(p,h);r.subtract(u,n,o);var g=-r.dot(p,u)/y/e.length;e.reportIntersection(t,g,p,-1)}},i.prototype.pointTest=function(t){return t[1]<=0}},function(t,e,o){"use strict";function i(t,e,o){o=o||{},n.call(this,t,e,n.REVOLUTE,o);var i=this.maxForce=void 0!==o.maxForce?o.maxForce:Number.MAX_VALUE,f=this.pivotA=l.create(),w=this.pivotB=l.create();o.worldPivot?(c(f,o.worldPivot,t.position),c(w,o.worldPivot,e.position),u(f,f,-t.angle),u(w,w,-e.angle)):(o.localPivotA&&d(f,o.localPivotA),o.localPivotB&&d(w,o.localPivotB));var A=this.motorEquation=new a(t,e);A.enabled=!1;var B=this.upperLimitEquation=new s(t,e),C=this.lowerLimitEquation=new s(t,e);B.minForce=C.maxForce=0;var E=this.equations=[new r(t,e,-i,i),new r(t,e,-i,i),A,B,C],M=E[0],P=E[1];M.computeGq=function(){return u(v,f,t.angle),u(y,w,e.angle),h(b,e.position,y),c(b,b,t.position),c(b,b,v),p(b,g)},P.computeGq=function(){return u(v,f,t.angle),u(y,w,e.angle),h(b,e.position,y),c(b,b,t.position),c(b,b,v),p(b,m)},P.minForce=M.minForce=-i,P.maxForce=M.maxForce=i,M.G[0]=-1,M.G[1]=0,M.G[3]=1,M.G[4]=0,P.G[0]=0,P.G[1]=-1,P.G[3]=0,P.G[4]=1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0}var n=o(29),r=o(13),a=o(51),s=o(52),l=o(10),c=l.subtract,h=l.add,u=l.rotate,p=l.dot,d=l.copy,f=l.crossLength;t.exports=i;var v=l.create(),y=l.create(),g=l.fromValues(1,0),m=l.fromValues(0,1),b=l.create();i.prototype=new n,i.prototype.constructor=i,i.prototype.setLimits=function(t,e){this.lowerLimit=t,this.upperLimit=e,this.lowerLimitEnabled=this.upperLimitEnabled=!0},i.prototype.update=function(){var t=this.bodyA,e=this.bodyB,o=this.pivotA,i=this.pivotB,n=this.equations,r=n[0],a=n[1],s=this.upperLimit,l=this.lowerLimit,c=this.upperLimitEquation,h=this.lowerLimitEquation,p=this.angle=e.angle-t.angle;c.angle=s,c.enabled=this.upperLimitEnabled&&p>s,h.angle=l,h.enabled=this.lowerLimitEnabled&&p<l,u(v,o,t.angle),u(y,i,e.angle);var d=r.G;d[2]=-f(v,g),d[5]=f(y,g);var b=a.G;b[2]=-f(v,m),b[5]=f(y,m)},Object.defineProperties(i.prototype,{motorEnabled:{get:function(){return this.motorEquation.enabled},set:function(t){this.motorEquation.enabled=t}},motorSpeed:{get:function(){return this.motorEquation.relativeVelocity},set:function(t){this.motorEquation.relativeVelocity=t}},motorMaxForce:{get:function(){return this.motorEquation.maxForce},set:function(t){var e=this.motorEquation;e.maxForce=t,e.minForce=-t}}}),i.prototype.enableMotor=function(){console.warn("revolute.enableMotor() is deprecated, do revolute.motorEnabled = true; instead."),this.motorEnabled=!0},i.prototype.disableMotor=function(){console.warn("revolute.disableMotor() is deprecated, do revolute.motorEnabled = false; instead."),this.motorEnabled=!1},i.prototype.motorIsEnabled=function(){return console.warn("revolute.motorIsEnabled() is deprecated, use revolute.motorEnabled instead."),this.motorEnabled},i.prototype.setMotorSpeed=function(t){console.warn("revolute.setMotorSpeed(speed) is deprecated, do revolute.motorSpeed = speed; instead."),this.motorSpeed=t},i.prototype.getMotorSpeed=function(){return console.warn("revolute.getMotorSpeed() is deprecated, use revolute.motorSpeed instead."),this.motorSpeed}},function(t,e,o){"use strict";function i(t,e){n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var n=o(13);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeB=function(t,e,o){var i=this.G;i[2]=-1,i[5]=this.ratio;var n=this.computeGiMf(),r=this.computeGW(),a=-r*e-o*n;return a}},function(t,e,o){"use strict";function i(t,e,o){o=o||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0;var i=this.G;i[2]=1,i[5]=-1}var n=o(13),r=o(10);t.exports=i,i.prototype=new n,i.prototype.constructor=i;var a=r.create(),s=r.create(),l=r.fromValues(1,0),c=r.fromValues(0,1);i.prototype.computeGq=function(){return r.rotate(a,l,this.bodyA.angle+this.angle),r.rotate(s,c,this.bodyB.angle),r.dot(a,s)}},function(t,e,o){"use strict";function i(t,e,o){o=o||{},n.call(this,t,e,n.PRISMATIC,o);var i=s.create(),c=s.fromValues(1,0),h=s.create();o.localAnchorA&&s.copy(i,o.localAnchorA),o.localAxisA&&s.copy(c,o.localAxisA),o.localAnchorB&&s.copy(h,o.localAnchorB),this.localAnchorA=i,this.localAnchorB=h,this.localAxisA=c;var u=this.maxForce=void 0!==o.maxForce?o.maxForce:Number.MAX_VALUE,p=new a(t,e,-u,u),d=new s.create,f=new s.create,v=new s.create,y=new s.create;if(p.computeGq=function(){return s.dot(v,y)},p.updateJacobian=function(){var o=this.G,n=t.position,r=e.position;s.rotate(d,i,t.angle),s.rotate(f,h,e.angle),s.add(v,r,f),s.subtract(v,v,n),s.subtract(v,v,d),s.rotate(y,c,t.angle+Math.PI/2),o[0]=-y[0],o[1]=-y[1],o[2]=-s.crossLength(d,y)+s.crossLength(y,v),o[3]=y[0],o[4]=y[1],o[5]=s.crossLength(f,y)},this.equations.push(p),!o.disableRotationalLock){var g=new l(t,e,-u,u);this.equations.push(g)}this.position=0,this.velocity=0,this.lowerLimitEnabled=void 0!==o.lowerLimit,this.upperLimitEnabled=void 0!==o.upperLimit,this.lowerLimit=void 0!==o.lowerLimit?o.lowerLimit:0,this.upperLimit=void 0!==o.upperLimit?o.upperLimit:1,this.upperLimitEquation=new r(t,e),this.lowerLimitEquation=new r(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=u,this.motorEquation=new a(t,e),this.motorEnabled=!1,this.motorSpeed=0;var m=this,b=this.motorEquation;b.computeGq=function(){return 0},b.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,a=o.angularVelocity;return this.gmult(t,i,r,n,a)+m.motorSpeed}}var n=o(29),r=o(30),a=o(13),s=o(10),l=o(52);t.exports=i,i.prototype=new n,i.prototype.constructor=i;var c=s.create(),h=s.create(),u=s.create(),p=s.create(),d=s.create(),f=s.create();i.prototype.update=function(){var t=this.equations,e=t[0],o=this.upperLimit,i=this.lowerLimit,n=this.upperLimitEquation,r=this.lowerLimitEquation,a=this.bodyA,l=this.bodyB,v=this.localAxisA,y=this.localAnchorA,g=this.localAnchorB;e.updateJacobian(),s.rotate(c,v,a.angle),s.rotate(p,y,a.angle),s.add(h,p,a.position),s.rotate(d,g,l.angle),s.add(u,d,l.position);var m=this.position=s.dot(u,c)-s.dot(h,c);if(this.motorEnabled){var b=this.motorEquation.G;b[0]=c[0],b[1]=c[1],b[2]=s.crossLength(c,d),b[3]=-c[0],b[4]=-c[1],b[5]=-s.crossLength(c,p)}if(this.upperLimitEnabled&&m>o)s.scale(n.normalA,c,-1),s.subtract(n.contactPointA,h,a.position),s.subtract(n.contactPointB,u,l.position),s.scale(f,c,o),s.add(n.contactPointA,n.contactPointA,f),t.indexOf(n)===-1&&t.push(n);else{var w=t.indexOf(n);w!==-1&&t.splice(w,1)}if(this.lowerLimitEnabled&&m<i)s.scale(r.normalA,c,1),s.subtract(r.contactPointA,h,a.position),s.subtract(r.contactPointB,u,l.position),s.scale(f,c,i),s.subtract(r.contactPointB,r.contactPointB,f),t.indexOf(r)===-1&&t.push(r);else{var w=t.indexOf(r);w!==-1&&t.splice(w,1)}},i.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},i.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},i.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},function(t,e,o){"use strict";function i(){a.call(this,a.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var o=t.axisList.indexOf(e.body);o!==-1&&t.axisList.splice(o,1)}}function n(t,e){e|=0;for(var o=1,i=t.length;o<i;o++){for(var n=t[o],r=o-1;r>=0&&!(t[r].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);r--)t[r+1]=t[r];t[r+1]=n}return t}var r=o(11),a=o(26);t.exports=i,i.prototype=new a,i.prototype.constructor=i,i.prototype.setWorld=function(t){this.axisList.length=0,r.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},i.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;n(t,e)},i.prototype.getCollisionPairs=function(){var t=this.axisList,e=this.result,o=this.axisIndex;e.length=0;for(var i=t.length;i--;){var n=t[i];n.aabbNeedsUpdate&&n.updateAABB()}this.sortList();for(var r=0,s=0|t.length;r!==s;r++)for(var l=t[r],c=r+1;c<s;c++){var h=t[c],u=h.aabb.lowerBound[o]<=l.aabb.upperBound[o];if(!u)break;a.canCollide(l,h)&&this.boundingVolumeCheck(l,h)&&e.push(l,h)}return e},i.prototype.aabbQuery=function(t,e,o){o=o||[],this.sortList();for(var i=this.axisList,n=0;n<i.length;n++){var r=i[n];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&o.push(r)}return o}},function(t,e){"use strict";function o(t,e,o){o=o||{},this.stiffness=void 0!==o.stiffness?o.stiffness:100,this.damping=void 0!==o.damping?o.damping:1,this.bodyA=t,this.bodyB=e}t.exports=o,o.prototype.applyForce=function(){}},function(t,e,o){"use strict";function i(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new l({mass:0}),this.world=null;var o=this;this.preStepCallback=function(){o.update()}}function n(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new s(t.chassisBody,t.groundBody),this.sideEquation=new s(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=r.fromValues(0,1),e.localForwardVector&&r.copy(this.localForwardVector,e.localForwardVector),this.localPosition=r.create(),e.localPosition&&r.copy(this.localPosition,e.localPosition),a.call(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var r=o(10),a=o(29),s=o(36),l=o(14);t.exports=i,i.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.addConstraint(o)}},i.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.removeConstraint(o)}this.world=null},i.prototype.addWheel=function(t){var e=new n(this,t);return this.wheels.push(e),e},i.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},n.prototype=new a,n.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},n.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var c=r.create(),h=r.create();n.prototype.getSpeed=function(){var t=this.vehicle.chassisBody;return t.vectorToWorldFrame(h,this.localForwardVector),t.getVelocityAtPoint(c,h),r.dot(c,h)};var u=r.create();n.prototype.update=function(){var t=this.vehicle.chassisBody,e=this.forwardEquation,o=this.sideEquation,i=this.steerValue;t.vectorToWorldFrame(e.t,this.localForwardVector),r.rotate(o.t,this.localForwardVector,Math.PI/2),t.vectorToWorldFrame(o.t,o.t),r.rotate(e.t,e.t,i),r.rotate(o.t,o.t,i),t.toWorldFrame(e.contactPointB,this.localPosition),r.copy(o.contactPointB,e.contactPointB),t.vectorToWorldFrame(e.contactPointA,this.localPosition),r.copy(o.contactPointA,e.contactPointA),r.normalize(u,e.t),r.scale(u,u,this.engineForce),
this.vehicle.chassisBody.applyForce(u,e.contactPointA)}},function(t,e,o){"use strict";function i(t,e,o){o=o||{},r.call(this,t,e,o),this.localAnchorA=n.create(),this.localAnchorB=n.create(),o.localAnchorA&&n.copy(this.localAnchorA,o.localAnchorA),o.localAnchorB&&n.copy(this.localAnchorB,o.localAnchorB),o.worldAnchorA&&this.setWorldAnchorA(o.worldAnchorA),o.worldAnchorB&&this.setWorldAnchorB(o.worldAnchorB);var i=n.create(),a=n.create();this.getWorldAnchorA(i),this.getWorldAnchorB(a);var s=n.distance(i,a);this.restLength=void 0!==o.restLength?o.restLength:s}var n=o(10),r=o(55);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},i.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},i.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},i.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var a=n.create(),s=n.create(),l=n.create(),c=n.create(),h=n.create(),u=n.create(),p=n.create(),d=n.create(),f=n.create();i.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restLength,i=this.bodyA,r=this.bodyB,v=a,y=s,g=l,m=c,b=f,w=h,A=u,B=p,C=d;this.getWorldAnchorA(w),this.getWorldAnchorB(A),n.subtract(B,w,i.position),n.subtract(C,A,r.position),n.subtract(v,A,w);var E=n.length(v);n.normalize(y,v),n.subtract(g,r.velocity,i.velocity),n.crossZV(b,r.angularVelocity,C),n.add(g,g,b),n.crossZV(b,i.angularVelocity,B),n.subtract(g,g,b),n.scale(m,y,-t*(E-o)-e*n.dot(g,y)),n.subtract(i.force,i.force,m),n.add(r.force,r.force,m);var M=n.crossLength(B,m),P=n.crossLength(C,m);i.angularForce-=M,r.angularForce+=P}},function(t,e,o){"use strict";function i(t,e,o){o=o||{},n.call(this,t,e,o),this.restAngle=void 0!==o.restAngle?o.restAngle:e.angle-t.angle}var n=o(55);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restAngle,i=this.bodyA,n=this.bodyB,r=n.angle-i.angle,a=n.angularVelocity-i.angularVelocity,s=-t*(r-o)-e*a*0;i.angularForce-=s,n.angularForce+=s}},function(t,e,o){"use strict";function i(t){u.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new l,this.narrowphase=new g,this.gravity=c.fromValues(0,-9.78),t.gravity&&c.copy(this.gravity,t.gravity),this.frictionGravity=c.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new y,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new d,this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.islandSplit=void 0===t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this.sleepMode=i.NO_SLEEPING,this.unionFind=new A(1),this._constraintIdCounter=0,this._bodyIdCounter=0,this.overlapKeeper=new w}function n(t,e){return t.islandId-e.islandId}function r(t,e){var o=t.bodyA.islandId>0?t.bodyA.islandId:t.bodyB.islandId,i=e.bodyA.islandId>0?e.bodyA.islandId:e.bodyB.islandId;return o!==i?o-i:t.index-e.index}function a(t,e,o,i,n,r,a,s,l,h,u,d){if(0!==(i.collisionGroup&s.collisionMask)&&0!==(s.collisionGroup&i.collisionMask)&&(c.toGlobalFrame(k,n,o.position,o.angle),c.toGlobalFrame(O,l,a.position,a.angle),!(c.distance(k,O)>i.boundingRadius+s.boundingRadius))){var f=r+o.angle,v=h+a.angle;e.enableFriction=u.friction>0;var y;y=o.type===p.STATIC||o.type===p.KINEMATIC?a.mass:a.type===p.STATIC||a.type===p.KINEMATIC?o.mass:o.mass*a.mass/(o.mass+a.mass),e.slipForce=u.friction*d*y,e.currentContactMaterial=u,e.enabledEquations=o.collisionResponse&&a.collisionResponse&&i.collisionResponse&&s.collisionResponse;var g=e[i.type|s.type],m=0;if(g){var b=i.sensor||s.sensor,w=e.frictionEquations.length;m=i.type<s.type?g.call(e,o,i,k,f,a,s,O,v,b):g.call(e,a,s,O,v,o,i,k,f,b);var A=e.frictionEquations.length-w;if(m){if(o.allowSleep&&o.type===p.DYNAMIC&&o.sleepState===p.SLEEPING&&a.sleepState===p.AWAKE&&a.type!==p.STATIC){var B=c.squaredLength(a.velocity)+Math.pow(a.angularVelocity,2),C=Math.pow(a.sleepSpeedLimit,2);B>=2*C&&(o._wakeUpAfterNarrowphase=!0)}if(a.allowSleep&&a.type===p.DYNAMIC&&a.sleepState===p.SLEEPING&&o.sleepState===p.AWAKE&&o.type!==p.STATIC){var E=c.squaredLength(o.velocity)+Math.pow(o.angularVelocity,2),M=Math.pow(o.sleepSpeedLimit,2);E>=2*M&&(a._wakeUpAfterNarrowphase=!0)}if(t.overlapKeeper.setOverlapping(o,i,a,s),t.has("beginContact")&&t.overlapKeeper.isNewOverlap(i,s)){var P=_;if(P.shapeA=i,P.shapeB=s,P.bodyA=o,P.bodyB=a,P.contactEquations.length=0,!b)for(var x=e.contactEquations.length-m;x<e.contactEquations.length;x++)P.contactEquations.push(e.contactEquations[x]);t.emit(P)}if(!b&&A>1)for(var x=e.frictionEquations.length-A;x<e.frictionEquations.length;x++){var S=e.frictionEquations[x];S.setSlipForce(S.getSlipForce()/A)}}}}}function s(t,e){for(var o=t.constraints,i=0;i!==o.length;i++)for(var n=o[i],r=n.equations,a=0;a!==r.length;a++){var s=r[a];s.relaxation=void 0!==e.relaxation?e.relaxation:s.relaxation,s.stiffness=void 0!==e.stiffness?e.stiffness:s.stiffness,s.needsUpdate=!0}}var l=o(39),c=o(10),h=o(21),u=o(25),p=o(14),d=o(34),f=o(33),v=o(9),y=o(54),g=o(44),m=o(11),b=m.arrayRemove,w=o(60),A=o(63);t.exports=i,i.prototype=new Object(u.prototype),i.prototype.constructor=i;var B={type:"postStep"},C={type:"addBody",body:null},E={type:"removeBody",body:null},M={type:"addSpring",spring:null},P={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},x={type:"postBroadphase",pairs:null},_={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},S={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},F={type:"preSolve",contactEquations:null,frictionEquations:null};i.NO_SLEEPING=1,i.BODY_SLEEPING=2,i.ISLAND_SLEEPING=4,i.prototype.addConstraint=function(t){if(this.stepping)throw new Error("Constraints cannot be added during step.");var e=this.bodies;if(e.indexOf(t.bodyA)===-1)throw new Error("Cannot add Constraint: bodyA is not added to the World.");if(e.indexOf(t.bodyB)===-1)throw new Error("Cannot add Constraint: bodyB is not added to the World.");this.constraints.push(t)},i.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},i.prototype.removeContactMaterial=function(t){b(this.contactMaterials,t)},i.prototype.getContactMaterial=function(t,e){for(var o=this.contactMaterials,i=0,n=o.length;i!==n;i++){var r=o[i];if(r.materialA===t&&r.materialB===e||r.materialA===e&&r.materialB===t)return r}return!1},i.prototype.removeConstraint=function(t){if(this.stepping)throw new Error("Constraints cannot be removed during step.");b(this.constraints,t)};var L=c.create(),k=c.create(),O=c.create();i.prototype.step=function(t,e,o){if(o=o||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var i=0;this.accumulator>=t&&i<o;)this.internalStep(t),this.time+=t,this.accumulator-=t,i++;for(var n=this.accumulator%t/t,r=0;r!==this.bodies.length;r++){var a=this.bodies[r];c.lerp(a.interpolatedPosition,a.previousPosition,a.position,n),a.interpolatedAngle=a.previousAngle+n*(a.angle-a.previousAngle)}}};var T=[];i.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,o=this.springs,s=this.bodies,l=this.gravity,h=this.solver,u=this.bodies.length,d=this.broadphase,f=this.narrowphase,v=this.constraints,y=L,g=c.add;if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var b=c.length(this.gravity);0===b&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=b)}if(this.applyGravity)for(var w=0;w!==u;w++){var A=s[w],C=A.force;A.type===p.DYNAMIC&&A.sleepState!==p.SLEEPING&&(c.scale(y,l,A.mass*A.gravityScale),g(C,C,y))}if(this.applySpringForces)for(var w=0;w!==e;w++){var E=o[w];E.applyForce()}if(this.applyDamping)for(var w=0;w!==u;w++){var A=s[w];A.type===p.DYNAMIC&&A.applyDamping(t)}for(var M=d.getCollisionPairs(this),_=this.disabledBodyCollisionPairs,w=_.length-2;w>=0;w-=2)for(var k=M.length-2;k>=0;k-=2)(_[w]===M[k]&&_[w+1]===M[k+1]||_[w+1]===M[k]&&_[w]===M[k+1])&&M.splice(k,2);var O=v.length;for(w=0;w!==O;w++){var I=v[w];if(!I.collideConnected)for(var k=M.length-2;k>=0;k-=2)(I.bodyA===M[k]&&I.bodyB===M[k+1]||I.bodyB===M[k]&&I.bodyA===M[k+1])&&M.splice(k,2)}x.pairs=M,this.emit(x),x.pairs=null,f.reset();for(var q=this.defaultContactMaterial,N=this.frictionGravity,w=0,G=M.length;w!==G;w+=2)for(var R=M[w],V=M[w+1],D=0,W=R.shapes.length;D!==W;D++)for(var j=R.shapes[D],U=j.position,X=j.angle,Y=0,H=V.shapes.length;Y!==H;Y++){var z=V.shapes[Y],K=z.position,Z=z.angle,J=null;j.material&&z.material&&(J=this.getContactMaterial(j.material,z.material)),a(this,f,R,j,U,X,V,z,K,Z,J||q,N)}for(var w=0;w!==u;w++){var Q=s[w];Q._wakeUpAfterNarrowphase&&(Q.wakeUp(),Q._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(T);for(var $=S,Y=T.length;Y--;){var tt=T[Y];$.shapeA=tt.shapeA,$.shapeB=tt.shapeB,$.bodyA=tt.bodyA,$.bodyB=tt.bodyB,this.emit($)}T.length=0}F.contactEquations=f.contactEquations,F.frictionEquations=f.frictionEquations,this.emit(F),F.contactEquations=F.frictionEquations=null;var O=v.length;for(w=0;w!==O;w++)v[w].update();if(f.contactEquations.length||f.frictionEquations.length||O){var et=[];for(m.appendArray(et,f.contactEquations),m.appendArray(et,f.frictionEquations),w=0;w!==O;w++)m.appendArray(et,v[w].equations);if(this.islandSplit){var ot=this.unionFind;ot.resize(this.bodies.length+1);for(var w=0;w<et.length;w++)et[w].index=w;for(var w=0;w<et.length;w++){var it=et[w].bodyA,nt=et[w].bodyB;it.type===p.DYNAMIC&&nt.type===p.DYNAMIC&&ot.union(it.index,nt.index)}for(var w=0;w<s.length;w++){var Q=s[w];Q.islandId=Q.type===p.DYNAMIC?ot.find(Q.index):-1}et=et.sort(r);for(var rt=0;rt<et.length;){var at=et[rt++];h.addEquation(at);var st=at.bodyA.islandId>0?at.bodyA.islandId:at.bodyB.islandId,lt=-1;et[rt]&&(lt=et[rt].bodyA.islandId>0?et[rt].bodyA.islandId:et[rt].bodyB.islandId),lt===st&&rt!==et.length||(this.solveConstraints&&h.solve(t,this),h.removeAllEquations())}}else h.addEquations(et),this.solveConstraints&&h.solve(t,this),h.removeAllEquations()}for(var w=0;w!==u;w++){var Q=s[w];Q.type!==p.DYNAMIC&&Q.type!==p.KINEMATIC||Q.integrate(t)}for(var w=0;w!==u;w++)s[w].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var ct=P,w=0;w!==f.contactEquations.length;w++){var ht=f.contactEquations[w];ht.firstImpact&&(ct.bodyA=ht.bodyA,ct.bodyB=ht.bodyB,ct.shapeA=ht.shapeA,ct.shapeB=ht.shapeB,ct.contactEquation=ht,this.emit(ct))}if(this.sleepMode===i.BODY_SLEEPING)for(w=0;w!==u;w++)s[w].sleepTick(this.time,!1,t);else if(this.sleepMode===i.ISLAND_SLEEPING&&this.islandSplit){for(w=0;w!==u;w++)s[w].sleepTick(this.time,!0,t);for(var ut=s.sort(n),pt=1,dt=0;dt<ut.length;dt=pt){var ft=ut[dt].islandId;for(pt=dt+1;pt<ut.length&&ut[pt].islandId===ft;pt++);if(ft!==-1){for(var vt=!0,w=dt;w<pt;w++)if(!ut[w].wantsToSleep){vt=!1;break}if(vt)for(var w=dt;w<pt;w++)ut[w].sleep()}}}this.stepping=!1,this.emit(B)},i.prototype.addSpring=function(t){if(this.stepping)throw new Error("Springs cannot be added during step.");this.springs.push(t),M.spring=t,this.emit(M),M.spring=null},i.prototype.removeSpring=function(t){if(this.stepping)throw new Error("Springs cannot be removed during step.");b(this.springs,t)},i.prototype.addBody=function(t){if(this.stepping)throw new Error("Bodies cannot be added during step.");if(t.world)throw new Error("Body is already added to a World.");t.index=this.bodies.length,this.bodies.push(t),t.world=this,C.body=t,this.emit(C),C.body=null},i.prototype.removeBody=function(t){if(this.stepping)throw new Error("Bodies cannot be removed during step.");for(var e=this.constraints,o=e.length;o--;)if(e[o].bodyA===this||e[o].bodyB===this)throw new Error("Cannot remove Body from World: it still has constraints connected to it.");t.world=null;var i=this.bodies;b(i,t),t.index=-1;for(var o=i.length;o--;)i[o].index=o;E.body=t,t.resetConstraintVelocity(),this.emit(E),E.body=null;for(var n=this.disabledBodyCollisionPairs,r=0;r<n.length;)n[r]===t||n[r+1]===t?n.splice(r,2):r+=2},i.prototype.getBodyById=function(t){for(var e=this.bodies,o=0;o<e.length;o++){var i=e[o];if(i.id===t)return i}return!1},i.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},i.prototype.enableBodyCollision=function(t,e){for(var o=this.disabledBodyCollisionPairs,i=0;i<o.length;i+=2)if(o[i]===t&&o[i+1]===e||o[i+1]===t&&o[i]===e)return void o.splice(i,2)},i.prototype.clear=function(){this.solver.removeAllEquations();for(var t=this.constraints,e=t.length;e--;)this.removeConstraint(t[e]);var o=this.bodies;for(e=o.length;e--;)this.removeBody(o[e]);var i=this.springs;for(e=i.length;e--;)this.removeSpring(i[e]);var n=this.contactMaterials;for(e=n.length;e--;)this.removeContactMaterial(n[e])};var I=c.create(),q=c.create();i.prototype.hitTest=function(t,e,o){o=o||0;for(var i=I,n=q,r=[],a=0,s=e.length;a!==s;a++)for(var l=e[a],u=0,p=l.shapes.length;u!==p;u++){var d=l.shapes[u];d.worldPointToLocal(n,t),d.pointTest(n)?r.push(l):(c.rotate(i,d.position,l.angle),c.add(i,i,l.position),d.type===h.PARTICLE&&c.squaredDistance(i,t)<o*o&&r.push(l))}return r},i.prototype.setGlobalStiffness=function(t){s(this,{stiffness:t});for(var e=this.contactMaterials,o=0;o!==e.length;o++){var i=e[o];i.stiffness=i.frictionStiffness=t}var i=this.defaultContactMaterial;i.stiffness=i.frictionStiffness=t},i.prototype.setGlobalRelaxation=function(t){s(this,{relaxation:t});for(var e=0;e!==this.contactMaterials.length;e++){var o=this.contactMaterials[e];o.relaxation=o.frictionRelaxation=t}var o=this.defaultContactMaterial;o.relaxation=o.frictionRelaxation=t};var N=new v,G=[];i.prototype.raycast=function(t,e){return e.getAABB(N),this.broadphase.aabbQuery(this,N,G),e.intersectBodies(t,G),G.length=0,t.hasHit()}},function(t,e,o){"use strict";function i(){this.overlappingShapesLastState=new n,this.overlappingShapesCurrentState=new n,this.recordPool=new r({size:16}),this.tmpDict=new n,this.tmpArray1=[]}var n=o(45),r=o(61);t.exports=i,i.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,o=t.keys.length;o--;){var i=t.keys[o],n=t.getByKey(i);n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},i.prototype.setOverlapping=function(t,e,o,i){var n=this.overlappingShapesCurrentState;if(!n.get(e.id,i.id)){var r=this.recordPool.get();r.set(t,e,o,i),n.set(e.id,i.id,r)}},i.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},i.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},i.prototype.bodiesAreOverlapping=function(t,e){for(var o=this.overlappingShapesCurrentState,i=o.keys.length;i--;){var n=o.keys[i],r=o.data[n];if(r.bodyA===t&&r.bodyB===e||r.bodyA===e&&r.bodyB===t)return!0}return!1},i.prototype.getDiff=function(t,e,o){var o=o||[],i=t,n=e;o.length=0;for(var r=n.keys.length;r--;){var a=n.keys[r],s=n.data[a];if(!s)throw new Error("Key "+a+" had no data!");var l=i.data[a];l||o.push(s)}return o},i.prototype.isNewOverlap=function(t,e){var o=0|t.id,i=0|e.id,n=this.overlappingShapesLastState,r=this.overlappingShapesCurrentState;return!n.get(o,i)&&!!r.get(o,i)},i.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},i.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},i.prototype.getBodyDiff=function(t,e){e=e||[];for(var o=this.tmpDict,i=t.length;i--;){var n=t[i];o.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(i=o.keys.length;i--;){var n=o.getByKey(o.keys[i]);n&&e.push(n.bodyA,n.bodyB)}return o.reset(),e}},function(t,e,o){"use strict";function i(){r.apply(this,arguments)}var n=o(62),r=o(32);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.create=function(){return new n},i.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},function(t,e){"use strict";function o(t,e,o,i){this.shapeA=e,this.shapeB=i,this.bodyA=t,this.bodyB=o}t.exports=o,o.prototype.set=function(t,e,i,n){o.call(this,t,e,i,n)}},function(t,e){"use strict";function o(t){this.id=[],this.sz=[],this.size=t,this.count=t,this.resize(t)}t.exports=o,o.prototype={resize:function(t){this.count=this.size=t;for(var e=this.sz,o=this.id,i=0;i<t;i++)o[i]=i,e[i]=1},find:function(t){for(var e=this.id;t!==e[t];)e[t]=e[e[t]],t=e[t];return t},union:function(t,e){var o=this.find(t),i=this.find(e);if(o!==i){var n=this.sz,r=this.id;n[o]<n[i]?(r[o]=i,n[i]+=n[o]):(r[i]=o,n[o]+=n[i]),this.count--}}}},function(t,e){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return n(e,t),e}(Tiny.Container);e.default=r},function(t,e){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function t(e){o(this,t),this.mask=e};e.default=i},function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=o(8),r=function t(e,o,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,c=arguments[6],h=arguments[7],u=arguments[8],p=arguments[9];i(this,t),a=e.pxm(a),this.app=e.app,this.world=e;var d={restLength:a,stiffness:s,damping:l};"undefined"!=typeof c&&null!==c&&(d.worldAnchorA=[e.pxm(c[0]),e.pxm(c[1])]),"undefined"!=typeof h&&null!==h&&(d.worldAnchorB=[e.pxm(h[0]),e.pxm(h[1])]),"undefined"!=typeof u&&null!==u&&(d.localAnchorA=[e.pxm(u[0]),e.pxm(u[1])]),"undefined"!=typeof p&&null!==p&&(d.localAnchorB=[e.pxm(p[0]),e.pxm(p[1])]),this.data=new n.LinearSpring(o,r,d),this.data.parent=this};e.default=r},function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=o(8),r=function t(e,o,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;i(this,t),a&&(a=e.pxm(a)),this.app=e.app,this.world=e;var c={restAngle:a,stiffness:s,damping:l};this.data=new n.RotationalSpring(o,r,c),this.data.parent=this};e.default=r},function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=o(8),s=function(t){function e(t,o,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Number.MAX_VALUE;i(this,e),a=[t.pxm(a[0]),t.pxm(a[1])];var c={localOffsetB:a,localAngleB:s,maxForce:l},h=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,o,r,c));return h.app=t.app,h.world=t,h}return r(e,t),e}(a.LockConstraint);e.default=s},function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=o(8),s=function(t){function e(t,o,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Number.MAX_VALUE;i(this,e),a=t.pxm(a),s=[t.pxmi(s[0]),t.pxmi(s[1])],l=[t.pxmi(l[0]),t.pxmi(l[1])];var h={distance:a,localAnchorA:s,localAnchorB:l,maxForce:c},u=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,o,r,h));return u.app=t.app,u.world=t,u}return r(e,t),e}(a.DistanceConstraint);e.default=s},function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=o(8),s=function(t){function e(t,o,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;i(this,e);var l={angle:a,ratio:s},c=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,o,r,l));return c.app=t.app,c.world=t,c}return r(e,t),e}(a.GearConstraint);e.default=s},function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=o(8);e.RevoluteConstraint=function(t){function e(t,o,r,a,s){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Number.MAX_VALUE,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;i(this,e),r=[t.pxmi(r[0]),t.pxmi(r[1])],s=[t.pxmi(s[0]),t.pxmi(s[1])],c&&(c=[t.pxmi(c[0]),t.pxmi(c[1])]);var h={worldPivot:c,localPivotA:r,localPivotB:s,maxForce:l},u=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,o,a,h));return u.world=t,u}return r(e,t),e}(a.RevoluteConstraint)},function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=o(8),s=function(t){function e(t,o,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE;i(this,e),s=[t.pxmi(s[0]),t.pxmi(s[1])],l=[t.pxmi(l[0]),t.pxmi(l[1])];var u={localAnchorA:s,localAnchorB:l,localAxisA:c,maxForce:h,disableRotationalLock:!a},p=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,o,r,u));return p.app=t.app,p.world=t,p}return r(e,t),e}(a.PrismaticConstraint);e.default=s},function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=o(8),s=function(t){function e(t){i(this,e);var o=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.name=t,o}return r(e,t),e}(a.Material);e.default=s},function(t,e,o){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=o(8),s=function(t){function e(t,o,r){return i(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,o,r))}return r(e,t),e}(a.ContactMaterial);e.default=s},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ON_SPRING_ADDED="springAdded",e.ON_SPRING_REMOVED="springRemoved",e.ON_END_CONTACT="endContact",e.ON_BEGIN_CONTACT="beginContact",e.ON_BODY_REMOVED="bodyRemoved",e.ON_BODY_ADDED="bodyAdded",e.ON_CONSTRAIN_ADDED="constraintAdded",e.ON_CONSTRAIN_REMOVED="constraintRemoved",e.ON_CONTACTMATERIAL_ADDED="contactMaterialAdded",e.ON_CONTACTMATERIAL_REMOVED="ContactMaterialRemoved"}])});